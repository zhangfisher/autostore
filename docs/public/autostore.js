var AutoStoreSpaces=(function(exports){'use strict';var Zt=Object.defineProperty;var n=(e,t)=>Zt(e,"name",{value:t,configurable:true}),S=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,s)=>(typeof require<"u"?require:t)[s]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')});function jt(e,...t){if(t.length===0)return e;let s=t.map((r,i)=>{let o=Object.entries(r||{});return o.some(([a,u])=>u===void 0)?o.reduce((a,[u,f])=>(f!==void 0&&(a[u]=f),a),{}):r});return Object.assign(e,...s)}n(jt,"u");function X(e){return e!=null&&typeof e[Symbol.iterator]=="function"&&typeof e!="string"}n(X,"t");function x(e){if(typeof e!="object"||e===null)return  false;var t=Object.getPrototypeOf(e);if(t===null)return  true;for(var s=t;Object.getPrototypeOf(s)!==null;)s=Object.getPrototypeOf(s);return t===s}n(x,"o");function St(e,t=false){if(typeof e=="number")return  true;if(typeof e!="string"||t)return  false;try{if(e.includes(".")){let s=parseFloat(e);return e.endsWith(".")?!isNaN(s)&&String(s).length===e.length-1:!isNaN(s)&&String(s).length===e.length}else {let s=parseInt(e);return !isNaN(s)&&String(s).length===e.length}}catch{return  false}}n(St,"r");function R(e){if(St(e)||typeof e=="boolean"||typeof e=="function"||e instanceof Error)return  false;if(e==null||e==null||Array.isArray(e)&&e.length==0||x(e)&&Object.keys(e).length==0||typeof e=="string"&&e.trim()=="")return  true;try{if(X(e)&&e.size==0)return !0}catch{}return  false}n(R,"s");function Tt(e,{empty:t,delimiter:s=","}){let r=e;try{return typeof r=="function"&&(r=r.call(this,r)),R(r)&&(r=t||""),Array.isArray(r)?r.map(i=>String(i)).join(s):x(r)?Object.entries(r).reduce((i,[o,a])=>(i.push(`${o}=${String(a)}`),i),[]).join(s):X(r)&&typeof r!="string"?[...r].map(i=>String(i)).join(s):r instanceof Error?r.message:String(r)}catch{return String(r)}}n(Tt,"h");var Jt=/\{(\<(.*?)\>)?\s*([^\{\}\>\<]*)(?<!\s)\s*(\<(.*?)\>)?\}/gm;function bt(e,t,s){let r,i=jt({empty:null,delimiter:",",forEach:null},s);typeof t=="function"&&(t=t.call(e)),Array.isArray(t)&&t.length==1&&(x(t[0])||Array.isArray(t[0]))&&(t=t[0]),["boolean","string","number"].includes(typeof t)?r=[t]:t instanceof Map?r=[...t.entries()].reduce((a,u)=>(a[u[0]]=u[1],a),{}):Symbol.iterator in t?r=[...t]:x(t)?r=t:t instanceof Error?r=[`Error:${t.message}`]:r=[t];let o=0;return e.replaceAll(Jt,function(){let a=arguments[2]||"",u=arguments[3]||"",f=arguments[5]||"",l="",c=false;if(Array.isArray(r)){let p=o>=r.length;l=p?"":Tt.call(e,r[o],i),c=R(l)||p,o++;}else if(x(r)){let p=u in r;l=p?Tt.call(e,r[u],i):"",c=R(l)||!p;}if(typeof i.forEach=="function"){let p=i.forEach(u,l,a,f);p!==void 0&&(Array.isArray(p)&&p.length==3?(a=p[0],l=p[1],f=p[2]):R(p)||(l=String(p)),c=R(l));}return c&&(i.empty==null?(l="",a="",f=""):l=i.empty),`${a}${l}${f}`})}n(bt,"x");function Vt(e,...t){let s=e.valueOf(),r={},i=[...t];if(t.length>0&&x(t[t.length-1])){let o=t[t.length-1];("$delimiter"in o||"$empty"in o||"$forEach"in o)&&("$delimiter"in o&&(r.delimiter=o.$delimiter),"$empty"in o&&(r.empty=o.$empty),"$forEach"in o&&(r.forEach=o.$forEach),i.pop());}try{return i.length==1?bt(s,i[0],r):bt(s,[...i],r)}catch{return s}}n(Vt,"o");String.prototype.params=function(){return Vt(this,...arguments)};function Qt(e,t,s){if(typeof t=="string"){let r=0,i;for(;(i=e.indexOf(t,r))>-1;){let o=typeof s=="function"?s(t):s,a=e.length;e=e.substring(0,i)+o+e.substring(i+t.length),r=i+o.length+e.length-a;}}else {let r;if(!t.global||!t.multiline)throw new Error("The search parameter must be enabled '/gm' option");for(;(r=t.exec(e))!==null;){r.index===t.lastIndex&&t.lastIndex++;let i=e.length,o=r[0].length,a=typeof s=="function"?s(r[0],...r):s;e=e.substring(0,r.index)+a+e.substring(r.index+o),t.lastIndex+=e.length-i;}}return e}n(Qt,"s");String.prototype.replaceAll||(String.prototype.replaceAll=function(e,t){return Qt(this,e,t)});(e=>typeof S<"u"?S:typeof Proxy<"u"?new Proxy(e,{get:n((t,s)=>(typeof S<"u"?S:t)[s],"get")}):e)(function(e){if(typeof S<"u")return S.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')});var E=class extends Error{static{n(this,"AutoStoreError");}},G=class extends E{static{n(this,"AbortError");}},C=class extends E{static{n(this,"TimeoutError");}},z=class extends E{static{n(this,"CyleDependError");}},Z=class extends E{static{n(this,"InvalidComputedArgumentsError");}},J=class extends E{static{n(this,"InvalidScopeError");}},Q=class extends E{static{n(this,"InvalidDependsError");}},k=class extends E{static{n(this,"ValidateError");}behavior};var tt="__AS_SKIP_PROXY__",I="__AS_OBSERVER_DESCRIPTOR_BUILDER__",Rt="__AS_OBSERVER_DESCRIPTOR__",h=".",Ct="__batch_update__",et="__AS_ASYNC_COMPUTED_VALUE__",jr="__AS_EMPTY__",D="__AS_VALUE_SCHEMA__",Sr="__AS_DELETE_FLAG__",H="AutoStoreConfigManager";function rt(e){return e.constructor.name==="AsyncFunction"}n(rt,"isAsyncFunction");function xt(e){return e?e.map(t=>Array.isArray(t)?t:typeof t=="string"?["/","./","../"].some(s=>t.startsWith(s))?t:t.includes(".")?t.split("."):t.split("."):[]):[]}n(xt,"normalizeDeps");function st(){return {async:false,enable:true,timeout:0,depends:[],immediate:"auto",extras:void 0,objectify:true}}n(st,"getDefaultComputedOptions");function it(){let e=arguments[0];if(typeof e!="function")throw new Error("computed getter must be a function");let t=[],s=Object.assign({},st());if(arguments.length===1)t=[];else if(arguments.length===2)if(Array.isArray(arguments[1]))s.depends=arguments[1];else if(typeof arguments[1]=="object")Object.assign(s,arguments[1]),s.depends=xt(s.depends);else throw new Z;else arguments.length>=3&&(t=xt(arguments[1]),Object.assign(s,arguments[2]),s.depends=t);s.async=s.async===true||rt(e)||arguments.length>=2&&Array.isArray(arguments[1]);let r=n(()=>({type:"computed",getter:e,options:s,[Rt]:true}),"descriptorBuilder");return r[I]=true,r}n(it,"computed");function At(e){return e?e.some(t=>typeof t=="string"?t.startsWith("./")||t.startsWith("../")||t.startsWith("@")?false:!["CURRENT","SELF","PARENT"].includes(t):true):false}n(At,"isAbsolutePath");function v(e){return typeof e=="object"&&e.hasOwnProperty("type")&&typeof e.type=="string"&&e.hasOwnProperty("getter")&&typeof e.getter=="function"&&e.hasOwnProperty("options")&&typeof e.options=="object"}n(v,"isObserverDescriptor");function K(e){try{return e[tt]===!0}catch{}return  false}n(K,"isRaw");function ot(e,t){if(e===t)return  true;if(e===null||t===null||typeof e!=typeof t)return  false;if(typeof e=="object"){if(Array.isArray(e)&&Array.isArray(t))return e.length!==t.length?false:e.every((s,r)=>ot(s,t[r]));if(!Array.isArray(e)&&!Array.isArray(t)){let s=Object.keys(e);return s.length!==Object.keys(t).length?false:s.every(r=>ot(e[r],t[r]))}else return  false}return  false}n(ot,"isEq");function P(e){return toString.call(e)==="[object Map]"}n(P,"isMap");function w(e,t){return !e||!t||e.length!==t.length?false:e.every((s,r)=>s===t[r])}n(w,"isPathEq");function nt(e,t){let s=Array.isArray(e)?e:e.split("."),r=Array.isArray(t)?t:t===""?[]:t.split(".");return r.length===0||w(s,r)?true:(r[r.length-1]==="**"&&(r[r.length-1]="*",r.splice(r.length-1,0,...Array.from({length:s.length-r.length}).fill("*"))),s.length!==r.length?false:r.every((o,a)=>o==="*"||o==="**"?true:o===s[a]))}n(nt,"isPathMatched");function It(e){return e==null||typeof e!="object"?false:Object.prototype.toString.call(e)==="[object Object]"}n(It,"isPlainObject");function b(e){return e&&typeof e=="object"&&e.hasOwnProperty(et)}n(b,"isAsyncComputedValue");function Dt(e){try{return !!e&&(typeof e=="object"||typeof e=="function")&&typeof e.then=="function"&&typeof e.catch=="function"&&(e instanceof Promise||Object.prototype.toString.call(e)==="[object Promise]")}catch{return  false}}n(Dt,"isPromise");function $(e){return typeof e=="function"&&e[I]===true}n($,"isObserverDescriptorBuilder");function gs(e){return typeof e=="object"&&e!==null&&!("__isProxy"in e)}n(gs,"isProxy");function at(e,t){let s=e.get(t);if(s!==void 0)return s;let r=e.get(Number(t)||t);if(r!==void 0)return r}n(at,"getMapVal");function g(e,t,s){if(!t||t.length===0)return e;let r=Array.isArray(t)?t:t.split("."),i,o=e;for(let a=0;a<r.length;a++){let u=r[a];if(P(o))i=at(o,u);else if(u in o)i=o[u];else return s;o=i;}return i}n(g,"getVal");function A(e){try{["object","function"].includes(typeof e)&&(e[tt]=!0);}catch{}return e}n(A,"markRaw");function j(e,t,s,r){if(!t||!e)return e;let i=t;if(i.length===0)return typeof e=="object"&&Object.assign(e,s),e;{let o=e,a=[],u=n((f,l,c)=>{r&&b(f[l])?f[l].value=c:f[l]=c;},"update");for(let f=0;f<i.length;f++){let l=i[f];if(a.push(l),o)if(Array.isArray(o)){let c=parseInt(l,10);if(Number.isNaN(c)||c<0)throw new Error(`setVal: invalid array index ${a.join(".")}`);f===i.length-1?u(o,c,s):o=o[c];}else o instanceof Map||o instanceof WeakMap?f===i.length-1?o.set(l,s):(o.has(l)||o.set(l,{}),o=o.get(l)):typeof o=="object"&&l in o?f===i.length-1?u(o,l,s):o=o[l]:(o[l]=f===i.length-1?s:{},o=o[l]);else o[l]=f===i.length-1?s:{},o=o[l];}}return e}n(j,"setVal");function M(e){return (e||["ROOT"]).map(t=>Array.isArray(t)?t.join("."):t).join(".")}n(M,"joinValuePath");function ut(){return Math.random().toString(36).slice(2)}n(ut,"getId");function q(e,t,s){let r=e&&!e[0].startsWith("#");if(Array.isArray(t))return t;if(t==="self")return r?e:void 0;if(t==="root")return r?[]:void 0;if(t==="parent")return r?e.slice(0,-2):void 0;if(t==="current")return r?e.slice(0,-1):void 0;if(typeof t=="string")return t.startsWith("./")?r?[...e.slice(0,-1),...t.slice(2).split(".")]:void 0:t.startsWith("../")?r?q(e.slice(0,-1),t.slice(3),true):void 0:t.startsWith("/")?t.replace(/^(\/)*/,"").split("."):r&&s?[...e.slice(0,-1),...t.split(".")]:t.split(".")}n(q,"getFullValuePath");function L(e,t){return t?t.map(s=>q(e,s)).filter(s=>s!==void 0):[]}n(L,"calcDependPaths");function Hs(e,t){let s="";return t.id?s=t.id:s=M(e),s}n(Hs,"getComputedId");function Pt(e,t,s){let r=e,i=t.length-1;t.forEach((o,a)=>{let u=P(r);if(a===i){let f=u?r.get(o):r[o];typeof f=="object"&&Object.assign(f,s);return}u?(r.has(o)||r.set(o,{}),r=r.get(o)):(o in r||(r[o]={}),r=r[o]);});}n(Pt,"updateObjectVal");function lt(e,t){function s(r,i){for(let o in r){let a=r[o];typeof t=="function"&&t({value:a,key:o,parent:r,path:i.concat(o)}),typeof a=="object"&&!K(a)&&s(a,i.concat(o));}}n(s,"_forEachObject"),s(e,[]);}n(lt,"forEachObject");function kt(e){return e}n(kt,"getSnap");function ei(e=1e3){return new Promise(t=>{setTimeout(t,e);})}n(ei,"delay");function ft(e){let t=new Map;return e.forEach(s=>{let r=s.join(".");t.set(r,s);}),Array.from(t.values())}n(ft,"noRepeat");function ni(e,t){return e.length>t.length?false:e.every((s,r)=>s===t[r])}n(ni,"pathStartsWith");function pi(e,t,s){let r=[];return typeof e=="function"?r=t.collectDependencies(()=>e(t.state)):typeof e=="string"?r=[e.split(".")]:Array.isArray(e)?r=[[...e]]:r=[],s!=="none"&&r.forEach(i=>{let o=t.peep(a=>g(a,i));b(o)&&i.push(s==="all"?"*":"value");}),r}n(pi,"getDepends");function yi(e,t){if(!t||t.length===0)return  false;let s,r=e;for(let i=0;i<t.length;i++){let o=t[i],a=false;if(P(r)){if(a=r.has(o),!a)return  false;s=at(r,o);}else {if(a=o in r,!a)return  false;s=r[o];}r=s;}return  true}n(yi,"pathIsExists");function O(e){return e?typeof e=="function":false}n(O,"isFunction");function ct(e,t){let{reserveAsync:s,includeFunc:r}=Object.assign({reserveAsync:false},t);if(Array.isArray(e)){let i=[...e];for(let o=0;o<i.length;o++)i[o]=ct(i[o],t);return i}else if(typeof e=="object"){if(!s&&b(e))return e.value;{let i={...e};for(let o in i)i[o]=ct(i[o],t);return i}}return r&&O(e)?`\`\`\`${e.toString()}\`\`\``:e}n(ct,"getSnapshot");function ji(e){return e==null||typeof e=="string"||typeof e=="number"||typeof e=="boolean"}n(ji,"isPrimitive");function Vi(e){globalThis.__AUTOSTORE_EXTENDS__&&(globalThis.__AUTOSTORE_EXTENDS__=[]),typeof e=="function"&&globalThis.__AUTOSTORE_EXTENDS__.push(e);}n(Vi,"defineExtend");function $i(e,t,s){let r=$(t)?t():t;if(v(r)){if(r.options.objectify=false,Object.assign(r.options,s),r.type==="computed")return e.computedObjects.create(r);if(r.type==="watch")return e.watchObjects.create(r)}else if(typeof r=="function"){let o=it(r)();return o.options.objectify=false,Object.assign(o.options,s),e.computedObjects.create(o)}}n($i,"createObserverObject");function Ui(e){return v(e)||$(e)}n(Ui,"isComputedDescriptorParameter");function qi(e,t,s){let r=g(e,typeof t=="string"?t.split("."):t,s);return b(r)?r:{value:r,loading:false,retry:0,error:null,timeout:0,progress:0,run:n(()=>{},"run"),cancel:n(()=>{},"cancel")}}n(qi,"getAsyncVal");function Zi(e,t){return b(e)?Object.assign({},e,t):Object.assign({value:e,loading:false,retry:0,progress:0,timeout:0,error:null,run:n(()=>{},"run"),cancel:n(()=>{},"cancel")},t)}n(Zi,"createAsyncComptuedValue");function to(e){try{return e[D]===!0}catch{}return  false}n(to,"isValueSchema");function so(e){let t=Array.isArray(e)?e[0]:e;return !!(t.startsWith("./")||t.startsWith("../")||["CURRENT","PARENT","SELF"].includes(t))}n(so,"isRelPath");function pt(e){return typeof e=="function"&&e[D]===true}n(pt,"isSchemaBuilder");var $t="__WITH_SCHEMA_VALUE__";function Mt(e,t){return Object.assign({validate:"throw"},t,{[$t]:true,value:e})}n(Mt,"withSchema");function te(e){return e&&typeof e=="object"&&e[$t]===true}n(te,"isWithSchemaValue");function Lt(e){return te(e)?[e.value,e]:[e,void 0]}n(Lt,"getSchemaValue");var ht=class extends Map{static{n(this,"ComputedObjects");}store;constructor(t){super(),this.store=t;}get enable(){return this.store.options.enableComputed}set enable(t){this.store.options.enableComputed=t;}create(){let t=v(arguments[0])?arguments[0]:it(...arguments)();if(t.options.async&&!At(t.options.depends))throw new Q("The scope of the dynamic computed object must be the root state object or an absolute path");let s=t.options.scope;if(s===void 0||s==="ROOT")t.options.scope="ROOT";else if(!At([s]))throw new J("The scope of the dynamic computed object must be the root state object or an absolute path");return this.store._createComputed(t)}async runGroup(t,s,r){return await this.run(i=>i.group===t,s,r)}async run(){if(arguments.length===0)return Promise.all([...this.values()].map(o=>o.run()));let t;typeof arguments[0]=="function"?t=arguments[0]:typeof arguments[0]=="string"&&(t=n(o=>o.id===arguments[0],"filter"));let s=Object.assign({},arguments[1]),r=Object.assign({wait:false,timeout:0},arguments[2]),i={};return new Promise((o,a)=>{if(r.wait){let u;s.onDone=({id:f})=>{if(i[f]=true,Object.values(i).every(l=>l))return clearTimeout(u),true},r.timeout>0&&(u=setTimeout(()=>{a(new C);},r.timeout));}Promise.all([...this.values()].filter(u=>t(u)?(i[u.id]=false,true):false).map(u=>u.run(s))),r.wait||o();})}async enableGroup(t){for(let s of this.values())s.options.enable=t;}delete(t){return this.get(t)?.detach(),super.delete(t)}find(t){if(!t)return;let s=Array.isArray(t)?t:t.split(".");for(let r of this.values())if(w(r.path,s))return r}};function Bt(e,t="info"){let s=typeof e=="function"?e():e instanceof Error?e.stack:e;try{console[t](`[AutoStore<${this.id}>]`,...Array.isArray(s)?s:[s]);}catch{}}n(Bt,"log");function B(e,t,s="."){let r=[];try{return typeof t=="function"&&(t=t.call(e,e)),r=Array.isArray(t)?t:typeof t=="string"?t.split(s):[],r.length>0?g(e,r):e}catch{return e}}n(B,"getValueByPath");var F=(function(e){return e.Root="ROOT",e.Current="CURRENT",e.Parent="PARENT",e.Depends="DEPENDS",e.Self="SELF",e})({});function ee(e,t,s){let r=t===void 0?s:t;if(typeof r=="function")try{r=r.call(e.store,e);}catch{}return r===void 0?s===void 0?F.Current:s:r}n(ee,"getScopeOptions");function U(e,t,s,r){let i=e.store.state,o=e.store.options;if(typeof o.getRootScope=="function"){let c=o.getRootScope(e,{observerType:t,valuePath:s?.path});c!==void 0&&(i=c);}let{path:a,parentPath:u}=s||{},f=ee(e,r.scope,o.scope),l=i;try{f===F.Current?l=B(i,u):f===F.Parent?l=B(i,a.slice(0,a.length-2<0?0:a.length-2)):f===F.Root?l=i:f===F.Depends?l=e.depends?.map(c=>B(i,c)):typeof f=="string"?f.startsWith("@")?l=U(e,t,s,{...r,scope:U(e,t,{...s,path:f.slice(1).split(".")},{...r,scope:f.slice(1)})}):l=B(i,q(e.path,f)):Array.isArray(f)&&(l=B(i,f));}catch(c){o.log(`Error while getting computed scope ${e.toString()}: ${c.message}`,"error");}return l}n(U,"getValueScope");var W=class{static{n(this,"ObserverObject");}descriptor;context;_path;_id="";_initial;_value;_associated=false;_attached=false;_getter;_depends=[];_options;_subscribers=[];_strPath;_error;store;_shadowStore;constructor(t,s,r){this.descriptor=s,this.context=r,this.store=t,this._associated=r!==void 0,this._getter=s.getter,this._options=Object.assign({enable:true,group:"",depends:[],throwError:true},s.options),this._id=this._options.id||(this._associated?M(r?.path):ut()),this._path=r?.path||[`#${this._id}`],this._path||(this._path=[`#${this._id}`]),this._initial=this._options.initial,this.onInitOptions(this._options),this._depends=L(this._path,this._options.depends),this._onObserverCreated(),this._onInitial();}get type(){return this.descriptor.type}get options(){return this._options}get id(){return this._id}get associated(){return this._associated}get async(){return this._options.async}get enable(){return this._options.enable}set enable(t){this._options.enable=t;}set group(t){this._options.group=t;}get group(){return this._options.group}get initial(){return this._initial}set initial(t){this._initial=t;}get path(){return this._path}get attached(){return this._attached}get depends(){return this._depends}set depends(t){this._depends=t;}get getter(){return this._getter}set getter(t){this._getter=t;}get strPath(){return this._strPath||(this._strPath=this._path.join(".")),this._strPath}get error(){return this._error}set error(t){this._error=t;}toString(){return `ObserverObject<${this.strPath}>`}get value(){return this._associated?g(this.store.state,this._path):(this.store._notify({type:"get",path:this.path,value:this._value}),this._value)}set value(t){if(this._associated)j(this.store.state,this._path,t);else {let s=this._value;t!==s&&(this._value=t,this.store._notify({type:"set",path:this.path,value:t,oldValue:s}));}}_onObserverCreated(){typeof this.store.options.onObserverCreated=="function"&&this.store.options.onObserverCreated(this);}_onInitial(){this._options.initial!==void 0&&this.update(this._options.initial,{silent:true}),this.onInitial();}onInitial(){}onInitOptions(t){}update(t,s){this.store.update(()=>{this.value=t;},s);}silentUpdate(t){this.update(t,{silent:true});}watch(t,s){let r=this.store.watch(this.getValueWatchPath(),i=>{t.call(this,i);},s);return this._subscribers.push(r),r}getValueWatchPath(){return this.path.join(".")}emitStoreEvent(t,s){setTimeout(()=>{this.store.emit(t,s);},0);}getDepends(){return this.depends}onDependsChange(t){}attach(){!this._attached&&this.depends&&this.depends.length>0&&(this._subscribers.push(this.store.watch(this.getDepends(),this.onDependsChange.bind(this),{operates:"write"})),this.store.log(()=>`${this.toString()} subscribed to ${this.depends.map(t=>t.join(".")).join(",")}`),this._attached=true);}detach(){this._attached&&(this._subscribers.forEach(t=>{t.off();}),this._attached=false,this._subscribers=[],this.store.watchObjects.delete(this.id));}run(...t){}};var N=class extends W{static{n(this,"ComputedObject");}descriptor;context;constructor(t,s,r){super(t,s,r),this.descriptor=s,this.context=r,s.options.depends=L(this.path,this.options.depends);}toString(){return `ComputedObject<${M(this.path)}>`}get val(){return this.async?this.value.value:this.value}isDisable(t){return !this.store.options.enableComputed||!this.enable&&t!==true||t===false}run(t){throw new Error("Method not implemented.")}};var dt=class extends N{static{n(this,"SyncComputedObject");}get async(){return  false}onInitial(){this.collectDependencies();}run(t){let{first:s,operate:r}=Object.assign({first:false,operate:void 0},t);if(this.error=void 0,!s&&this.isDisable(t?.enable)){this.store.log(`Sync computed <${this.toString()}> is disabled`,"warn");return}!s&&this.store.log(()=>`Run sync computed for : ${this.toString()}`);let i=t?Object.assign({},this.options,t):this.options,o=U(this,"computed",this.context,i),a=i.initial;try{a=this.getter.call(this,o,{operate:r,first:s});}catch(u){this.error=u;}this.onDone(s,a,i);}onDone(t,s,r){let i=s;if(this.error&&O(r.onError)){let o=r.onError(this.error);o!==void 0&&(i=o);}if(t&&(this.initial=i),this.store.peep(()=>{this.value=i;}),this.error){if(!t&&this.emitStoreEvent("computed:error",{id:this.id,path:this.path,error:this.error,computedObject:this}),this.options.throwError)throw this.error}else !t&&this.emitStoreEvent("computed:done",{id:this.id,path:this.path,value:i,computedObject:this});}collectDependencies(){let t=[],s=this.store.watch(r=>{t.push(r.path);},{operates:["get"]});this.run({first:true}),s.off(),Array.isArray(this.options.depends)&&this.options.depends.length>0&&t.push(...L(this.path,this.options.depends)),this.depends=ft(t),this.attach();}onDependsChange(t){this.run({operate:t});}};function Ft(e,t,s,r,i){return s==="push"?(...o)=>{let a=t.length,u=r.apply(t,o);if(t.length>a){let f=Array.from({length:t.length-a},(l,c)=>c+a);e({type:"insert",path:i,indexs:f,value:o,oldValue:void 0,parentPath:i,parent:t});}return u}:s==="pop"?()=>{let o=t.length,a=r.apply(t);return t.length===o-1&&e({type:"remove",path:i,indexs:[o-1],value:[a],oldValue:void 0,parentPath:i,parent:t}),a}:s==="splice"?(o,a,...u)=>{let f=r.apply(t,[o,a,...u]);if(f.length>0){let l=Array.from({length:f.length},(c,p)=>o+p);e({type:"remove",path:i,indexs:l,value:f,oldValue:void 0,parentPath:i,parent:t});}if(u.length>0){let l=Array.from({length:u.length},(c,p)=>o+p);e({type:"insert",path:i,indexs:l,value:u,oldValue:void 0,parentPath:i,parent:t});}return f}:s==="unshift"?(...o)=>{let a=t.length,u=r.apply(t,o);if(t.length>a){let f=Array.from({length:t.length-a},(l,c)=>c);e({type:"insert",path:i,indexs:f,value:o,oldValue:void 0,parentPath:i,parent:t});}return u}:s==="shift"?()=>{let o=t.length,a=r.apply(t);return t.length===o-1&&e({type:"remove",path:i,indexs:[0],value:[a],oldValue:void 0,parentPath:i,parent:t}),a}:s==="fill"?(o,a,u)=>{let f=r.apply(t,[o,a,u]),l=a??0,c=u??t.length,p=Array.from({length:c-l},(d,y)=>y+l),m=Array.from({length:c-l},()=>o);return e({type:"update",path:i,indexs:p,value:m,oldValue:void 0,parentPath:i,parent:t}),f}:s==="concat"?(...o)=>{let a=t.length,u=r.apply(t,o),f=Array.from({length:o.length},(l,c)=>a+c);return e({type:"insert",path:i,indexs:f,value:o,oldValue:void 0,parentPath:i,parent:t}),u}:r}n(Ft,"hookArrayMethods");function Ut(e){return typeof e=="number"||typeof e=="string"&&!Number.isNaN(parseInt(e))}n(Ut,"isNumber");var Ot=Symbol("__NOTIFY__");function re(e){if(this.options.validators){let t=e.join(this.options.delimiter||".");if(this.options.validators[t])return this.options.validators[t];let s=Object.keys(this.options.validators);for(let r of s)if(nt(e,r))return this.options.validators[r]}return this.options.onValidate}n(re,"getValidate");function se(e,t,s,r,i){let o=i?.validate||this._updateValidateBehavior;if(o==="none")return  true;let a=re.call(this,t);if(typeof a!="function")return  true;let u=true,f,l=t.join(this.options.delimiter||"."),c=this.options.configKey?`${this.options.configKey}.${l}`:l;try{if(a.call(this,s,r,t)===!1)throw new k;this.options.configManager&&delete this.options.configManager.errors[c],this.errors&&delete this.errors[c];}catch(p){f=p;let m=this.options?.configManager?.errors||this.errors;m[c]=a.getErrorMessage?.(p)||p.message||p.stack;let d=o||p.behavior||a.onInvalid||this.options.onInvalid||"throw";if(d==="pass")u=true;else if(d==="ignore")u=false;else if(d==="throw-pass")u=p;else throw u=false,p}finally{this.emit("validate",{path:t,newValue:s,oldValue:r,error:f});}return u}n(se,"isValidPass");function Wt(e,t,s,r,i){if(K(e)||typeof e!="object"||e===null)return e;if(s.has(e))return s.get(e);let o=new Proxy(e,{get:n((a,u,f)=>{let l=Reflect.get(a,u,f);if(typeof u!="string")return l;let c=[...t,String(u)];if(typeof l=="function"||!Object.hasOwn(a,u))if(typeof l=="function"){if(Array.isArray(a)&&!Ut(u))return Ft(i.notify,a,u,l,t);if(!K(l)&&Object.hasOwn(a,u)){if(typeof this.options.onObserverInitial=="function")try{if(this.options.onObserverInitial.call(this,c,l,a)===!1)return A(l),l}catch(m){this.log(`onObserverBeforeCreate error: ${m.message}`,"error");}let p=c.join(".");try{if(r.has(p)){let d=[...r.keys(),p];throw r.clear(),new z(`Find circular dependency at <"${c}">, steps: ${d.join(" -> ")}`)}r.set(p,!0);let m=i.createObserverObject(c,l,t,a);return typeof m!="function"&&Reflect.set(a,u,m,f),m}finally{r.delete(p);}}else return l}else return l;return i.notify({type:"get",path:c,indexs:[],value:l,oldValue:void 0,parentPath:t,parent:a}),Wt.call(this,l,c,s,r,i)},"get"),set:n((a,u,f,l)=>{let c=Reflect.get(a,u,l),p=[...t,String(u)],[m,d]=Lt(f),y=se.call(this,o,p,m,c,d);if(y){let _=Reflect.set(a,u,m,l);if(u===Ot)return  true;let V=p.join(this.options.delimiter||"."),zt=this.options.configKey?`${this.options.configKey}.${V}`:V;if(_&&this.configManager&&this.configurabled.has(V)&&setTimeout(()=>{this.configManager.onUpdate(this,zt,m);},0),_&&!d?.slient&&u!==Ot&&m!==c&&i.notify({type:Array.isArray(a)?"update":"set",path:p,indexs:[],value:m,oldValue:c,parentPath:t,parent:a}),y instanceof Error)throw y;return _}else return  true},"set"),deleteProperty:n((a,u)=>{let f=a[u],l=[...t,String(u)],c=Reflect.deleteProperty(a,u);return c&&u!==Ot&&i.notify({type:"delete",path:l,indexs:[],value:f,oldValue:void 0,parentPath:t,parent:a}),c},"deleteProperty")});return s.set(e,o),o}n(Wt,"createProxy");function Nt(e,t){let s=new Map,r=new WeakMap;return Wt.call(this,e,[],r,s,t)}n(Nt,"createReactiveObject");async function Et(e){return new Promise((t,s)=>setTimeout(t,e))}n(Et,"t");function Gt(e){return e instanceof Error?e:new Error(e)}n(Gt,"getError");var mt=class extends N{static{n(this,"AsyncComputedObject");}_isRunning=false;_defaultAbortController=null;_userAbortController;_firstRun=false;get async(){return  true}get value(){return super.value}set value(t){super.value=t;}get running(){return this._isRunning}onInitOptions(t){t.reentry===void 0&&(t.reentry=this.store.options.reentry);}onInitial(){this.initial=this.createAsyncComputedValue(),this.attach(),setTimeout(()=>{(this.options.immediate===true||this.options.immediate==="auto"&&this.options.initial===void 0)&&this.run({first:true});},0);}createAsyncComputedValue(){return Object.assign({[et]:true,loading:false,timeout:0,retry:0,error:null,value:this.options.initial,progress:0,run:A(t=>this.store.computedObjects.run(this.id,Object.assign({},t))),cancel:A(()=>{this.getAbortController().abort();})})}updateComputedValue(t){let s=this.strPath,r=Object.keys(t).length;if(this.associated)this.store.update(i=>{Pt(i,this.path,t);},{batch:r>1?s:false});else {Object.assign(this.value,t);let i=r>1,o=[];Object.entries(t).forEach(([a,u])=>{let f={type:"set",path:[...this.path,a],value:u,parent:this.value};i&&(f.reply=true),this.store.operates.emit(`${this.strPath}.${a}`,f),o.push(f);}),i&&this.store.operates.emit(this.strPath,{type:"batch",path:this.path,value:o});}}async run(t){let{first:s}=t??{};if(this.isDisable(t?.enable)){this.store.log(()=>`Async computed <${this.toString()}> is disabled`,"warn");return}this.error=void 0,this._firstRun=true,!s&&this.store.log(()=>`Run async computed for : ${this.toString()}`);let r=t?Object.assign({first:s},this.options,t):this.options,i=U(this,"computed",this.context,r),{reentry:o}=r;if(this._isRunning&&!o){this.store.log(()=>`Async computed: ${this.toString()} is running, can't reentry`,"warn"),this.emitStoreEvent("computed:cancel",{path:this.path,id:this.id,reason:"reentry",computedObject:this});return}this._isRunning=true;try{return await this.executeGetter(i,r)}finally{this._isRunning=false;}}createComputeProgressbar(t){let{max:s=100,min:r=0,value:i=0}=Object.assign({},t);return this.updateComputedValue({progress:i}),{value:n(o=>{o>s&&(o=s),o<r&&(o=r),this.updateComputedValue({progress:o});},"value"),end(){this.value(s);}}}getAbortController(t){if(t&&typeof t.abortController=="function"){let s=t.abortController();s&&s instanceof AbortController&&(this._userAbortController=s);}return this._userAbortController?this._userAbortController:(this._defaultAbortController||(this._defaultAbortController=new AbortController),this._defaultAbortController.signal.aborted&&(this._defaultAbortController=new AbortController),this._defaultAbortController)}setTimeoutControl(t,s,r){let{timeout:i}=r,[o=0,a=0]=Array.isArray(i)?i:[i,0],u,f;return o>0&&(s.timeout=a>1?a:o,f=setTimeout(()=>{t.hasTimeout=true,t.hasError=true,t.error="TIMEOUT",typeof t.timeoutCallback=="function"&&t.timeoutCallback(),clearInterval(u),this.updateComputedValue({loading:false,error:"TIMEOUT",timeout:0});},o),a>1&&(u=setInterval(()=>{this.updateComputedValue({timeout:a--}),a===0&&clearInterval(u);},o/(a+1)))),{clear:n(()=>{clearTimeout(f),clearInterval(u);},"clear"),enable:o>0}}async executeGetter(t,s){let{retry:r=[0,0]}=s,[i,o]=Array.isArray(r)?r:[Number(r),0],a,u=this.getAbortController(s),f={onTimeout:n(d=>{a=d;},"onTimeout"),getProgressbar:this.createComputeProgressbar.bind(this),getSnap:n(d=>d,"getSnap"),cancel:u.abort,extras:s.extras,operate:s.operate,first:s.first,abortSignal:u.signal},l={error:null,hasError:false,hasTimeout:false,hasAbort:false,timeoutCallback:a};u.signal.addEventListener("abort",()=>{l.hasAbort=true;});let c={clear:n(()=>{},"clear"),enable:false},p,m=n(d=>Object.assign(l,d),"updateCtx");for(let d=0;d<i+1;d++){let y={};try{let _={loading:!0};if(l.hasError&&(_.error=null),i>0&&(_.retry=d>0?i-d+1:0),d>0&&m({error:null,hasError:!1,hasTimeout:!1}),c=this.setTimeoutControl(l,_,s),this.updateComputedValue(_),l.hasAbort)throw new G;if(p=await this.getter.call(this,t,f),l.hasAbort)throw new G;l.hasTimeout||(y.value=p,c.enable&&(y.timeout=0));}catch(_){if(l.hasError=true,l.error=_,l.hasTimeout||(y.error=Gt(_).message),O(s.onError)){let V=s.onError(_);V!==void 0&&(y.value=V);}}finally{c.clear(),d===i&&(l.hasTimeout&&(y.error=l.error),i>0&&(y.retry=0)),y.loading=false,this.updateComputedValue(y);}l.hasError&&i>0&&o>0&&d<i&&await Et(o);}l.hasAbort?this.emitStoreEvent("computed:cancel",{path:this.path,id:this.id,computedObject:this}):l.hasError||l.hasTimeout?(this.error=l.error,this.emitStoreEvent("computed:error",{path:this.path,id:this.id,error:l.error,computedObject:this})):this.emitStoreEvent("computed:done",{path:this.path,id:this.id,value:p,computedObject:this}),this.onDoneCallback(s,l.error,l.hasAbort,l.hasTimeout,t,p);}onDoneCallback(t,s,r,i,o,a){typeof t.onDone=="function"&&t.onDone.call(this,{id:this.id,path:this.path,value:a,error:s,abort:r,timeout:i,scope:o});}onDependsChange(t){this.store.log(()=>`AsyncComputed<${this.id}> is running by depends ${t.type}/${t.path.join(".")} operate `),this.run({operate:t,first:!this._firstRun});}getValueWatchPath(){let t=this.path.join(".");return [`${t}.*`,t]}getDepends(){return super.getDepends().map(s=>{if(s.length===0)return s;for(let r of this.store.computedObjects.values())if(w(r.path,s)&&r.async)return [`${s}.value`];return s})}};function Ht(){let e=arguments[0],t=typeof arguments[1]=="function"?arguments[1]:()=>true,s=typeof arguments[1]=="object"?arguments[1]:arguments[2],r=Object.assign({depends:[],enable:true,objectify:true,filter:t},s),i=n(()=>({type:"watch",getter:e,options:r}),"descriptorBuilder");return i[I]=true,i}n(Ht,"watch");var gt=class extends Map{static{n(this,"WatchObjects");}store;_watcher={off:n(()=>{},"off")};_enable=true;constructor(t){super(),this.store=t;}get enable(){return this._enable}set enable(t){this._enable=t;}set(t,s){return super.size===0&&this.createWacher(),super.set(t,s)}createWacher(){this._watcher=this.store.watch("**",({path:t,value:s})=>{if(!this._enable)return;let r=t[0].startsWith("#")?s:g(this.store.state,t);for(let i of this.values())i.isMatched(t,r)&&i.run(t,r);});}reset(){this._watcher&&this._watcher.off();for(let t of this.values())t.reset();this.createWacher();}create(){let t=v(arguments[0])?arguments[0]:Ht(...arguments)();return this.store._createWatch(t)}enableGroup(t,s=true){for(let r of this.values())r.options.group===t&&(r.options.enable=s);}};var yt=class extends W{static{n(this,"WatchObject");}store;context;_cache;constructor(t,s,r){if(super(t,s,r),this.store=t,this.context=r,typeof this.options.filter!="function")throw new Error("watch options.filter must be a function")}get filter(){return this.options.filter}get cache(){return this._cache||(this._cache={}),this._cache}toString(){return `WatchObject<${this.id}>`}onInitial(){}isMatched(t,s){return ot(t,this.path)?false:this.filter(t,s)}reset(){this._cache={},this.value=this.initial;}run(t,s){if(!this.enable){this.store.log(`WatchObject <${this.toString()}> is disabled`);return}try{let r=this.getter?.call(this,{path:t,value:s},this);this.value=r,this.emitStoreEvent("watch:done",{value:r,watchObject:this});}catch(r){this.emitStoreEvent("watch:error",{error:r,watchObject:this});}}};function vt(e,t){return new Proxy(e,{get(r,i,o){return i==="on"?(a,u,f)=>e.on(`${t}${"."}${a}`,(l,c)=>u(l,c.slice(t.length+1)),f):i==="once"?(a,u)=>e.once(`${t}${"."}${a}`,(f,l)=>{u(f,l.slice(t.length+1));}):i==="off"?(a,u)=>e.off(`${t}${"."}${a}`,u):i==="emit"?(a,u)=>e.emit(`${t}${"."}${a}`,u):i==="wait"?async(...a)=>{if(typeof a[0]=="string")return a[0]=`${t}${"."}${a[0]}`,e.wait(...a);if(typeof a[0]=="function"){let u=a[0];return a[0]=(f,l)=>{f.startsWith(t)&&u(f.slice(t.length+1),l);},e.wait(...a)}}:i==="offAll"?()=>{for(let[a]of e.listeners.entries())a!=="*"&&typeof a=="string"&&a.startsWith(`${t}.`)&&e.listeners.delete(a);}:i==="onAny"?a=>e.on(`${t}${"."}**`,(u,f)=>{a(u,f.slice(t.length+1));}):i==="scope"?a=>vt(e,`${t}${"."}${a}`):Reflect.get(r,i,o)}})}n(vt,"createEventEmitterScope");var Y=class{static{n(this,"EventEmitter");}_listeners=new Map;get listeners(){return this._listeners}on(){let t=arguments[0],s=arguments[1],r=arguments[2],i=s;return t==="**"?this.addHandler("*",i,r):String(t).includes("*")?(i=n((o,a)=>{nt(a,t)&&s(o,a);},"phandler"),this.addHandler("*",i,r)):this.addHandler(t,i,r),{off:n(()=>this.off(t,i),"off")}}addHandler(t,s,r){let i=this._listeners.get(t);i?r?i.unshift(s):i.push(s):this._listeners.set(t,[s]);}once(t,s){let r=n((i,o)=>{try{s(i,o);}finally{this.off(o,r);}},"plistener");return this.on(t,r)}off(t,s){String(t).includes("*")&&(t="*");let r=this._listeners.get(t);r&&(s?r.splice(r.indexOf(s)>>>0,1):this._listeners.set(t,[]));}offAll(){this._listeners.clear();}onAny(t){return this.on("**",t)}wait(){let t=typeof arguments[0],s=t==="string"?arguments[0]:void 0,r=arguments[1]||0,i=t==="function"?t:void 0,o;return new Promise((a,u)=>{let f;s?f=this.once(s,l=>{clearTimeout(o),a(l);}):typeof i=="function"&&(f=this.onAny((l,c)=>{i(c,l)!==false&&(f.off(),clearTimeout(o),a(l));})),r>0&&(o=setTimeout(()=>{f.off(),u(new Error("timeout"));},r));})}emit(t,s){let r=this._listeners.get("*");r&&r.slice().map(i=>i(s,t)),r=this._listeners.get(t),r&&r.slice().map(i=>i(s,t));}scope(t){return vt(this,t)}};function Kt(e){let t;return $(e)?t=e():typeof e=="function"&&(t={type:"computed",getter:e,options:Object.assign({},st(),{async:rt(e)})}),t}n(Kt,"getObserverDescriptor");function wt(e,t){if(t==="*")return  true;if(t==="write"){if(e.type==="get")return}else if(t==="read"){if(e.type!=="get")return}else if(Array.isArray(t)&&t.length>0&&!t.includes(e.type))return;return  true}n(wt,"isMatchOperates");function qt(e,t=()=>{}){e=e.replace(/^\s*`{3,}\w*(?:\r?\n|\n)/,"").replace(/^\s*`+\s*/,""),e=e.replace(/\s*`{3,}\s*$/,"").replace(/\s*`+\s*$/,""),e=e.replace(/^[\f\t\r\n]+/,""),e=e.replace(/^[\\]+(?=(?:async|function|\(|[A-Za-z_$]))/,"");let s=/^\s*(async\s+)?function(?:\s+\w+)?\s*\(([^)]*)\)\s*\{([\s\S]*)\}\s*;?\s*$/m.exec(e),r=/^\s*(async\s+)?\(([^)]*)\)\s*=>\s*(?:\{([\s\S]*)\}|(.+))\s*;?\s*$/m.exec(e),i=/^\s*(async\s+)?([A-Za-z_$][\w$]*)\s*=>\s*(?:\{([\s\S]*)\}|(.+))\s*;?\s*$/m.exec(e);if(!s&&!r&&!i)return;let o=false,a=[],u="";if(s){let[,c,p,m]=s;o=!!c,a=(p||"").split(",").map(d=>d.trim()).filter(Boolean),u=m;}else if(r){let[,c,p,m,d]=r;o=!!c,a=(p||"").split(",").map(y=>y.trim()).filter(Boolean),u=m||`return ${d}`;}else if(i){let[,c,p,m,d]=i;o=!!c,a=p?[p]:[],u=m||`return ${d}`;}let f=Object.getPrototypeOf(async function(){}).constructor,l=o?f:Function;try{return new l(...a,u)}catch{return t}}n(qt,"parseFunc");var _t=class extends Y{static{n(this,"AutoStore");}_data;_errors;computedObjects;watchObjects;_operates=new Y;_options;_silenting=false;_batching=false;_batchOperates=[];_updateFlags=0;_peeping=false;_updateValidateBehavior;_updatedState;_updatedWatcher;_delimiter=".";_configurabled;types={rawState:void 0,state:void 0};constructor(t,s){super(),this._options=Object.assign({id:ut(),debug:false,enableComputed:true,reentry:true,resetable:false,delimiter:".",log:Bt},s),this._options.configManager==null&&globalThis[H]&&(this._options.configManager=globalThis[H]),this._delimiter=this._options.delimiter,this.computedObjects=new ht(this),this.watchObjects=new gt(this),this.subscribeCallbacks(),this._data=Nt.call(this,t||{},{notify:this._notify.bind(this),createObserverObject:this.createObserverObject.bind(this)}),this.getSnap=this.getSnap.bind(this),this.watch=this.watch.bind(this),this.update=this.update.bind(this),this.peep=this.peep.bind(this),this.silentUpdate=this.silentUpdate.bind(this),this.batchUpdate=this.batchUpdate.bind(this),this.trace=this.trace.bind(this),this.collectDependencies=this.collectDependencies.bind(this),this.installExtends(),lt(this._data,this._onFirstEachState.bind(this)),this._options.resetable&&(this.resetable=true),this._options.debug&&typeof globalThis.__AUTOSTORE_DEVTOOLS__=="object"&&globalThis.__AUTOSTORE_DEVTOOLS__.add(this),this.emit("load",this);}get id(){return this._options.id}get state(){return this._data}get operates(){return this._operates}get configurabled(){return this._configurabled||(this._configurabled=new Set),this._configurabled}get errors(){return this._errors||(this._errors={}),this._errors}get options(){return this._options}get silenting(){return this._silenting}get delimiter(){return this._delimiter}get batching(){return this._batching}get peeping(){return this._peeping}get resetable(){return this._options.resetable}get configManager(){return this.options.configManager}set resetable(t){if(t){if(this._updatedWatcher)return;this._updatedState={},this._updatedWatcher=this.watch(({path:s,oldValue:r})=>{if(s.length===0)return;let i=s.join(this._delimiter);!i.startsWith("#")&&!(i in this._updatedState)&&(this._updatedState[i]=r);},{operates:"write"});}else this._updatedWatcher&&(this._updatedWatcher.off(),this._updatedWatcher=void 0),this._updatedState={};this._options.resetable=t;}reset(t){if(this._options.resetable&&this._updatedState)try{this.batchUpdate(s=>{let r=t?`${t}${this._delimiter}`:"";Object.entries(this._updatedState).forEach(([i,o])=>{i.startsWith(r)&&j(s,i.split(this._delimiter),o);});});}finally{this.emit("reset",t);}else this.log("resetable option is not enabled","warn");}_onFirstEachState({value:t,path:s}){typeof t=="string"&&t.startsWith("```")&&t.endsWith("```")&&this.update(r=>{let i=qt(t.slice(3,t.length-3));A(i),j(r,s,i);},{silent:true});}log(t,s){this._options.debug&&this.options.log.call(this,t,s);}installExtends(){let t=globalThis.__AUTOSTORE_EXTENDS__;Array.isArray(t)&&t.forEach(s=>{typeof s=="function"&&s(this);});}subscribeCallbacks(){this._options.onComputedCreated&&this.on("computed:created",this._options.onComputedCreated.bind(this)),this._options.onComputedDone&&this.on("computed:done",this._options.onComputedDone.bind(this)),this._options.onComputedError&&this.on("computed:error",this._options.onComputedError.bind(this)),this._options.onComputedCancel&&this.on("computed:cancel",this._options.onComputedCancel.bind(this)),this._options.onObserverBeforeCreate&&this.on("observer:beforeCreate",this._options.onObserverBeforeCreate.bind(this));}_notify(t){this._peeping&&t.type==="get"||(this._batching&&this._batchOperates.push(t),!this._silenting&&(t.flags=this._updateFlags,this.operates.emit(t.path.join(this._delimiter),t)));}watch(){let t=typeof arguments[0]=="function"||["*","**"].includes(arguments[0])||Array.isArray(arguments[0])&&arguments[0].length===0,s=typeof arguments[0]=="function"?arguments[0]:arguments[1],r=arguments.length>=2&&typeof arguments[arguments.length-1]=="object"?arguments[arguments.length-1]:void 0,i=n((o,a)=>u=>{if(wt(u,o)&&!(typeof a=="function"&&!a(u)))try{if(this._peeping=!0,u.type==="batch"){let f=u.value.filter(l=>wt(l,o));if(f.length>0)u.value=f;else return}s(u);}finally{this._peeping=false;}},"createEventHandler");if(t){let{operates:o,filter:a}=Object.assign({once:false,operates:"write"},r),u=i(o,a);return this.operates.onAny(u)}else {let o=arguments[0],a=Array.isArray(o)?o.map(d=>typeof d=="string"?d:d.join(this._delimiter)):[o],{once:u,operates:f,filter:l}=Object.assign({once:false,operates:"write"},r),c=u?this.operates.once.bind(this.operates):this.operates.on.bind(this.operates),p=[],m=i(f,l);return a.forEach(d=>{p.push(c.call(this,d,m));}),{off:n(()=>p.forEach(d=>{d.off();}),"off")}}}createObserverObject(t,s,r,i){if(this.options.configManager&&pt(s)){let o=this.options.configManager.add(this,t,s);return this.configurabled.add(t.join(this.options.delimiter)),o}else {let o=Kt(s),a={path:t,value:s,parentPath:r,parent:i};if(o){if(o.type==="computed")return this._createComputed(o,a)?.initial;if(o.type==="watch")return this._createWatch(o,a)?.initial}else return s}}_createComputed(t,s){let r;return this.emit("observer:beforeCreate",t),t.options.async?r=new mt(this,t,s):r=new dt(this,t,s),r&&(r.silentUpdate(r.initial),r.options.objectify&&this.computedObjects.set(r.id,r),this.emit("computed:created",r),this.emit("observer:afterCreate",t)),r}_createWatch(t,s){this.emit("observer:beforeCreate",t);let r=new yt(this,t,s);return this.watchObjects.set(r.id,r),this.emit("watch:created",r),this.emit("observer:afterCreate",t),r}silentUpdate(t){this.update(t,{silent:true});}batchUpdate(t){this.update(t,{batch:true,validate:"pass"});}update(t,s){let{batch:r=false,reply:i=true,silent:o=false,peep:a=false,flags:u=0,validate:f}=s||{};if(typeof t=="function"){this._updateFlags=u,this._updateValidateBehavior=f,o&&(this._silenting=true),r&&(this._batching=true,this._silenting=true),a&&(this._peeping=true);try{let l=t(this.state);if(r&&Dt(l))throw new Error("Batch update method can't be async function")}finally{this._silenting=false,this._batching=false,this._peeping=false,this._updateFlags=0,this._updateValidateBehavior=void 0,this.replyBatchOperates(i,r);}}else throw new Error("update method must provide a function argument")}replyBatchOperates(t,s){if(this._batchOperates.length>0){let r=[...this._batchOperates];this._batchOperates=[],t&&r.forEach(i=>{i.reply=true,this._notify(i);});try{let i=s===!0?Ct:String(s);this.operates.emit(i,{type:"batch",path:[i],value:r});}finally{this._batchOperates=[];}}}peep(){let t=typeof arguments[0]=="function"?()=>arguments[0](this.state):()=>g(this.state,Array.isArray(arguments[0])?arguments[0]:arguments[0].split(this._delimiter));this._peeping=true;try{return t()}finally{this._peeping=false;}}collectDependencies(t,s="*"){let r=[],i=this.watch(o=>{r.push(o.path);},{operates:s});try{t();}finally{i.off();}return ft(r)}trace(t,s="*"){let r;return {stop:n(()=>r?.off(),"stop"),start:n(async i=>{let o=[];return new Promise(a=>{r=this.watch(u=>{o.push(u),i?.(u)&&(r.off(),a(o));},{operates:s}),Promise.resolve(t()).finally(()=>{typeof i!="function"&&(r.off(),a(o));});})},"start")}}destroy(){this.offAll(),this._operates.offAll(),this.watchObjects.clear(),this.computedObjects.clear(),this.emit("unload",this);}getSnap(t){let{reserveAsync:s,entry:r,includeFunc:i}=Object.assign({reserveAsync:true},t);return ct(r?g(this._data,r):this._data,{reserveAsync:s,includeFunc:i})}get(t,s){let{defaultValue:r,timeout:i=0,expandAsync:o=false,waitAsyncDone:a=false}=Object.assign({},s),u=Array.isArray(t)?t:t.split(this.delimiter),f=g(this.state,u,r);return b(f)?f.loading&&a?new Promise((l,c)=>{let p,m;i>0&&(p=setTimeout(()=>{m?.off(),c(new C);},i)),m=this.on("computed:done",({path:d})=>{w(u,d)&&(clearTimeout(p),m?.off(),l(o?f.value:f));});}):o?f.value:f:f}toString(){return `AutoStore<${this.id}>`}};var Yt=class extends _t{static{n(this,"ConfigManager");}source;dirtyValues={};_reseting=false;constructor(t,s){let r=Object.assign({global:false},s);if(super({},r),this.source=t,r.global!==false){let i=r.global===true?H:r.global;globalThis[i]=this;}}get options(){return super.options}get fields(){return this.state}get size(){return Object.keys(this.fields).length}async load(){let t=await this.source.load();this.update(s=>{Object.entries(t).forEach(([r,i])=>{let o=s[r];o?o.value=i:s[r]={value:i};});},{silent:true});}async save(t){let s=t?this._getValues():this.dirtyValues;Object.keys(s).length>0&&(await this.source.save?.(s),this.dirtyValues={});}_getValues(){return Object.entries(this.state).reduce((t,[s,r])=>(t[s]=r.value,t),{})}reset(){if(!this._reseting)try{this._reseting=!0,this.dirtyValues={},Object.values(this.state).forEach(t=>{try{let s=t.schema.default;s!==void 0&&(t.value=Mt(s,{slient:!0,validate:"none"}));}catch{}});}finally{this._reseting=false;}}onUpdate(t,s,r){this.dirtyValues[s]=r,this.source.save?.(this.dirtyValues),this.dirtyValues={};}add(t,s,r){let i=pt(r)?r():r,o=Array.isArray(s)?s:s.split(t.options.delimiter),a=o.join(t.options.delimiter),u=[...o];t.options.configKey&&u.splice(0,0,t.options.configKey);let f=i.value;if(i.schema.default===void 0&&(i.schema.default=f),t.options.defaultSchema&&Object.keys(t.options.defaultSchema).forEach(l=>{let c=t.options.defaultSchema[l];i.schema[l]===void 0&&(i.schema[l]=c);}),i.schema.onInvalid===void 0&&(i.schema.onInvalid="throw"),O(i.schema.onValidate)){i.schema.onValidate.getErrorMessage=c=>{let p=i.schema.invalidTips;return typeof p=="string"?p.params(i.schema).params({error:c.message,stack:c.stack}):c.message};let l=i.schema.onInvalid;l!==void 0&&(i.schema.onValidate.onInvalid=l),t.options.validators||(t.options.validators={}),t.options.validators[a]=i.schema.onValidate;}else t.options.validators&&delete t.options.validators[a];return this._createValueProxy(i,t,o),this.update(l=>{j(l,[u.join(".")],i);},{silent:true}),f}_createValueProxy(t,s,r){let i=new WeakRef(s);return Object.defineProperty(t,"value",{get(){let o=i.deref();if(o)return g(o.state,r)},set(o){i.deref()?.update(u=>{j(u,r,o);});}})}getConfigValue(t){return this.peep(s=>g(s,[...t,"value"]))}};function ie(e){It(e)&&lt(e,({value:t,key:s,parent:r})=>{O(t)&&(s.startsWith("on")||s.startsWith("render")||s.startsWith("to"))&&(r[s]=A(t));});}n(ie,"markRawSchema");function oe(e){let t={value:e[0],schema:Object.assign({onInvalid:void 0},e[1])};return ie(t.schema),t}n(oe,"parseSchemaArgs");function Xt(e,t){let s=oe([e,t]),r=e;typeof r=="object"&&A(r),s.schema.datatype=Array.isArray(r)?"array":typeof r;let i=n(()=>({value:r,schema:s.schema}),"builder");return i[D]=true,i}n(Xt,"schema");var Hu=Xt;function T(e,t){return n(function(r,i){let o=Object.assign({},i);return typeof o.onValidate!="function"&&(o.onValidate=e),o.invalidTips||(o.invalidTips=t),Xt(r,o)},"typeSchema")}n(T,"createTypeSchemaBuilder");var ne={number:T(e=>typeof e=="number","must be a number"),string:T(e=>typeof e=="string","must be a string"),boolean:T(e=>typeof e=="boolean","must be a boolean"),date:T(e=>e instanceof Date,"must be a date"),bigint:T(e=>typeof e=="bigint","must be a bigint"),array:T(e=>Array.isArray(e),"must be an array"),object:T(e=>typeof e=="object","must be an object")},Ku=ne;exports.ASYNC_COMPUTED_VALUE=et;exports.AbortError=G;exports.AsyncComputedObject=mt;exports.AutoStore=_t;exports.AutoStoreError=E;exports.BATCH_UPDATE_EVENT=Ct;exports.ComputedObject=N;exports.ComputedObjects=ht;exports.ConfigManager=Yt;exports.CyleDependError=z;exports.DELETE_FLAG=Sr;exports.EMPTY=jr;exports.EventEmitter=Y;exports.GLOBAL_CONFIG_MANAGER=H;exports.InvalidComputedArgumentsError=Z;exports.InvalidDependsError=Q;exports.InvalidScopeError=J;exports.OBSERVER_DESCRIPTOR_BUILDER_FLAG=I;exports.OBSERVER_DESCRIPTOR_FLAG=Rt;exports.ObserverObject=W;exports.ObserverScopeRef=F;exports.PATH_DELIMITER=h;exports.SKIP_PROXY_FLAG=tt;exports.SyncComputedObject=dt;exports.TimeoutError=C;exports.VALUE_SCHEMA_BUILDER_FLAG=D;exports.ValidateError=k;exports.WITH_SCHEMA_VALUE=$t;exports.WatchObject=yt;exports.WatchObjects=gt;exports.calcDependPaths=L;exports.computed=it;exports.configurable=Hu;exports.createAsyncComptuedValue=Zi;exports.createObserverObject=$i;exports.createTypeSchemaBuilder=T;exports.defineExtend=Vi;exports.delay=ei;exports.forEachObject=lt;exports.getAsyncVal=qi;exports.getComputedId=Hs;exports.getDepends=pi;exports.getId=ut;exports.getMapVal=at;exports.getSchemaValue=Lt;exports.getSnap=kt;exports.getSnapshot=ct;exports.getVal=g;exports.isAbsolutePath=At;exports.isAsyncComputedValue=b;exports.isComputedDescriptorParameter=Ui;exports.isEq=ot;exports.isFunction=O;exports.isMap=P;exports.isObserverDescriptor=v;exports.isObserverDescriptorBuilder=$;exports.isPathEq=w;exports.isPathMatched=nt;exports.isPlainObject=It;exports.isPrimitive=ji;exports.isPromise=Dt;exports.isProxy=gs;exports.isRaw=K;exports.isRelPath=so;exports.isSchemaBuilder=pt;exports.isValueSchema=to;exports.isWithSchemaValue=te;exports.joinValuePath=M;exports.markRaw=A;exports.noRepeat=ft;exports.normalizeDeps=xt;exports.pathIsExists=yi;exports.pathStartsWith=ni;exports.s=Ku;exports.schema=Xt;exports.schemas=ne;exports.setVal=j;exports.updateObjectVal=Pt;exports.watch=Ht;exports.withSchema=Mt;return exports;})({});//# sourceMappingURL=index.global.js.map
//# sourceMappingURL=index.global.js.map