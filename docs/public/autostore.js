var AutoStoreSpaces=(function(exports){'use strict';var Nt=Object.defineProperty;var n=(e,t)=>Nt(e,"name",{value:t,configurable:true}),j=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,s)=>(typeof require<"u"?require:t)[s]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')});var O=class extends Error{static{n(this,"AutoStoreError");}},W=class extends O{static{n(this,"AbortError");}},v=class extends O{static{n(this,"TimeoutError");}},q=class extends O{static{n(this,"CyleDependError");}},Y=class extends O{static{n(this,"InvalidComputedArgumentsError");}},X=class extends O{static{n(this,"InvalidScopeError");}},z=class extends O{static{n(this,"InvalidDependsError");}},U=class extends O{static{n(this,"ValidateError");}};var Z="__AS_SKIP_PROXY__",R="__AS_OBSERVER_DESCRIPTOR_BUILDER__",wt="__AS_OBSERVER_DESCRIPTOR__",h=".",jt="__batch_update__",J="__AS_ASYNC_COMPUTED_VALUE__",Qt="__AS_EMPTY__",C="__AS_VALUE_SCHEMA__",kt="__AS_DELETE_FLAG__";function Q(e){return e.constructor.name==="AsyncFunction"}n(Q,"isAsyncFunction");function gt(e){return e?e.map(t=>Array.isArray(t)?t:typeof t=="string"?["/","./","../"].some(s=>t.startsWith(s))?t:t.includes(".")?t.split("."):t.split("."):[]):[]}n(gt,"normalizeDeps");function k(){return {async:false,enable:true,timeout:0,depends:[],immediate:"auto",extras:void 0,objectify:true}}n(k,"getDefaultComputedOptions");function tt(){let e=arguments[0];if(typeof e!="function")throw new Error("computed getter must be a function");let t=[],s=Object.assign({},k());if(arguments.length===1)t=[];else if(arguments.length===2)if(Array.isArray(arguments[1]))s.depends=arguments[1];else if(typeof arguments[1]=="object")Object.assign(s,arguments[1]),s.depends=gt(s.depends);else throw new Y;else arguments.length>=3&&(t=gt(arguments[1]),Object.assign(s,arguments[2]),s.depends=t);s.async=s.async===true||Q(e)||arguments.length>=2&&Array.isArray(arguments[1]);let r=n(()=>({type:"computed",getter:e,options:s,[wt]:true}),"descriptorBuilder");return r[R]=true,r}n(tt,"computed");function _t(e){return e?e.some(t=>typeof t=="string"?t.startsWith("./")||t.startsWith("../")||t.startsWith("@")?false:!["CURRENT","SELF","PARENT"].includes(t):true):false}n(_t,"isAbsolutePath");function E(e){return typeof e=="object"&&e.hasOwnProperty("type")&&typeof e.type=="string"&&e.hasOwnProperty("getter")&&typeof e.getter=="function"&&e.hasOwnProperty("options")&&typeof e.options=="object"}n(E,"isObserverDescriptor");function N(e){try{return e[Z]===!0}catch{}return  false}n(N,"isRaw");function et(e,t){if(e===t)return  true;if(e===null||t===null||typeof e!=typeof t)return  false;if(typeof e=="object"){if(Array.isArray(e)&&Array.isArray(t))return e.length!==t.length?false:e.every((s,r)=>et(s,t[r]));if(!Array.isArray(e)&&!Array.isArray(t)){let s=Object.keys(e);return s.length!==Object.keys(t).length?false:s.every(r=>et(e[r],t[r]))}else return  false}return  false}n(et,"isEq");function D(e){return toString.call(e)==="[object Map]"}n(D,"isMap");function w(e,t){return !e||!t||e.length!==t.length?false:e.every((s,r)=>s===t[r])}n(w,"isPathEq");function St(e,t){let s=Array.isArray(e)?e:e.split("."),r=Array.isArray(t)?t:t===""?[]:t.split(".");return r.length===0||w(s,r)?true:(r[r.length-1]==="**"&&(r[r.length-1]="*",r.splice(r.length-1,0,...Array.from({length:s.length-r.length}).fill("*"))),s.length!==r.length?false:r.every((o,a)=>o==="*"||o==="**"?true:o===s[a]))}n(St,"isPathMatched");function Tt(e){return e==null||typeof e!="object"?false:Object.prototype.toString.call(e)==="[object Object]"}n(Tt,"isPlainObject");function b(e){return e&&typeof e=="object"&&e.hasOwnProperty(J)}n(b,"isAsyncComputedValue");function vt(e){try{return !!e&&(typeof e=="object"||typeof e=="function")&&typeof e.then=="function"&&typeof e.catch=="function"&&(e instanceof Promise||Object.prototype.toString.call(e)==="[object Promise]")}catch{return  false}}n(vt,"isPromise");function V(e){return typeof e=="function"&&e[R]===true}n(V,"isObserverDescriptorBuilder");function Ne(e){return typeof e=="object"&&e!==null&&!("__isProxy"in e)}n(Ne,"isProxy");function rt(e,t){let s=e.get(t);if(s!==void 0)return s;let r=e.get(Number(t)||t);if(r!==void 0)return r}n(rt,"getMapVal");function _(e,t,s){if(!t||t.length===0)return e;let r=Array.isArray(t)?t:t.split("."),i,o=e;for(let a=0;a<r.length;a++){let u=r[a];if(D(o))i=rt(o,u);else if(u in o)i=o[u];else return s;o=i;}return i}n(_,"getVal");function y(e){try{["object","function"].includes(typeof e)&&(e[Z]=!0);}catch{}return e}n(y,"markRaw");function S(e,t,s,r){if(!t||!e)return e;let i=t;if(i.length===0)return typeof e=="object"&&Object.assign(e,s),e;{let o=e,a=[],u=n((f,c,l)=>{r&&b(f[c])?f[c].value=l:f[c]=l;},"update");for(let f=0;f<i.length;f++){let c=i[f];if(a.push(c),o)if(Array.isArray(o)){let l=parseInt(c,10);if(Number.isNaN(l)||l<0)throw new Error(`setVal: invalid array index ${a.join(".")}`);f===i.length-1?u(o,l,s):o=o[l];}else o instanceof Map||o instanceof WeakMap?f===i.length-1?o.set(c,s):(o.has(c)||o.set(c,{}),o=o.get(c)):typeof o=="object"&&c in o?f===i.length-1?u(o,c,s):o=o[c]:(o[c]=f===i.length-1?s:{},o=o[c]);else o[c]=f===i.length-1?s:{},o=o[c];}}return e}n(S,"setVal");function I(e){return (e||["ROOT"]).map(t=>Array.isArray(t)?t.join("."):t).join(".")}n(I,"joinValuePath");function st(){return Math.random().toString(36).slice(2)}n(st,"getId");function H(e,t,s){let r=e&&!e[0].startsWith("#");if(Array.isArray(t))return t;if(t==="self")return r?e:void 0;if(t==="root")return r?[]:void 0;if(t==="parent")return r?e.slice(0,-2):void 0;if(t==="current")return r?e.slice(0,-1):void 0;if(typeof t=="string")return t.startsWith("./")?r?[...e.slice(0,-1),...t.slice(2).split(".")]:void 0:t.startsWith("../")?r?H(e.slice(0,-1),t.slice(3),true):void 0:t.startsWith("/")?t.replace(/^(\/)*/,"").split("."):r&&s?[...e.slice(0,-1),...t.split(".")]:t.split(".")}n(H,"getFullValuePath");function P(e,t){return t?t.map(s=>H(e,s)).filter(s=>s!==void 0):[]}n(P,"calcDependPaths");function gr(e,t){let s="";return t.id?s=t.id:s=I(e),s}n(gr,"getComputedId");function Rt(e,t,s){let r=e,i=t.length-1;t.forEach((o,a)=>{let u=D(r);if(a===i){let f=u?r.get(o):r[o];typeof f=="object"&&Object.assign(f,s);return}u?(r.has(o)||r.set(o,{}),r=r.get(o)):(o in r||(r[o]={}),r=r[o]);});}n(Rt,"updateObjectVal");function it(e,t){function s(r,i){for(let o in r){let a=r[o];typeof t=="function"&&t({value:a,key:o,parent:r,path:i.concat(o)}),typeof a=="object"&&!N(a)&&s(a,i.concat(o));}}n(s,"_forEachObject"),s(e,[]);}n(it,"forEachObject");function Ht(e){return e}n(Ht,"getSnap");function Tr(e=1e3){return new Promise(t=>{setTimeout(t,e);})}n(Tr,"delay");function ot(e){let t=new Map;return e.forEach(s=>{let r=s.join(".");t.set(r,s);}),Array.from(t.values())}n(ot,"noRepeat");function Ct(e,t){return e.length>t.length?false:e.every((s,r)=>s===t[r])}n(Ct,"pathStartsWith");function Lr(e,t,s){let r=[];return typeof e=="function"?r=t.collectDependencies(()=>e(t.state)):typeof e=="string"?r=[e.split(".")]:Array.isArray(e)?r=[[...e]]:r=[],s!=="none"&&r.forEach(i=>{let o=t.peep(a=>_(a,i));b(o)&&i.push(s==="all"?"*":"value");}),r}n(Lr,"getDepends");function Nr(e,t){if(!t||t.length===0)return  false;let s,r=e;for(let i=0;i<t.length;i++){let o=t[i],a=false;if(D(r)){if(a=r.has(o),!a)return  false;s=rt(r,o);}else {if(a=o in r,!a)return  false;s=r[o];}r=s;}return  true}n(Nr,"pathIsExists");function x(e){return e?typeof e=="function":false}n(x,"isFunction");function nt(e,t){let{reserveAsync:s,includeFunc:r}=Object.assign({reserveAsync:false},t);if(Array.isArray(e)){let i=[...e];for(let o=0;o<i.length;o++)i[o]=nt(i[o],t);return i}else if(typeof e=="object"){if(!s&&b(e))return e.value;{let i={...e};for(let o in i)i[o]=nt(i[o],t);return i}}return r&&x(e)?`\`\`\`${e.toString()}\`\`\``:e}n(nt,"getSnapshot");function Jr(e){return e==null||typeof e=="string"||typeof e=="number"||typeof e=="boolean"}n(Jr,"isPrimitive");function ts(e){globalThis.__AUTOSTORE_EXTENDS__&&(globalThis.__AUTOSTORE_EXTENDS__=[]),typeof e=="function"&&globalThis.__AUTOSTORE_EXTENDS__.push(e);}n(ts,"defineExtend");function ns(e,t,s){let r=V(t)?t():t;if(E(r)){if(r.options.objectify=false,Object.assign(r.options,s),r.type==="computed")return e.computedObjects.create(r);if(r.type==="watch")return e.watchObjects.create(r)}else if(typeof r=="function"){let o=tt(r)();return o.options.objectify=false,Object.assign(o.options,s),e.computedObjects.create(o)}}n(ns,"createObserverObject");function ls(e){return E(e)||V(e)}n(ls,"isComputedDescriptorParameter");function _s(e,t,s){let r=_(e,typeof t=="string"?t.split("."):t,s);return b(r)?r:{value:r,loading:false,retry:0,error:null,timeout:0,progress:0,run:n(()=>{},"run"),cancel:n(()=>{},"cancel")}}n(_s,"getAsyncVal");function As(e,t){return b(e)?Object.assign({},e,t):Object.assign({value:e,loading:false,retry:0,progress:0,timeout:0,error:null,run:n(()=>{},"run"),cancel:n(()=>{},"cancel")},t)}n(As,"createAsyncComptuedValue");function js(e){try{return e[C]===!0}catch{}return  false}n(js,"isValueSchema");function Dt(e){let t=Array.isArray(e)?e[0]:e;return !!(t.startsWith("./")||t.startsWith("../")||["CURRENT","PARENT","SELF"].includes(t))}n(Dt,"isRelPath");function at(e){return typeof e=="function"&&e[C]===true}n(at,"isSchemaBuilder");var ut=class extends Map{static{n(this,"ComputedObjects");}store;constructor(t){super(),this.store=t;}get enable(){return this.store.options.enableComputed}set enable(t){this.store.options.enableComputed=t;}create(){let t=E(arguments[0])?arguments[0]:tt(...arguments)();if(t.options.async&&!_t(t.options.depends))throw new z("The scope of the dynamic computed object must be the root state object or an absolute path");let s=t.options.scope;if(s===void 0||s==="ROOT")t.options.scope="ROOT";else if(!_t([s]))throw new X("The scope of the dynamic computed object must be the root state object or an absolute path");return this.store._createComputed(t)}async runGroup(t,s,r){return await this.run(i=>i.group===t,s,r)}async run(){if(arguments.length===0)return Promise.all([...this.values()].map(o=>o.run()));let t;typeof arguments[0]=="function"?t=arguments[0]:typeof arguments[0]=="string"&&(t=n(o=>o.id===arguments[0],"filter"));let s=Object.assign({},arguments[1]),r=Object.assign({wait:false,timeout:0},arguments[2]),i={};return new Promise((o,a)=>{if(r.wait){let u;s.onDone=({id:f})=>{if(i[f]=true,Object.values(i).every(c=>c))return clearTimeout(u),true},r.timeout>0&&(u=setTimeout(()=>{a(new v);},r.timeout));}Promise.all([...this.values()].filter(u=>t(u)?(i[u.id]=false,true):false).map(u=>u.run(s))),r.wait||o();})}async enableGroup(t){for(let s of this.values())s.options.enable=t;}delete(t){return this.get(t)?.detach(),super.delete(t)}find(t){if(!t)return;let s=Array.isArray(t)?t:t.split(".");for(let r of this.values())if(w(r.path,s))return r}};function yt(e,...t){if(t.length===0)return e;let s=t.map((r,i)=>{let o=Object.entries(r||{});return o.some(([a,u])=>u===void 0)?o.reduce((a,[u,f])=>(f!==void 0&&(a[u]=f),a),{}):r});return Object.assign(e,...s)}n(yt,"u");(e=>typeof j<"u"?j:typeof Proxy<"u"?new Proxy(e,{get:n((t,s)=>(typeof j<"u"?j:t)[s],"get")}):e)(function(e){if(typeof j<"u")return j.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')});function Vt(e,t="info"){let s=typeof e=="function"?e():e instanceof Error?e.stack:e;try{console[t](`[AutoStore<${this.id}>]`,...Array.isArray(s)?s:[s]);}catch{}}n(Vt,"log");function $(e,t,s="."){let r=[];try{return typeof t=="function"&&(t=t.call(e,e)),r=Array.isArray(t)?t:typeof t=="string"?t.split(s):[],r.length>0?_(e,r):e}catch{return e}}n($,"getValueByPath");var F=(function(e){return e.Root="ROOT",e.Current="CURRENT",e.Parent="PARENT",e.Depends="DEPENDS",e.Self="SELF",e})({});function Gt(e,t,s){let r=t===void 0?s:t;if(typeof r=="function")try{r=r.call(e.store,e);}catch{}return r===void 0?s===void 0?F.Current:s:r}n(Gt,"getScopeOptions");function L(e,t,s,r){let i=e.store.state,o=e.store.options;if(typeof o.getRootScope=="function"){let l=o.getRootScope(e,{observerType:t,valuePath:s?.path});l!==void 0&&(i=l);}let{path:a,parentPath:u}=s||{},f=Gt(e,r.scope,o.scope),c=i;try{f===F.Current?c=$(i,u):f===F.Parent?c=$(i,a.slice(0,a.length-2<0?0:a.length-2)):f===F.Root?c=i:f===F.Depends?c=e.depends?.map(l=>$(i,l)):typeof f=="string"?f.startsWith("@")?c=L(e,t,s,{...r,scope:L(e,t,{...s,path:f.slice(1).split(".")},{...r,scope:f.slice(1)})}):c=$(i,H(e.path,f)):Array.isArray(f)&&(c=$(i,f));}catch(l){o.log(`Error while getting computed scope ${e.toString()}: ${l.message}`,"error");}return c}n(L,"getValueScope");var M=class{static{n(this,"ObserverObject");}descriptor;context;_path;_id="";_initial;_value;_associated=false;_attached=false;_getter;_depends=[];_options;_subscribers=[];_strPath;_error;store;_shadowStore;constructor(t,s,r){this.descriptor=s,this.context=r,this.store=t,this._associated=r!==void 0,this._getter=s.getter,this._options=Object.assign({enable:true,group:"",depends:[],throwError:true},s.options),this._id=this._options.id||(this._associated?I(r?.path):st()),this._path=r?.path||[`#${this._id}`],this._path||(this._path=[`#${this._id}`]),this._initial=this._options.initial,this.onInitOptions(this._options),this._depends=P(this._path,this._options.depends),this._onObserverCreated(),this._onInitial();}get shadowStore(){return this._shadowStore||(this._shadowStore=x(this.store.options.getShadowStore)?this.store.options.getShadowStore()||this.store:this.store),this._shadowStore}get type(){return this.descriptor.type}get options(){return this._options}get id(){return this._id}get associated(){return this._associated}get async(){return this._options.async}get enable(){return this._options.enable}set enable(t){this._options.enable=t;}set group(t){this._options.group=t;}get group(){return this._options.group}get initial(){return this._initial}set initial(t){this._initial=t;}get path(){return this._path}get attached(){return this._attached}get depends(){return this._depends}set depends(t){this._depends=t;}get getter(){return this._getter}set getter(t){this._getter=t;}get strPath(){return this._strPath||(this._strPath=this._path.join(".")),this._strPath}get error(){return this._error}set error(t){this._error=t;}toString(){return `ObserverObject<${this.strPath}>`}get value(){return this._associated?_(this.store.state,this._path):(this.store._notify({type:"get",path:this.path,value:this._value}),this._value)}set value(t){if(this._associated)S(this.store.state,this._path,t);else {let s=this._value;t!==s&&(this._value=t,this.store._notify({type:"set",path:this.path,value:t,oldValue:s}));}}_onObserverCreated(){typeof this.store.options.onObserverCreated=="function"&&this.store.options.onObserverCreated(this);}_onInitial(){this._options.initial!==void 0&&this.update(this._options.initial,{silent:true}),this.onInitial();}onInitial(){}onInitOptions(t){}update(t,s){this.store.update(()=>{this.value=t;},s);}silentUpdate(t){this.update(t,{silent:true});}watch(t,s){let r=this.store.watch(this.getValueWatchPath(),i=>{t.call(this,i);},s);return this._subscribers.push(r),r}getValueWatchPath(){return this.path.join(".")}emitStoreEvent(t,s){setTimeout(()=>{this.store.emit(t,s);},0);}getDepends(){return this.depends}onDependsChange(t){}attach(){!this._attached&&this.depends&&this.depends.length>0&&(this._subscribers.push(this.shadowStore.watch(this.getDepends(),this.onDependsChange.bind(this),{operates:"write"})),this.store.log(()=>`${this.toString()} subscribed to ${this.depends.map(t=>t.join(".")).join(",")}`),this._attached=true);}detach(){this._attached&&(this._subscribers.forEach(t=>{t.off();}),this._attached=false,this._subscribers=[],this.store.watchObjects.delete(this.id));}run(...t){}};var B=class extends M{static{n(this,"ComputedObject");}descriptor;context;constructor(t,s,r){super(t,s,r),this.descriptor=s,this.context=r,s.options.depends=P(this.path,this.options.depends);}toString(){return `ComputedObject<${I(this.path)}>`}get val(){return this.async?this.value.value:this.value}isDisable(t){return !this.store.options.enableComputed||!this.enable&&t!==true||t===false}run(t){throw new Error("Method not implemented.")}};var ct=class extends B{static{n(this,"SyncComputedObject");}get async(){return  false}onInitial(){this.collectDependencies();}run(t){let{first:s,operate:r}=Object.assign({first:false,operate:void 0},t);if(this.error=void 0,!s&&this.isDisable(t?.enable)){this.store.log(`Sync computed <${this.toString()}> is disabled`,"warn");return}!s&&this.store.log(()=>`Run sync computed for : ${this.toString()}`);let i=t?Object.assign({},this.options,t):this.options,o=L(this,"computed",this.context,i),a=i.initial;try{a=this.getter.call(this,o,{operate:r,first:s});}catch(u){this.error=u;}this.onDone(s,a,i);}onDone(t,s,r){let i=s;if(this.error&&x(r.onError)){let o=r.onError(this.error);o!==void 0&&(i=o);}if(t&&(this.initial=i),this.store.peep(()=>{this.value=i;}),this.error){if(!t&&this.emitStoreEvent("computed:error",{id:this.id,path:this.path,error:this.error,computedObject:this}),this.options.throwError)throw this.error}else !t&&this.emitStoreEvent("computed:done",{id:this.id,path:this.path,value:i,computedObject:this});}collectDependencies(){let t=[],s=this.shadowStore.watch(r=>{t.push(r.path);},{operates:["get"]});this.run({first:true}),s.off(),Array.isArray(this.options.depends)&&this.options.depends.length>0&&t.push(...P(this.path,this.options.depends)),this.depends=ot(t),this.attach();}onDependsChange(t){this.run({operate:t});}};function It(e,t,s,r,i){return s==="push"?(...o)=>{let a=t.length,u=r.apply(t,o);if(t.length>a){let f=Array.from({length:t.length-a},(c,l)=>l+a);e({type:"insert",path:i,indexs:f,value:o,oldValue:void 0,parentPath:i,parent:t});}return u}:s==="pop"?()=>{let o=t.length,a=r.apply(t);return t.length===o-1&&e({type:"remove",path:i,indexs:[o-1],value:[a],oldValue:void 0,parentPath:i,parent:t}),a}:s==="splice"?(o,a,...u)=>{let f=r.apply(t,[o,a,...u]);if(f.length>0){let c=Array.from({length:f.length},(l,p)=>o+p);e({type:"remove",path:i,indexs:c,value:f,oldValue:void 0,parentPath:i,parent:t});}if(u.length>0){let c=Array.from({length:u.length},(l,p)=>o+p);e({type:"insert",path:i,indexs:c,value:u,oldValue:void 0,parentPath:i,parent:t});}return f}:s==="unshift"?(...o)=>{let a=t.length,u=r.apply(t,o);if(t.length>a){let f=Array.from({length:t.length-a},(c,l)=>l);e({type:"insert",path:i,indexs:f,value:o,oldValue:void 0,parentPath:i,parent:t});}return u}:s==="shift"?()=>{let o=t.length,a=r.apply(t);return t.length===o-1&&e({type:"remove",path:i,indexs:[0],value:[a],oldValue:void 0,parentPath:i,parent:t}),a}:s==="fill"?(o,a,u)=>{let f=r.apply(t,[o,a,u]),c=a??0,l=u??t.length,p=Array.from({length:l-c},(d,g)=>g+c),m=Array.from({length:l-c},()=>o);return e({type:"update",path:i,indexs:p,value:m,oldValue:void 0,parentPath:i,parent:t}),f}:s==="concat"?(...o)=>{let a=t.length,u=r.apply(t,o),f=Array.from({length:o.length},(c,l)=>a+l);return e({type:"insert",path:i,indexs:f,value:o,oldValue:void 0,parentPath:i,parent:t}),u}:r}n(It,"hookArrayMethods");function Pt(e){return typeof e=="number"||typeof e=="string"&&!Number.isNaN(parseInt(e))}n(Pt,"isNumber");var bt=Symbol("__NOTIFY__");function Kt(e,t,s,r,i){let o=this._updateValidateBehavior;if(o==="none")return  true;let a=this.schemas,u=a.get(t);if(!u)return  true;let f=u.onValidate||this.options.onValidate;if(typeof f!="function")return  true;let c=o!==void 0?o:u.onFail||"throw",l=true,p=u.invalidTips||"validate error",m=true,d;try{l=f.call(this,s,r,t)!==!1;}catch(g){d=g;}finally{if(l)delete a.errors[t.join("_$_")];else {if(x(p))try{p=p.call(this,d,t,s,r);}catch{}else d&&!p&&(p=d.message);if(typeof p=="string"&&p.includes("{")&&p.includes("}")){let g=a.get(t);g&&(p=p.replace(/\{([^}]+)\}/g,(A,K)=>g[K]));}a.errors[t.join(this.options.delimiter)]=p;}this.emit("validate",{path:[...i,...t],newValue:s,oldValue:r,error:p});}if(!l){if(c==="throw")throw new U(p);c==="throw-pass"?m=new U(p):c==="ignore"?m=false:m=true;}return m}n(Kt,"isValidPass");function $t(e,t,s,r,i){if(N(e)||typeof e!="object"||e===null)return e;if(s.has(e))return s.get(e);let o=new Proxy(e,{get:n((a,u,f)=>{let c=Reflect.get(a,u,f);if(typeof u!="string")return c;let l=[...t,String(u)];if(typeof c=="function"||!Object.hasOwn(a,u))if(typeof c=="function"){if(Array.isArray(a)&&!Pt(u))return It(i.notify,a,u,c,t);if(!N(c)&&Object.hasOwn(a,u)){if(typeof this.options.onObserverInitial=="function")try{if(this.options.onObserverInitial.call(this,l,c,a)===!1)return y(c),c}catch(m){this.log(`onObserverBeforeCreate error: ${m.message}`,"error");}let p=l.join(".");try{if(r.has(p)){let m=[...r.keys(),p];throw r.clear(),new q(`Find circular dependency at <"${l}">, steps: ${m.join(" -> ")}`)}return r.set(p,!0),i.createObserverObject(l,c,t,a)}finally{r.delete(p);}}else return c}else return c;return i.notify({type:"get",path:l,indexs:[],value:c,oldValue:void 0,parentPath:t,parent:a}),$t.call(this,c,l,s,r,i)},"get"),set:n((a,u,f,c)=>{let l=Reflect.get(a,u,c),p=[...t,String(u)],m=Kt.call(this,o,p,f,l,t);if(m){let d=Reflect.set(a,u,f,c);if(u===bt)return  true;if(d&&u!==bt&&f!==l&&i.notify({type:Array.isArray(a)?"update":"set",path:p,indexs:[],value:f,oldValue:l,parentPath:t,parent:a}),m instanceof Error)throw m;return d}else return  true},"set"),deleteProperty:n((a,u)=>{let f=a[u],c=[...t,String(u)],l=Reflect.deleteProperty(a,u);return l&&u!==bt&&(this.schemas.remove(c),i.notify({type:"delete",path:c,indexs:[],value:f,oldValue:void 0,parentPath:t,parent:a})),l},"deleteProperty")});return s.set(e,o),o}n($t,"createProxy");function Ft(e,t){let s=new Map,r=new WeakMap;return $t.call(this,e,[],r,s,t)}n(Ft,"createReactiveObject");async function xt(e){return new Promise((t,s)=>setTimeout(t,e))}n(xt,"t");function Lt(e){return e instanceof Error?e:new Error(e)}n(Lt,"getError");var ft=class extends B{static{n(this,"AsyncComputedObject");}_isRunning=false;_defaultAbortController=null;_userAbortController;_firstRun=false;get async(){return  true}get value(){return super.value}set value(t){super.value=t;}get running(){return this._isRunning}onInitOptions(t){t.reentry===void 0&&(t.reentry=this.store.options.reentry);}onInitial(){this.initial=this.createAsyncComputedValue(),this.attach(),setTimeout(()=>{(this.options.immediate===true||this.options.immediate==="auto"&&this.options.initial===void 0)&&this.run({first:true});},0);}createAsyncComputedValue(){return Object.assign({[J]:true,loading:false,timeout:0,retry:0,error:null,value:this.options.initial,progress:0,run:y(t=>this.store.computedObjects.run(this.id,Object.assign({},t))),cancel:y(()=>{this.getAbortController().abort();})})}updateComputedValue(t){let s=this.strPath,r=Object.keys(t).length;if(this.associated)this.store.update(i=>{Rt(i,this.path,t);},{batch:r>1?s:false});else {Object.assign(this.value,t);let i=r>1,o=[];Object.entries(t).forEach(([a,u])=>{let f={type:"set",path:[...this.path,a],value:u,parent:this.value};i&&(f.reply=true),this.store.operates.emit(`${this.strPath}.${a}`,f),o.push(f);}),i&&this.store.operates.emit(this.strPath,{type:"batch",path:this.path,value:o});}}async run(t){let{first:s}=t??{};if(this.isDisable(t?.enable)){this.store.log(()=>`Async computed <${this.toString()}> is disabled`,"warn");return}this.error=void 0,this._firstRun=true,!s&&this.store.log(()=>`Run async computed for : ${this.toString()}`);let r=t?Object.assign({first:s},this.options,t):this.options,i=L(this,"computed",this.context,r),{reentry:o}=r;if(this._isRunning&&!o){this.store.log(()=>`Async computed: ${this.toString()} is running, can't reentry`,"warn"),this.emitStoreEvent("computed:cancel",{path:this.path,id:this.id,reason:"reentry",computedObject:this});return}this._isRunning=true;try{return await this.executeGetter(i,r)}finally{this._isRunning=false;}}createComputeProgressbar(t){let{max:s=100,min:r=0,value:i=0}=Object.assign({},t);return this.updateComputedValue({progress:i}),{value:n(o=>{o>s&&(o=s),o<r&&(o=r),this.updateComputedValue({progress:o});},"value"),end(){this.value(s);}}}getAbortController(t){if(t&&typeof t.abortController=="function"){let s=t.abortController();s&&s instanceof AbortController&&(this._userAbortController=s);}return this._userAbortController?this._userAbortController:(this._defaultAbortController||(this._defaultAbortController=new AbortController),this._defaultAbortController.signal.aborted&&(this._defaultAbortController=new AbortController),this._defaultAbortController)}setTimeoutControl(t,s,r){let{timeout:i}=r,[o=0,a=0]=Array.isArray(i)?i:[i,0],u,f;return o>0&&(s.timeout=a>1?a:o,f=setTimeout(()=>{t.hasTimeout=true,t.hasError=true,t.error="TIMEOUT",typeof t.timeoutCallback=="function"&&t.timeoutCallback(),clearInterval(u),this.updateComputedValue({loading:false,error:"TIMEOUT",timeout:0});},o),a>1&&(u=setInterval(()=>{this.updateComputedValue({timeout:a--}),a===0&&clearInterval(u);},o/(a+1)))),{clear:n(()=>{clearTimeout(f),clearInterval(u);},"clear"),enable:o>0}}async executeGetter(t,s){let{retry:r=[0,0]}=s,[i,o]=Array.isArray(r)?r:[Number(r),0],a,u=this.getAbortController(s),f={onTimeout:n(d=>{a=d;},"onTimeout"),getProgressbar:this.createComputeProgressbar.bind(this),getSnap:n(d=>d,"getSnap"),cancel:u.abort,extras:s.extras,operate:s.operate,first:s.first,abortSignal:u.signal},c={error:null,hasError:false,hasTimeout:false,hasAbort:false,timeoutCallback:a};u.signal.addEventListener("abort",()=>{c.hasAbort=true;});let l={clear:n(()=>{},"clear"),enable:false},p,m=n(d=>Object.assign(c,d),"updateCtx");for(let d=0;d<i+1;d++){let g={};try{let A={loading:!0};if(c.hasError&&(A.error=null),i>0&&(A.retry=d>0?i-d+1:0),d>0&&m({error:null,hasError:!1,hasTimeout:!1}),l=this.setTimeoutControl(c,A,s),this.updateComputedValue(A),c.hasAbort)throw new W;if(p=await this.getter.call(this,t,f),c.hasAbort)throw new W;c.hasTimeout||(g.value=p,l.enable&&(g.timeout=0));}catch(A){if(c.hasError=true,c.error=A,c.hasTimeout||(g.error=Lt(A).message),x(s.onError)){let K=s.onError(A);K!==void 0&&(g.value=K);}}finally{l.clear(),d===i&&(c.hasTimeout&&(g.error=c.error),i>0&&(g.retry=0)),g.loading=false,this.updateComputedValue(g);}c.hasError&&i>0&&o>0&&d<i&&await xt(o);}c.hasAbort?this.emitStoreEvent("computed:cancel",{path:this.path,id:this.id,computedObject:this}):c.hasError||c.hasTimeout?(this.error=c.error,this.emitStoreEvent("computed:error",{path:this.path,id:this.id,error:c.error,computedObject:this})):this.emitStoreEvent("computed:done",{path:this.path,id:this.id,value:p,computedObject:this}),this.onDoneCallback(s,c.error,c.hasAbort,c.hasTimeout,t,p);}onDoneCallback(t,s,r,i,o,a){typeof t.onDone=="function"&&t.onDone.call(this,{id:this.id,path:this.path,value:a,error:s,abort:r,timeout:i,scope:o});}onDependsChange(t){this.store.log(()=>`AsyncComputed<${this.id}> is running by depends ${t.type}/${t.path.join(".")} operate `),this.run({operate:t,first:!this._firstRun});}getValueWatchPath(){let t=this.path.join(".");return [`${t}.*`,t]}getDepends(){return super.getDepends().map(s=>{if(s.length===0)return s;for(let r of this.store.computedObjects.values())if(w(r.path,s)&&r.async)return [`${s}.value`];return s})}};function Mt(){let e=arguments[0],t=typeof arguments[1]=="function"?arguments[1]:()=>true,s=typeof arguments[1]=="object"?arguments[1]:arguments[2],r=Object.assign({depends:[],enable:true,objectify:true,filter:t},s),i=n(()=>({type:"watch",getter:e,options:r}),"descriptorBuilder");return i[R]=true,i}n(Mt,"watch");var lt=class extends Map{static{n(this,"WatchObjects");}store;_watcher={off:n(()=>{},"off")};_enable=true;constructor(t){super(),this.store=t;}get enable(){return this._enable}set enable(t){this._enable=t;}set(t,s){return super.size===0&&this.createWacher(),super.set(t,s)}createWacher(){this._watcher=this.store.watch("**",({path:t,value:s})=>{if(!this._enable)return;let r=t[0].startsWith("#")?s:_(this.store.state,t);for(let i of this.values())i.isMatched(t,r)&&i.run(t,r);});}reset(){this._watcher&&this._watcher.off();for(let t of this.values())t.reset();this.createWacher();}create(){let t=E(arguments[0])?arguments[0]:Mt(...arguments)();return this.store._createWatch(t)}enableGroup(t,s=true){for(let r of this.values())r.options.group===t&&(r.options.enable=s);}};var pt=class extends M{static{n(this,"WatchObject");}store;context;_cache;constructor(t,s,r){if(super(t,s,r),this.store=t,this.context=r,typeof this.options.filter!="function")throw new Error("watch options.filter must be a function")}get filter(){return this.options.filter}get cache(){return this._cache||(this._cache={}),this._cache}toString(){return `WatchObject<${this.id}>`}onInitial(){}isMatched(t,s){return et(t,this.path)?false:this.filter(t,s)}reset(){this._cache={},this.value=this.initial;}run(t,s){if(!this.enable){this.store.log(`WatchObject <${this.toString()}> is disabled`);return}try{let r=this.getter?.call(this,{path:t,value:s},this);this.value=r,this.emitStoreEvent("watch:done",{value:r,watchObject:this});}catch(r){this.emitStoreEvent("watch:error",{error:r,watchObject:this});}}};function At(e,t){return new Proxy(e,{get(r,i,o){return i==="on"?(a,u,f)=>e.on(`${t}${"."}${a}`,(c,l)=>u(c,l.slice(t.length+1)),f):i==="once"?(a,u)=>e.once(`${t}${"."}${a}`,(f,c)=>{u(f,c.slice(t.length+1));}):i==="off"?(a,u)=>e.off(`${t}${"."}${a}`,u):i==="emit"?(a,u)=>e.emit(`${t}${"."}${a}`,u):i==="wait"?async(...a)=>{if(typeof a[0]=="string")return a[0]=`${t}${"."}${a[0]}`,e.wait(...a);if(typeof a[0]=="function"){let u=a[0];return a[0]=(f,c)=>{f.startsWith(t)&&u(f.slice(t.length+1),c);},e.wait(...a)}}:i==="offAll"?()=>{for(let[a]of e.listeners.entries())a!=="*"&&typeof a=="string"&&a.startsWith(`${t}.`)&&e.listeners.delete(a);}:i==="onAny"?a=>e.on(`${t}${"."}**`,(u,f)=>{a(u,f.slice(t.length+1));}):i==="scope"?a=>At(e,`${t}${"."}${a}`):Reflect.get(r,i,o)}})}n(At,"createEventEmitterScope");var G=class{static{n(this,"EventEmitter");}_listeners=new Map;get listeners(){return this._listeners}on(){let t=arguments[0],s=arguments[1],r=arguments[2],i=s;return t==="**"?this.addHandler("*",i,r):String(t).includes("*")?(i=n((o,a)=>{St(a,t)&&s(o,a);},"phandler"),this.addHandler("*",i,r)):this.addHandler(t,i,r),{off:n(()=>this.off(t,i),"off")}}addHandler(t,s,r){let i=this._listeners.get(t);i?r?i.unshift(s):i.push(s):this._listeners.set(t,[s]);}once(t,s){let r=n((i,o)=>{try{s(i,o);}finally{this.off(o,r);}},"plistener");return this.on(t,r)}off(t,s){String(t).includes("*")&&(t="*");let r=this._listeners.get(t);r&&(s?r.splice(r.indexOf(s)>>>0,1):this._listeners.set(t,[]));}offAll(){this._listeners.clear();}onAny(t){return this.on("**",t)}wait(){let t=typeof arguments[0],s=t==="string"?arguments[0]:void 0,r=arguments[1]||0,i=t==="function"?t:void 0,o;return new Promise((a,u)=>{let f;s?f=this.once(s,c=>{clearTimeout(o),a(c);}):typeof i=="function"&&(f=this.onAny((c,l)=>{i(l,c)!==false&&(f.off(),clearTimeout(o),a(c));})),r>0&&(o=setTimeout(()=>{f.off(),u(new Error("timeout"));},r));})}emit(t,s){let r=this._listeners.get("*");r&&r.slice().map(i=>i(s,t)),r=this._listeners.get(t),r&&r.slice().map(i=>i(s,t));}scope(t){return At(this,t)}};function Bt(e){let t;return V(e)?t=e():typeof e=="function"&&(t={type:"computed",getter:e,options:Object.assign({},k(),{async:Q(e)})}),t}n(Bt,"getObserverDescriptor");function Ot(e,t){if(t==="*")return  true;if(t==="write"){if(e.type==="get")return}else if(t==="read"){if(e.type!=="get")return}else if(Array.isArray(t)&&t.length>0&&!t.includes(e.type))return;return  true}n(Ot,"isMatchOperates");function Wt(e){return typeof e=="string"&&e.startsWith("```")&&e.endsWith("```")}n(Wt,"isFuncDefine");function ht(e,t=()=>{}){e=e.replace(/^\s*`{3,}\w*(?:\r?\n|\n)/,"").replace(/^\s*`+\s*/,""),e=e.replace(/\s*`{3,}\s*$/,"").replace(/\s*`+\s*$/,""),e=e.replace(/^[\f\t\r\n]+/,""),e=e.replace(/^[\\]+(?=(?:async|function|\(|[A-Za-z_$]))/,"");let s=/^\s*(async\s+)?function(?:\s+\w+)?\s*\(([^)]*)\)\s*\{([\s\S]*)\}\s*;?\s*$/m.exec(e),r=/^\s*(async\s+)?\(([^)]*)\)\s*=>\s*(?:\{([\s\S]*)\}|(.+))\s*;?\s*$/m.exec(e),i=/^\s*(async\s+)?([A-Za-z_$][\w$]*)\s*=>\s*(?:\{([\s\S]*)\}|(.+))\s*;?\s*$/m.exec(e);if(!s&&!r&&!i)return;let o=false,a=[],u="";if(s){let[,l,p,m]=s;o=!!l,a=(p||"").split(",").map(d=>d.trim()).filter(Boolean),u=m;}else if(r){let[,l,p,m,d]=r;o=!!l,a=(p||"").split(",").map(g=>g.trim()).filter(Boolean),u=m||`return ${d}`;}else if(i){let[,l,p,m,d]=i;o=!!l,a=p?[p]:[],u=m||`return ${d}`;}let f=Object.getPrototypeOf(async function(){}).constructor,c=o?f:Function;try{return new c(...a,u)}catch{return t}}n(ht,"parseFunc");var dt=class{static{n(this,"SchemaManager");}shadow;errors={};_subscribers=[];store;_descriptors={};constructor(t){this.shadow=t;}get fields(){return this.store.state}get size(){return Object.keys(this.fields).length}_getKey(t){return Array.isArray(t)?t.join("_$_"):t.split(".").join("_$_")}_getPath(t){return t.split("_$_")}add(t,s){let r=at(s)?s():s,i=Array.isArray(t)?t:t.split("."),o=this._getKey(t);r.options.onFail||(r.options.onFail="throw-pass");let a=Object.assign({},this.shadow.options.defaultSchemaOptions,r.options,{path:i,datatype:r.datatype,value:r.value});return Object.entries(a).forEach(([u,f])=>{if(Wt(f)){let c=ht(f);typeof c=="function"&&(u.startsWith("on")||u.startsWith("to")?a[u]=y(c):a[u]=c);}}),this._descriptors[o]=a,this.shadow&&r.value!==void 0&&r.flags!==-1&&this.shadow.update(u=>{S(u,i,r.value);},{validate:"pass",silent:true}),r}build(){this.store||this._descriptors&&(this.store=this.shadow.shadow(this._descriptors));}get(t){if(this.store)return _(this.store.state,[this._getKey(t)])}has(t){return this.store?this._getKey(t)in this.store.state:false}watch(){return this.store.watch(...arguemnts)}getValidator(t){if(!this.store)return;let s=this.get(t);if(s)return {validate:s.onValidate,onFail:s.onFail,message:s.invalidTips}}addValidator(t,s){if(!this.store)return;let r=this._getKey(t);this.store.update(i=>{Object.assign(i[r],{onValidate:y(s.validate),onFail:s.onFail||"throw-pass",invalidTips:s.message});});}remove(t){let s=this._getKey(t);this.store&&delete this.store.state[s];}getValues(){let t={};return Object.entries(this._descriptors||{}).forEach(([s,r])=>{let i=this._getPath(s),o=r.name??i.join(".");this.shadow.peep(a=>{t[o]=_(a,i);});}),t}find(t){let s=Array.isArray(t)?t:t.split(".");return Object.entries(this.fields).filter(([r])=>Ct(s,this._getPath(r))).map(([r,i])=>i)}};function qt(e){Tt(e)&&it(e,({value:t,key:s,parent:r})=>{x(t)&&(s.startsWith("on")||s.startsWith("render")||s.startsWith("to"))&&(r[s]=y(t));});}n(qt,"markRawOptions");function Yt(e){let t={value:e[0],options:Object.assign({onFail:"throw-pass"},e[1])};if(!t.options.widget&&typeof t.options.toInput!="function"){let s=typeof t.value;s==="boolean"?t.options.widget="checkbox":s==="number"&&(t.options.widget="number"),Array.isArray(t.options.select)&&(t.options.widget="select");}return "onValidate"in t.options&&y(t.options.onValidate),qt(t.options),t}n(Yt,"parseSchemaOptions");var Et=n(function(){let e=arguments[0],t=arguments[1],s=Yt([e,t]),r=e,i=Array.isArray(r)?"array":typeof r;typeof r=="object"&&y(r);let o=n(()=>({value:r,datatype:i,options:s.options}),"builder");return o[C]=true,o},"schema"),Fn=Et,Ln=Et;function T(e,t){return n(function(){let r=Object.assign({},arguments[1]);return typeof r.onValidate!="function"&&(r.onValidate=e),r.invalidTips||(r.invalidTips=t),Et(arguments[0],r)},"typeSchema")}n(T,"createTypeSchemaBuilder");var Xt={number:T(e=>typeof e=="number","must be a number"),string:T(e=>typeof e=="string","must be a string"),boolean:T(e=>typeof e=="boolean","must be a boolean"),date:T(e=>e instanceof Date,"must be a date"),bigint:T(e=>typeof e=="bigint","must be a bigint"),array:T(e=>Array.isArray(e),"must be an array"),object:T(e=>typeof e=="object","must be an object")},Mn=Xt;function Ut(e,t,s){let r=new mt(t,Object.assign({},s,{id:`${e.id}_shadow`,getRootScope:n(()=>e.state,"getRootScope"),getShadowStore:n(()=>e,"getShadowStore"),debug:e.options.debug,shadow:true,onObserverBeforeCreate:n(i=>{let o=i.options.scope;(!o||Dt(o))&&(i.options.scope="ROOT");},"onObserverBeforeCreate")}));return e.watch(i=>{i.shadow=true,r.operates.emit(i.path.join("."),i);}),r}n(Ut,"createShadow");var mt=class extends G{static{n(this,"AutoStore");}_data;computedObjects;watchObjects;_operates=new G;_options;_silenting=false;_batching=false;_batchOperates=[];_updateFlags=0;_peeping=false;_updateValidateBehavior;_updatedState;_updatedWatcher;_schemas;_delimiter=".";types={rawState:void 0,state:void 0,schemas:void 0,schemaKeys:void 0};constructor(t,s){super(),this._options=yt({id:st(),debug:false,enableComputed:true,reentry:true,resetable:false,delimiter:".",log:Vt,shadow:false},s),this._delimiter=this._options.delimiter,this.computedObjects=new ut(this),this.watchObjects=new lt(this),this.subscribeCallbacks(),this._data=Ft.call(this,t||{},{notify:this._notify.bind(this),createObserverObject:this.createObserverObject.bind(this)}),this.getSnap=this.getSnap.bind(this),this.watch=this.watch.bind(this),this.update=this.update.bind(this),this.peep=this.peep.bind(this),this.silentUpdate=this.silentUpdate.bind(this),this.batchUpdate=this.batchUpdate.bind(this),this.trace=this.trace.bind(this),this.collectDependencies=this.collectDependencies.bind(this),this.installExtends(),this._schemas=new dt(this),it(this._data,this._onFirstEachState.bind(this)),this._options.shadow||this.schemas.build(),this._options.resetable&&(this.resetable=true),this._options.debug&&typeof globalThis.__AUTOSTORE_DEVTOOLS__=="object"&&globalThis.__AUTOSTORE_DEVTOOLS__.add(this),this.emit("load",this);}get id(){return this._options.id}get state(){return this._data}get operates(){return this._operates}get options(){return this._options}get silenting(){return this._silenting}get delimiter(){return this._delimiter}get batching(){return this._batching}get peeping(){return this._peeping}get resetable(){return this._options.resetable}get schemas(){return this._schemas}set resetable(t){if(t){if(this._updatedWatcher)return;this._updatedState={},this._updatedWatcher=this.watch(({path:s,oldValue:r})=>{if(s.length===0)return;let i=s.join(this._delimiter);!i.startsWith("#")&&!(i in this._updatedState)&&(this._updatedState[i]=r);},{operates:"write"});}else this._updatedWatcher&&(this._updatedWatcher.off(),this._updatedWatcher=void 0),this._updatedState={};this._options.resetable=t;}reset(t){if(this._options.resetable&&this._updatedState)try{this.batchUpdate(s=>{let r=t?`${t}${this._delimiter}`:"";Object.entries(this._updatedState).forEach(([i,o])=>{i.startsWith(r)&&S(s,i.split(this._delimiter),o);});});}finally{this.emit("reset",t);}else this.log("resetable option is not enabled","warn");}_onFirstEachState({value:t,path:s}){typeof t=="string"&&t.startsWith("```")&&t.endsWith("```")&&this.update(r=>{let i=ht(t.slice(3,t.length-3));y(i),S(r,s,i);},{silent:true});}log(t,s){this._options.debug&&this.options.log.call(this,t,s);}installExtends(){let t=globalThis.__AUTOSTORE_EXTENDS__;Array.isArray(t)&&t.forEach(s=>{typeof s=="function"&&s(this);});}subscribeCallbacks(){this._options.onComputedCreated&&this.on("computed:created",this._options.onComputedCreated.bind(this)),this._options.onComputedDone&&this.on("computed:done",this._options.onComputedDone.bind(this)),this._options.onComputedError&&this.on("computed:error",this._options.onComputedError.bind(this)),this._options.onComputedCancel&&this.on("computed:cancel",this._options.onComputedCancel.bind(this)),this._options.onObserverBeforeCreate&&this.on("observer:beforeCreate",this._options.onObserverBeforeCreate.bind(this));}_notify(t){this._peeping&&t.type==="get"||(this._batching&&this._batchOperates.push(t),!this._silenting&&(t.flags=this._updateFlags,this.operates.emit(t.path.join(this._delimiter),t)));}watch(){let t=typeof arguments[0]=="function"||["*","**"].includes(arguments[0])||Array.isArray(arguments[0])&&arguments[0].length===0,s=typeof arguments[0]=="function"?arguments[0]:arguments[1],r=arguments.length>=2&&typeof arguments[arguments.length-1]=="object"?arguments[arguments.length-1]:void 0,i=n((o,a)=>u=>{if(Ot(u,o)&&!(typeof a=="function"&&!a(u)))try{if(this._peeping=!0,u.type==="batch"){let f=u.value.filter(c=>Ot(c,o));if(f.length>0)u.value=f;else return}s(u);}finally{this._peeping=false;}},"createEventHandler");if(t){let{operates:o,filter:a}=Object.assign({once:false,operates:"write"},r),u=i(o,a);return this.operates.onAny(u)}else {let o=arguments[0],a=Array.isArray(o)?o.map(d=>typeof d=="string"?d:d.join(this._delimiter)):[o],{once:u,operates:f,filter:c}=Object.assign({once:false,operates:"write"},r),l=u?this.operates.once.bind(this.operates):this.operates.on.bind(this.operates),p=[],m=i(f,c);return a.forEach(d=>{p.push(l.call(this,d,m));}),{off:n(()=>p.forEach(d=>{d.off();}),"off")}}}createObserverObject(t,s,r,i){if(at(s))return this.schemas.add(t,s).value;{let o=Bt(s),a={path:t,value:s,parentPath:r,parent:i};if(o){if(o.type==="computed")return this._createComputed(o,a)?.initial;if(o.type==="watch")return this._createWatch(o,a)?.initial}else return s}}_createComputed(t,s){let r;return this.emit("observer:beforeCreate",t),t.options.async?r=new ft(this,t,s):r=new ct(this,t,s),r&&(r.silentUpdate(r.initial),r.options.objectify&&this.computedObjects.set(r.id,r),this.emit("computed:created",r),this.emit("observer:afterCreate",t)),r}_createWatch(t,s){this.emit("observer:beforeCreate",t);let r=new pt(this,t,s);return this.watchObjects.set(r.id,r),this.emit("watch:created",r),this.emit("observer:afterCreate",t),r}silentUpdate(t){this.update(t,{silent:true});}batchUpdate(t){this.update(t,{batch:true,validate:"pass"});}update(t,s){let{batch:r=false,reply:i=true,silent:o=false,peep:a=false,flags:u=0,validate:f}=Object.assign({},s);if(typeof t=="function"){this._updateFlags=u,this._updateValidateBehavior=f,o&&(this._silenting=true),r&&(this._batching=true,this._silenting=true),a&&(this._peeping=true);try{let c=t(this.state);if(r&&vt(c))throw new Error("Batch update method can't be async function")}finally{this._silenting=false,this._batching=false,this._peeping=false,this._updateFlags=0,this._updateValidateBehavior=void 0,this.replyBatchOperates(i,r);}}else throw new Error("update method must provide a function argument")}replyBatchOperates(t,s){if(this._batchOperates.length>0){let r=[...this._batchOperates];this._batchOperates=[],t&&r.forEach(i=>{i.reply=true,this._notify(i);});try{let i=s===!0?jt:String(s);this.operates.emit(i,{type:"batch",path:[i],value:r});}finally{this._batchOperates=[];}}}peep(){let t=typeof arguments[0]=="function"?()=>arguments[0](this.state):()=>_(this.state,Array.isArray(arguments[0])?arguments[0]:arguments[0].split(this._delimiter));this._peeping=true;try{return t()}finally{this._peeping=false;}}collectDependencies(t,s="*"){let r=[],i=this.watch(o=>{r.push(o.path);},{operates:s});try{t();}finally{i.off();}return ot(r)}trace(t,s="*"){let r;return {stop:n(()=>r?.off(),"stop"),start:n(async i=>{let o=[];return new Promise(a=>{r=this.watch(u=>{o.push(u),i?.(u)&&(r.off(),a(o));},{operates:s}),Promise.resolve(t()).finally(()=>{typeof i!="function"&&(r.off(),a(o));});})},"start")}}destroy(){this.offAll(),this._operates.offAll(),this.watchObjects.clear(),this.computedObjects.clear(),this.emit("unload",this);}getSnap(t){let{reserveAsync:s,entry:r,includeFunc:i}=Object.assign({reserveAsync:true},t);return nt(r?_(this._data,r):this._data,{reserveAsync:s,includeFunc:i})}shadow(t,s){return Ut(this,t,s)}get(t,s){let{defaultValue:r,timeout:i=0,expandAsync:o=false,waitAsyncDone:a=false}=Object.assign({},s),u=Array.isArray(t)?t:t.split(this.delimiter),f=_(this.state,u,r);return b(f)?f.loading&&a?new Promise((c,l)=>{let p,m;i>0&&(p=setTimeout(()=>{m?.off(),l(new v);},i)),m=this.on("computed:done",({path:d})=>{w(u,d)&&(clearTimeout(p),m?.off(),c(o?f.value:f));});}):o?f.value:f:f}toString(){return `AutoStore<${this.id}>`}};exports.ASYNC_COMPUTED_VALUE=J;exports.AbortError=W;exports.AsyncComputedObject=ft;exports.AutoStore=mt;exports.AutoStoreError=O;exports.BATCH_UPDATE_EVENT=jt;exports.ComputedObject=B;exports.ComputedObjects=ut;exports.CyleDependError=q;exports.DELETE_FLAG=kt;exports.EMPTY=Qt;exports.EventEmitter=G;exports.InvalidComputedArgumentsError=Y;exports.InvalidDependsError=z;exports.InvalidScopeError=X;exports.OBSERVER_DESCRIPTOR_BUILDER_FLAG=R;exports.OBSERVER_DESCRIPTOR_FLAG=wt;exports.ObserverObject=M;exports.ObserverScopeRef=F;exports.PATH_DELIMITER=h;exports.SKIP_PROXY_FLAG=Z;exports.SchemaManager=dt;exports.SyncComputedObject=ct;exports.TimeoutError=v;exports.VALUE_SCHEMA_BUILDER_FLAG=C;exports.ValidateError=U;exports.WatchObject=pt;exports.WatchObjects=lt;exports.c=Ln;exports.calcDependPaths=P;exports.computed=tt;exports.configurable=Fn;exports.createAsyncComptuedValue=As;exports.createObserverObject=ns;exports.createTypeSchemaBuilder=T;exports.defineExtend=ts;exports.delay=Tr;exports.forEachObject=it;exports.getAsyncVal=_s;exports.getComputedId=gr;exports.getDepends=Lr;exports.getId=st;exports.getMapVal=rt;exports.getSnap=Ht;exports.getSnapshot=nt;exports.getVal=_;exports.isAbsolutePath=_t;exports.isAsyncComputedValue=b;exports.isComputedDescriptorParameter=ls;exports.isEq=et;exports.isFunction=x;exports.isMap=D;exports.isObserverDescriptor=E;exports.isObserverDescriptorBuilder=V;exports.isPathEq=w;exports.isPathMatched=St;exports.isPlainObject=Tt;exports.isPrimitive=Jr;exports.isPromise=vt;exports.isProxy=Ne;exports.isRaw=N;exports.isRelPath=Dt;exports.isSchemaBuilder=at;exports.isValueSchema=js;exports.joinValuePath=I;exports.markRaw=y;exports.noRepeat=ot;exports.normalizeDeps=gt;exports.pathIsExists=Nr;exports.pathStartsWith=Ct;exports.s=Mn;exports.schema=Et;exports.schemas=Xt;exports.setVal=S;exports.updateObjectVal=Rt;exports.watch=Mt;return exports;})({});//# sourceMappingURL=index.global.js.map
//# sourceMappingURL=index.global.js.map