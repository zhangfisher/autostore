var AutoStoreSpaces=(function(exports){'use strict';var x=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,r)=>(typeof require<"u"?require:e)[r]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});var _=class extends Error{},F=class extends _{},V=class extends _{},k=class extends _{},K=class extends _{},N=class extends _{},q=class extends _{},M=class extends _{};var Y="__AS_SKIP_PROXY__",D="__AS_OBSERVER_DESCRIPTOR_BUILDER__",ve="__AS_OBSERVER_DESCRIPTOR__",d=".",Ae="__batch_update__",X="__AS_ASYNC_COMPUTED_VALUE__",Xe="__AS_EMPTY__",T="__AS_VALUE_SCHEMA__",ze="__AS_DELETE_FLAG__";function z(t){return t.constructor.name==="AsyncFunction"}function me(t){return t?t.map(e=>Array.isArray(e)?e:typeof e=="string"?["/","./","../"].some(r=>e.startsWith(r))?e:e.includes(d)?e.split(d):e.split("."):[]):[]}function Q(){return {async:false,enable:true,timeout:0,depends:[],immediate:"auto",extras:void 0,objectify:true}}function Z(){let t=arguments[0];if(typeof t!="function")throw new Error("computed getter must be a function");let e=[],r=Object.assign({},Q());if(arguments.length===1)e=[];else if(arguments.length===2)if(Array.isArray(arguments[1]))r.depends=arguments[1];else if(typeof arguments[1]=="object")Object.assign(r,arguments[1]),r.depends=me(r.depends);else throw new K;else arguments.length>=3&&(e=me(arguments[1]),Object.assign(r,arguments[2]),r.depends=e);r.async=r.async===true||z(t)||arguments.length>=2&&Array.isArray(arguments[1]);let o=()=>({type:"computed",getter:t,options:r,[ve]:true});return o[D]=true,o}function fe(t){return t?t.some(e=>typeof e=="string"?e.startsWith("./")||e.startsWith("../")||e.startsWith("@")?false:!["CURRENT","SELF","PARENT"].includes(e):true):false}function v(t){return typeof t=="object"&&t.hasOwnProperty("type")&&typeof t.type=="string"&&t.hasOwnProperty("getter")&&typeof t.getter=="function"&&t.hasOwnProperty("options")&&typeof t.options=="object"}function U(t){try{return t[Y]===!0}catch{}return  false}function J(t,e){if(t===e)return  true;if(t===null||e===null||typeof t!=typeof e)return  false;if(typeof t=="object"){if(Array.isArray(t)&&Array.isArray(e))return t.length!==e.length?false:t.every((r,o)=>J(r,e[o]));if(!Array.isArray(t)&&!Array.isArray(e)){let r=Object.keys(t);return r.length!==Object.keys(e).length?false:r.every(o=>J(t[o],e[o]))}else return  false}return  false}function w(t){return toString.call(t)==="[object Map]"}function A(t,e){return !t||!e||t.length!==e.length?false:t.every((r,o)=>r===e[o])}function xe(t,e){let r=Array.isArray(t)?t:t.split(d),o=Array.isArray(e)?e:e===""?[]:e.split(d);return o.length===0||A(r,o)?true:(o[o.length-1]==="**"&&(o[o.length-1]="*",o.splice(o.length-1,0,...Array.from({length:r.length-o.length}).fill("*"))),r.length!==o.length?false:o.every((n,i)=>n==="*"||n==="**"?true:n===r[i]))}function Ce(t){return t==null||typeof t!="object"?false:Object.prototype.toString.call(t)==="[object Object]"}function b(t){return t&&typeof t=="object"&&t.hasOwnProperty(X)}function Ee(t){try{return !!t&&(typeof t=="object"||typeof t=="function")&&typeof t.then=="function"&&typeof t.catch=="function"&&(t instanceof Promise||Object.prototype.toString.call(t)==="[object Promise]")}catch{return  false}}function R(t){return typeof t=="function"&&t[D]===true}function xt(t){return typeof t=="object"&&t!==null&&!("__isProxy"in t)}function ee(t,e){let r=t.get(e);if(r!==void 0)return r;let o=t.get(Number(e)||e);if(o!==void 0)return o}function y(t,e,r){if(!e||e.length===0)return t;let o=Array.isArray(e)?e:e.split(d),s,n=t;for(let i=0;i<o.length;i++){let a=o[i];if(w(n))s=ee(n,a);else if(a in n)s=n[a];else return r;n=s;}return s}function g(t){try{["object","function"].includes(typeof t)&&(t[Y]=!0);}catch{}return t}function C(t,e,r,o){if(!e||!t)return t;let s=e;if(s.length===0)return typeof t=="object"&&Object.assign(t,r),t;{let n=t,i=[],a=(c,p,u)=>{o&&b(c[p])?c[p].value=u:c[p]=u;};for(let c=0;c<s.length;c++){let p=s[c];if(i.push(p),n)if(Array.isArray(n)){let u=parseInt(p,10);if(Number.isNaN(u)||u<0)throw new Error(`setVal: invalid array index ${i.join(".")}`);c===s.length-1?a(n,u,r):n=n[u];}else n instanceof Map||n instanceof WeakMap?c===s.length-1?n.set(p,r):(n.has(p)||n.set(p,{}),n=n.get(p)):typeof n=="object"&&p in n?c===s.length-1?a(n,p,r):n=n[p]:(n[p]=c===s.length-1?r:{},n=n[p]);else n[p]=c===s.length-1?r:{},n=n[p];}}return t}function W(t){return (t||["ROOT"]).map(e=>Array.isArray(e)?e.join("."):e).join(d)}function te(){return Math.random().toString(36).slice(2)}function G(t,e,r){let o=t&&!t[0].startsWith("#");if(Array.isArray(e))return e;if(e==="self")return o?t:void 0;if(e==="root")return o?[]:void 0;if(e==="parent")return o?t.slice(0,-2):void 0;if(e==="current")return o?t.slice(0,-1):void 0;if(typeof e=="string")return e.startsWith("./")?o?[...t.slice(0,-1),...e.slice(2).split(d)]:void 0:e.startsWith("../")?o?G(t.slice(0,-1),e.slice(3),true):void 0:e.startsWith("/")?e.replace(/^(\/)*/,"").split(d):o&&r?[...t.slice(0,-1),...e.split(d)]:e.split(d)}function j(t,e){return e?e.map(r=>G(t,r)).filter(r=>r!==void 0):[]}function Ht(t,e){let r="";return e.id?r=e.id:r=W(t),r}function Ve(t,e,r){let o=t,s=e.length-1;e.forEach((n,i)=>{let a=w(o);if(i===s){let c=a?o.get(n):o[n];typeof c=="object"&&Object.assign(c,r);return}a?(o.has(n)||o.set(n,{}),o=o.get(n)):(n in o||(o[n]={}),o=o[n]);});}function re(t,e){function r(o,s){for(let n in o){let i=o[n];typeof e=="function"&&e({value:i,key:n,parent:o,path:s.concat(n)}),typeof i=="object"&&!U(i)&&r(i,s.concat(n));}}r(t,[]);}function Ge(t){return t}function zt(t=1e3){return new Promise(e=>{setTimeout(e,t);})}function oe(t){let e=new Map;return t.forEach(r=>{let o=r.join(".");e.set(o,r);}),Array.from(e.values())}function De(t,e){return t.length>e.length?false:t.every((r,o)=>r===e[o])}function or(t,e,r){let o=[];return typeof t=="function"?o=e.collectDependencies(()=>t(e.state)):typeof t=="string"?o=[t.split(d)]:Array.isArray(t)?o=[[...t]]:o=[],r!=="none"&&o.forEach(s=>{let n=e.peep(i=>y(i,s));b(n)&&s.push(r==="all"?"*":"value");}),o}function ar(t,e){if(!e||e.length===0)return  false;let r,o=t;for(let s=0;s<e.length;s++){let n=e[s],i=false;if(w(o)){if(i=o.has(n),!i)return  false;r=ee(o,n);}else {if(i=n in o,!i)return  false;r=o[n];}o=r;}return  true}function S(t){return t?typeof t=="function":false}function se(t,e){let{reserveAsync:r,includeFunc:o}=Object.assign({reserveAsync:false},e);if(Array.isArray(t)){let s=[...t];for(let n=0;n<s.length;n++)s[n]=se(s[n],e);return s}else if(typeof t=="object"){if(!r&&b(t))return t.value;{let s={...t};for(let n in s)s[n]=se(s[n],e);return s}}return o&&S(t)?`\`\`\`${t.toString()}\`\`\``:t}function hr(t){return t==null||typeof t=="string"||typeof t=="number"||typeof t=="boolean"}function fr(t){globalThis.__AUTOSTORE_EXTENDS__&&(globalThis.__AUTOSTORE_EXTENDS__=[]),typeof t=="function"&&globalThis.__AUTOSTORE_EXTENDS__.push(t);}function Or(t,e,r){let o=R(e)?e():e;if(v(o)){if(o.options.objectify=false,Object.assign(o.options,r),o.type==="computed")return t.computedObjects.create(o);if(o.type==="watch")return t.watchObjects.create(o)}else if(typeof o=="function"){let n=Z(o)();return n.options.objectify=false,Object.assign(n.options,r),t.computedObjects.create(n)}}function xr(t){return v(t)||R(t)}function Tr(t,e,r){let o=y(t,typeof e=="string"?e.split(d):e,r);return b(o)?o:{value:o,loading:false,retry:0,error:null,timeout:0,progress:0,run:()=>{},cancel:()=>{}}}function Wr(t,e){return b(t)?Object.assign({},t,e):Object.assign({value:t,loading:false,retry:0,progress:0,timeout:0,error:null,run:()=>{},cancel:()=>{}},e)}function Lr(t){try{return t[T]===!0}catch{}return  false}function Te(t){let e=Array.isArray(t)?t[0]:t;return !!(e.startsWith("./")||e.startsWith("../")||["CURRENT","PARENT","SELF"].includes(e))}function ne(t){return typeof t=="function"&&t[T]===true}var ie=class extends Map{constructor(r){super();this.store=r;}get enable(){return this.store.options.enableComputed}set enable(r){this.store.options.enableComputed=r;}create(){let r=v(arguments[0])?arguments[0]:Z(...arguments)();if(r.options.async&&!fe(r.options.depends))throw new q("The scope of the dynamic computed object must be the root state object or an absolute path");let o=r.options.scope;if(o===void 0||o==="ROOT")r.options.scope="ROOT";else if(!fe([o]))throw new N("The scope of the dynamic computed object must be the root state object or an absolute path");return this.store._createComputed(r)}async runGroup(r,o,s){return await this.run(n=>n.group===r,o,s)}async run(){if(arguments.length===0)return Promise.all([...this.values()].map(i=>i.run()));let r;typeof arguments[0]=="function"?r=arguments[0]:typeof arguments[0]=="string"&&(r=i=>i.id===arguments[0]);let o=Object.assign({},arguments[1]),s=Object.assign({wait:false,timeout:0},arguments[2]),n={};return new Promise((i,a)=>{if(s.wait){let c;o.onDone=({id:p})=>{if(n[p]=true,Object.values(n).every(u=>u))return clearTimeout(c),true},s.timeout>0&&(c=setTimeout(()=>{a(new V);},s.timeout));}Promise.all([...this.values()].filter(c=>r(c)?(n[c.id]=false,true):false).map(c=>c.run(o))),s.wait||i();})}async enableGroup(r){for(let o of this.values())o.options.enable=r;}delete(r){return this.get(r)?.detach(),super.delete(r)}find(r){if(!r)return;let o=Array.isArray(r)?r:r.split(d);for(let s of this.values())if(A(s.path,o))return s}};function ye(t,...e){if(e.length===0)return t;let r=e.map((o,s)=>{let n=Object.entries(o||{});return n.some(([i,a])=>a===void 0)?n.reduce((i,[a,c])=>(c!==void 0&&(i[a]=c),i),{}):o});return Object.assign(t,...r)}(t=>typeof x<"u"?x:typeof Proxy<"u"?new Proxy(t,{get:(e,r)=>(typeof x<"u"?x:e)[r]}):t)(function(t){if(typeof x<"u")return x.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});function we(t,e="info"){let r=typeof t=="function"?t():t instanceof Error?t.stack:t;try{console[e](`[AutoStore<${this.id}>]`,...Array.isArray(r)?r:[r]);}catch{}}function P(t,e,r=d){let o=[];try{return typeof e=="function"&&(e=e.call(t,t)),o=Array.isArray(e)?e:typeof e=="string"?e.split(r):[],o.length>0?y(t,o):t}catch{return t}}var Re=(n=>(n.Root="ROOT",n.Current="CURRENT",n.Parent="PARENT",n.Depends="DEPENDS",n.Self="SELF",n))(Re||{});function $e(t,e,r){let o=e===void 0?r:e;if(typeof o=="function")try{o=o.call(t.store,t);}catch{}return o===void 0?r===void 0?"CURRENT":r:o}function L(t,e,r,o){let s=t.store.state,n=t.store.options;if(typeof n.getRootScope=="function"){let u=n.getRootScope(t,{observerType:e,valuePath:r?.path});u!==void 0&&(s=u);}let{path:i,parentPath:a}=r||{},c=$e(t,o.scope,n.scope),p=s;try{c==="CURRENT"?p=P(s,a):c==="PARENT"?p=P(s,i.slice(0,i.length-2<0?0:i.length-2)):c==="ROOT"?p=s:c==="DEPENDS"?p=t.depends?.map(u=>P(s,u)):typeof c=="string"?c.startsWith("@")?p=L(t,e,r,{...o,scope:L(t,e,{...r,path:c.slice(1).split(d)},{...o,scope:c.slice(1)})}):p=P(s,G(t.path,c)):Array.isArray(c)&&(p=P(s,c));}catch(u){n.log(`Error while getting computed scope ${t.toString()}: ${u.message}`,"error");}return p}var I=class{constructor(e,r,o){this.descriptor=r;this.context=o;this.store=e,this._associated=o!==void 0,this._getter=r.getter,this._options=Object.assign({enable:true,group:"",depends:[],throwError:true},r.options),this._id=this._options.id||(this._associated?W(o?.path):te()),this._path=o?.path||[`#${this._id}`],this._path||(this._path=[`#${this._id}`]),this._initial=this._options.initial,this.onInitOptions(this._options),this._depends=j(this._path,this._options.depends),this._onObserverCreated(),this._onInitial();}_path;_id="";_initial;_value;_associated=false;_attached=false;_getter;_depends=[];_options;_subscribers=[];_strPath;_error;store;_shadowStore;get shadowStore(){return this._shadowStore||(this._shadowStore=S(this.store.options.getShadowStore)?this.store.options.getShadowStore()||this.store:this.store),this._shadowStore}get type(){return this.descriptor.type}get options(){return this._options}get id(){return this._id}get associated(){return this._associated}get async(){return this._options.async}get enable(){return this._options.enable}set enable(e){this._options.enable=e;}set group(e){this._options.group=e;}get group(){return this._options.group}get initial(){return this._initial}set initial(e){this._initial=e;}get path(){return this._path}get attached(){return this._attached}get depends(){return this._depends}set depends(e){this._depends=e;}get getter(){return this._getter}set getter(e){this._getter=e;}get strPath(){return this._strPath||(this._strPath=this._path.join(d)),this._strPath}get error(){return this._error}set error(e){this._error=e;}toString(){return `ObserverObject<${this.strPath}>`}get value(){return this._associated?y(this.store.state,this._path):(this.store._notify({type:"get",path:this.path,value:this._value}),this._value)}set value(e){if(this._associated)C(this.store.state,this._path,e);else {let r=this._value;e!==r&&(this._value=e,this.store._notify({type:"set",path:this.path,value:e,oldValue:r}));}}_onObserverCreated(){typeof this.store.options.onObserverCreated=="function"&&this.store.options.onObserverCreated(this);}_onInitial(){this._options.initial!==void 0&&this.update(this._options.initial,{silent:true}),this.onInitial();}onInitial(){}onInitOptions(e){}update(e,r){this.store.update(()=>{this.value=e;},r);}silentUpdate(e){this.update(e,{silent:true});}watch(e,r){let o=this.store.watch(this.getValueWatchPath(),s=>{e.call(this,s);},r);return this._subscribers.push(o),o}getValueWatchPath(){return this.path.join(d)}emitStoreEvent(e,r){setTimeout(()=>{this.store.emit(e,r);},0);}getDepends(){return this.depends}onDependsChange(e){}attach(){!this._attached&&this.depends&&this.depends.length>0&&(this._subscribers.push(this.shadowStore.watch(this.getDepends(),this.onDependsChange.bind(this),{operates:"write"})),this.store.log(()=>`${this.toString()} subscribed to ${this.depends.map(e=>e.join(d)).join(",")}`),this._attached=true);}detach(){this._attached&&(this._subscribers.forEach(e=>{e.off();}),this._attached=false,this._subscribers=[],this.store.watchObjects.delete(this.id));}run(...e){}};var B=class extends I{constructor(r,o,s){super(r,o,s);this.descriptor=o;this.context=s;o.options.depends=j(this.path,this.options.depends);}toString(){return `ComputedObject<${W(this.path)}>`}get val(){return this.async?this.value.value:this.value}isDisable(r){return !this.store.options.enableComputed||!this.enable&&r!==true||r===false}run(r){throw new Error("Method not implemented.")}};var ae=class extends B{get async(){return  false}onInitial(){this.collectDependencies();}run(e){let{first:r,operate:o}=Object.assign({first:false,operate:void 0},e);if(this.error=void 0,!r&&this.isDisable(e?.enable)){this.store.log(`Sync computed <${this.toString()}> is disabled`,"warn");return}!r&&this.store.log(()=>`Run sync computed for : ${this.toString()}`);let s=e?Object.assign({},this.options,e):this.options,n=L(this,"computed",this.context,s),i=s.initial;try{i=this.getter.call(this,n,{operate:o,first:r});}catch(a){this.error=a;}this.onDone(r,i,s);}onDone(e,r,o){let s=r;if(this.error&&S(o.onError)){let n=o.onError(this.error);n!==void 0&&(s=n);}if(e&&(this.initial=s),this.store.peep(()=>{this.value=s;}),this.error){if(!e&&this.emitStoreEvent("computed:error",{id:this.id,path:this.path,error:this.error,computedObject:this}),this.options.throwError)throw this.error}else !e&&this.emitStoreEvent("computed:done",{id:this.id,path:this.path,value:s,computedObject:this});}collectDependencies(){let e=[],r=this.shadowStore.watch(o=>{e.push(o.path);},{operates:["get"]});this.run({first:true}),r.off(),Array.isArray(this.options.depends)&&this.options.depends.length>0&&e.push(...j(this.path,this.options.depends)),this.depends=oe(e),this.attach();}onDependsChange(e){this.run({operate:e});}};function We(t,e,r,o,s){return r==="push"?(...n)=>{let i=e.length,a=o.apply(e,n);if(e.length>i){let c=Array.from({length:e.length-i},(p,u)=>u+i);t({type:"insert",path:s,indexs:c,value:n,oldValue:void 0,parentPath:s,parent:e});}return a}:r==="pop"?()=>{let n=e.length,i=o.apply(e);return e.length===n-1&&t({type:"remove",path:s,indexs:[n-1],value:[i],oldValue:void 0,parentPath:s,parent:e}),i}:r==="splice"?(n,i,...a)=>{let c=o.apply(e,[n,i,...a]);if(c.length>0){let p=Array.from({length:c.length},(u,l)=>n+l);t({type:"remove",path:s,indexs:p,value:c,oldValue:void 0,parentPath:s,parent:e});}if(a.length>0){let p=Array.from({length:a.length},(u,l)=>n+l);t({type:"insert",path:s,indexs:p,value:a,oldValue:void 0,parentPath:s,parent:e});}return c}:r==="unshift"?(...n)=>{let i=e.length,a=o.apply(e,n);if(e.length>i){let c=Array.from({length:e.length-i},(p,u)=>u);t({type:"insert",path:s,indexs:c,value:n,oldValue:void 0,parentPath:s,parent:e});}return a}:r==="shift"?()=>{let n=e.length,i=o.apply(e);return e.length===n-1&&t({type:"remove",path:s,indexs:[0],value:[i],oldValue:void 0,parentPath:s,parent:e}),i}:r==="fill"?(n,i,a)=>{let c=o.apply(e,[n,i,a]),p=i??0,u=a??e.length,l=Array.from({length:u-p},(h,f)=>f+p),m=Array.from({length:u-p},()=>n);return t({type:"update",path:s,indexs:l,value:m,oldValue:void 0,parentPath:s,parent:e}),c}:r==="concat"?(...n)=>{let i=e.length,a=o.apply(e,n),c=Array.from({length:n.length},(p,u)=>i+u);return t({type:"insert",path:s,indexs:c,value:n,oldValue:void 0,parentPath:s,parent:e}),a}:o}function je(t){return typeof t=="number"||typeof t=="string"&&!Number.isNaN(parseInt(t))}var ge=Symbol("__NOTIFY__");function He(t,e,r,o,s){let n=this._updateValidateBehavior;if(n==="none")return  true;let i=this.schemas,a=i.get(e);if(!a)return  true;let c=a.onValidate||this.options.onValidate;if(typeof c!="function")return  true;let p=n!==void 0?n:a.onFail||"throw",u=true,l=a.invalidTips||"validate error",m=true,h;try{u=c.call(this,r,o,e)!==!1;}catch(f){h=f;}finally{if(u)delete i.errors[e.join("_$_")];else {if(S(l))try{l=l.call(this,h,e,r,o);}catch{}else h&&!l&&(l=h.message);if(typeof l=="string"&&l.includes("{")&&l.includes("}")){let f=i.get(e);f&&(l=l.replace(/\{([^}]+)\}/g,(O,H)=>f[H]));}i.errors[e.join(this.options.delimiter)]=l;}this.emit("validate",{path:[...s,...e],newValue:r,oldValue:o,error:l});}if(!u){if(p==="throw")throw new M(l);p==="throw-pass"?m=new M(l):p==="ignore"?m=false:m=true;}return m}function Pe(t,e,r,o,s){if(U(t)||typeof t!="object"||t===null)return t;if(r.has(t))return r.get(t);let n=new Proxy(t,{get:(i,a,c)=>{let p=Reflect.get(i,a,c);if(typeof a!="string")return p;let u=[...e,String(a)];if(typeof p=="function"||!Object.hasOwn(i,a))if(typeof p=="function"){if(Array.isArray(i)&&!je(a))return We(s.notify,i,a,p,e);if(!U(p)&&Object.hasOwn(i,a)){if(typeof this.options.onObserverInitial=="function")try{if(this.options.onObserverInitial.call(this,u,p,i)===!1)return g(p),p}catch(m){this.log(`onObserverBeforeCreate error: ${m.message}`,"error");}let l=u.join(".");try{if(o.has(l)){let m=[...o.keys(),l];throw o.clear(),new k(`Find circular dependency at <"${u}">, steps: ${m.join(" -> ")}`)}return o.set(l,!0),s.createObserverObject(u,p,e,i)}finally{o.delete(l);}}else return p}else return p;return s.notify({type:"get",path:u,indexs:[],value:p,oldValue:void 0,parentPath:e,parent:i}),Pe.call(this,p,u,r,o,s)},set:(i,a,c,p)=>{let u=Reflect.get(i,a,p),l=[...e,String(a)],m=He.call(this,n,l,c,u,e);if(m){let h=Reflect.set(i,a,c,p);if(a===ge)return  true;if(h&&a!==ge&&c!==u&&s.notify({type:Array.isArray(i)?"update":"set",path:l,indexs:[],value:c,oldValue:u,parentPath:e,parent:i}),m instanceof Error)throw m;return h}else return  true},deleteProperty:(i,a)=>{let c=i[a],p=[...e,String(a)],u=Reflect.deleteProperty(i,a);return u&&a!==ge&&(this.schemas.remove(p),s.notify({type:"delete",path:p,indexs:[],value:c,oldValue:void 0,parentPath:e,parent:i})),u}});return r.set(t,n),n}function Le(t,e){let r=new Map,o=new WeakMap;return Pe.call(this,t,[],o,r,e)}async function be(t){return new Promise((e,r)=>setTimeout(e,t))}function Ie(t){return t instanceof Error?t:new Error(t)}var pe=class extends B{_isRunning=false;_defaultAbortController=null;_userAbortController;_firstRun=false;get async(){return  true}get value(){return super.value}set value(e){super.value=e;}get running(){return this._isRunning}onInitOptions(e){e.reentry===void 0&&(e.reentry=this.store.options.reentry);}onInitial(){this.initial=this.createAsyncComputedValue(),this.attach(),setTimeout(()=>{(this.options.immediate===true||this.options.immediate==="auto"&&this.options.initial===void 0)&&this.run({first:true});},0);}createAsyncComputedValue(){return Object.assign({[X]:true,loading:false,timeout:0,retry:0,error:null,value:this.options.initial,progress:0,run:g(e=>this.store.computedObjects.run(this.id,Object.assign({},e))),cancel:g(()=>{this.getAbortController().abort();})})}updateComputedValue(e){let r=this.strPath,o=Object.keys(e).length;if(this.associated)this.store.update(s=>{Ve(s,this.path,e);},{batch:o>1?r:false});else {Object.assign(this.value,e);let s=o>1,n=[];Object.entries(e).forEach(([i,a])=>{let c={type:"set",path:[...this.path,i],value:a,parent:this.value};s&&(c.reply=true),this.store.operates.emit(`${this.strPath}.${i}`,c),n.push(c);}),s&&this.store.operates.emit(this.strPath,{type:"batch",path:this.path,value:n});}}async run(e){let{first:r}=e??{};if(this.isDisable(e?.enable)){this.store.log(()=>`Async computed <${this.toString()}> is disabled`,"warn");return}this.error=void 0,this._firstRun=true,!r&&this.store.log(()=>`Run async computed for : ${this.toString()}`);let o=e?Object.assign({first:r},this.options,e):this.options,s=L(this,"computed",this.context,o),{reentry:n}=o;if(this._isRunning&&!n){this.store.log(()=>`Async computed: ${this.toString()} is running, can't reentry`,"warn"),this.emitStoreEvent("computed:cancel",{path:this.path,id:this.id,reason:"reentry",computedObject:this});return}this._isRunning=true;try{return await this.executeGetter(s,o)}finally{this._isRunning=false;}}createComputeProgressbar(e){let{max:r=100,min:o=0,value:s=0}=Object.assign({},e);return this.updateComputedValue({progress:s}),{value:n=>{n>r&&(n=r),n<o&&(n=o),this.updateComputedValue({progress:n});},end(){this.value(r);}}}getAbortController(e){if(e&&typeof e.abortController=="function"){let r=e.abortController();r&&r instanceof AbortController&&(this._userAbortController=r);}return this._userAbortController?this._userAbortController:(this._defaultAbortController||(this._defaultAbortController=new AbortController),this._defaultAbortController.signal.aborted&&(this._defaultAbortController=new AbortController),this._defaultAbortController)}setTimeoutControl(e,r,o){let{timeout:s}=o,[n=0,i=0]=Array.isArray(s)?s:[s,0],a,c;return n>0&&(r.timeout=i>1?i:n,c=setTimeout(()=>{e.hasTimeout=true,e.hasError=true,e.error="TIMEOUT",typeof e.timeoutCallback=="function"&&e.timeoutCallback(),clearInterval(a),this.updateComputedValue({loading:false,error:"TIMEOUT",timeout:0});},n),i>1&&(a=setInterval(()=>{this.updateComputedValue({timeout:i--}),i===0&&clearInterval(a);},n/(i+1)))),{clear:()=>{clearTimeout(c),clearInterval(a);},enable:n>0}}async executeGetter(e,r){let{retry:o=[0,0]}=r,[s,n]=Array.isArray(o)?o:[Number(o),0],i,a=this.getAbortController(r),c={onTimeout:h=>{i=h;},getProgressbar:this.createComputeProgressbar.bind(this),getSnap:h=>h,cancel:a.abort,extras:r.extras,operate:r.operate,first:r.first,abortSignal:a.signal},p={error:null,hasError:false,hasTimeout:false,hasAbort:false,timeoutCallback:i};a.signal.addEventListener("abort",()=>{p.hasAbort=true;});let u={clear:()=>{},enable:false},l,m=h=>Object.assign(p,h);for(let h=0;h<s+1;h++){let f={};try{let O={loading:!0};if(p.hasError&&(O.error=null),s>0&&(O.retry=h>0?s-h+1:0),h>0&&m({error:null,hasError:!1,hasTimeout:!1}),u=this.setTimeoutControl(p,O,r),this.updateComputedValue(O),p.hasAbort)throw new F;if(l=await this.getter.call(this,e,c),p.hasAbort)throw new F;p.hasTimeout||(f.value=l,u.enable&&(f.timeout=0));}catch(O){if(p.hasError=true,p.error=O,p.hasTimeout||(f.error=Ie(O).message),S(r.onError)){let H=r.onError(O);H!==void 0&&(f.value=H);}}finally{u.clear(),h===s&&(p.hasTimeout&&(f.error=p.error),s>0&&(f.retry=0)),f.loading=false,this.updateComputedValue(f);}p.hasError&&s>0&&n>0&&h<s&&await be(n);}p.hasAbort?this.emitStoreEvent("computed:cancel",{path:this.path,id:this.id,computedObject:this}):p.hasError||p.hasTimeout?(this.error=p.error,this.emitStoreEvent("computed:error",{path:this.path,id:this.id,error:p.error,computedObject:this})):this.emitStoreEvent("computed:done",{path:this.path,id:this.id,value:l,computedObject:this}),this.onDoneCallback(r,p.error,p.hasAbort,p.hasTimeout,e,l);}onDoneCallback(e,r,o,s,n,i){typeof e.onDone=="function"&&e.onDone.call(this,{id:this.id,path:this.path,value:i,error:r,abort:o,timeout:s,scope:n});}onDependsChange(e){this.store.log(()=>`AsyncComputed<${this.id}> is running by depends ${e.type}/${e.path.join(".")} operate `),this.run({operate:e,first:!this._firstRun});}getValueWatchPath(){let e=this.path.join(d);return [`${e}.*`,e]}getDepends(){return super.getDepends().map(r=>{if(r.length===0)return r;for(let o of this.store.computedObjects.values())if(A(o.path,r)&&o.async)return [`${r}.value`];return r})}};function Be(){let t=arguments[0],e=typeof arguments[1]=="function"?arguments[1]:()=>true,r=typeof arguments[1]=="object"?arguments[1]:arguments[2],o=Object.assign({depends:[],enable:true,objectify:true,filter:e},r),s=()=>({type:"watch",getter:t,options:o});return s[D]=true,s}var ce=class extends Map{constructor(r){super();this.store=r;}_watcher={off:()=>{}};_enable=true;get enable(){return this._enable}set enable(r){this._enable=r;}set(r,o){return super.size===0&&this.createWacher(),super.set(r,o)}createWacher(){this._watcher=this.store.watch("**",({path:r,value:o})=>{if(!this._enable)return;let s=r[0].startsWith("#")?o:y(this.store.state,r);for(let n of this.values())n.isMatched(r,s)&&n.run(r,s);});}reset(){this._watcher&&this._watcher.off();for(let r of this.values())r.reset();this.createWacher();}create(){let r=v(arguments[0])?arguments[0]:Be(...arguments)();return this.store._createWatch(r)}enableGroup(r,o=true){for(let s of this.values())s.options.group===r&&(s.options.enable=o);}};var ue=class extends I{constructor(r,o,s){super(r,o,s);this.store=r;this.context=s;if(typeof this.options.filter!="function")throw new Error("watch options.filter must be a function")}_cache;get filter(){return this.options.filter}get cache(){return this._cache||(this._cache={}),this._cache}toString(){return `WatchObject<${this.id}>`}onInitial(){}isMatched(r,o){return J(r,this.path)?false:this.filter(r,o)}reset(){this._cache={},this.value=this.initial;}run(r,o){if(!this.enable){this.store.log(`WatchObject <${this.toString()}> is disabled`);return}try{let s=this.getter?.call(this,{path:r,value:o},this);this.value=s,this.emitStoreEvent("watch:done",{value:s,watchObject:this});}catch(s){this.emitStoreEvent("watch:error",{error:s,watchObject:this});}}};function Se(t,e){return new Proxy(t,{get(o,s,n){return s==="on"?(i,a,c)=>t.on(`${e}${d}${i}`,(p,u)=>a(p,u.slice(e.length+1)),c):s==="once"?(i,a)=>t.once(`${e}${d}${i}`,(c,p)=>{a(c,p.slice(e.length+1));}):s==="off"?(i,a)=>t.off(`${e}${d}${i}`,a):s==="emit"?(i,a)=>t.emit(`${e}${d}${i}`,a):s==="wait"?async(...i)=>{if(typeof i[0]=="string")return i[0]=`${e}${d}${i[0]}`,t.wait(...i);if(typeof i[0]=="function"){let a=i[0];return i[0]=(c,p)=>{c.startsWith(e)&&a(c.slice(e.length+1),p);},t.wait(...i)}}:s==="offAll"?()=>{for(let[i]of t.listeners.entries())i!=="*"&&typeof i=="string"&&i.startsWith(`${e}.`)&&t.listeners.delete(i);}:s==="onAny"?i=>t.on(`${e}${d}**`,(a,c)=>{i(a,c.slice(e.length+1));}):s==="scope"?i=>Se(t,`${e}${d}${i}`):Reflect.get(o,s,n)}})}var $=class{_listeners=new Map;get listeners(){return this._listeners}on(){let e=arguments[0],r=arguments[1],o=arguments[2],s=r;return e==="**"?this.addHandler("*",s,o):String(e).includes("*")?(s=(n,i)=>{xe(i,e)&&r(n,i);},this.addHandler("*",s,o)):this.addHandler(e,s,o),{off:()=>this.off(e,s)}}addHandler(e,r,o){let s=this._listeners.get(e);s?o?s.unshift(r):s.push(r):this._listeners.set(e,[r]);}once(e,r){let o=(s,n)=>{try{r(s,n);}finally{this.off(n,o);}};return this.on(e,o)}off(e,r){String(e).includes("*")&&(e="*");let o=this._listeners.get(e);o&&(r?o.splice(o.indexOf(r)>>>0,1):this._listeners.set(e,[]));}offAll(){this._listeners.clear();}onAny(e){return this.on("**",e)}wait(){let e=typeof arguments[0],r=e==="string"?arguments[0]:void 0,o=arguments[1]||0,s=e==="function"?e:void 0,n;return new Promise((i,a)=>{let c;r?c=this.once(r,p=>{clearTimeout(n),i(p);}):typeof s=="function"&&(c=this.onAny((p,u)=>{s(u,p)!==false&&(c.off(),clearTimeout(n),i(p));})),o>0&&(n=setTimeout(()=>{c.off(),a(new Error("timeout"));},o));})}emit(e,r){let o=this._listeners.get("*");o&&o.slice().map(s=>s(r,e)),o=this._listeners.get(e),o&&o.slice().map(s=>s(r,e));}scope(e){return Se(this,e)}};function Fe(t){let e;return R(t)?e=t():typeof t=="function"&&(e={type:"computed",getter:t,options:Object.assign({},Q(),{async:z(t)})}),e}function Oe(t,e){if(e==="*")return  true;if(e==="write"){if(t.type==="get")return}else if(e==="read"){if(t.type!=="get")return}else if(Array.isArray(e)&&e.length>0&&!e.includes(t.type))return;return  true}function Me(t){return typeof t=="string"&&t.startsWith("```")&&t.endsWith("```")}function le(t,e=()=>{}){t=t.replace(/^\s*`{3,}\w*(?:\r?\n|\n)/,"").replace(/^\s*`+\s*/,""),t=t.replace(/\s*`{3,}\s*$/,"").replace(/\s*`+\s*$/,""),t=t.replace(/^[\f\t\r\n]+/,""),t=t.replace(/^[\\]+(?=(?:async|function|\(|[A-Za-z_$]))/,"");let r=/^\s*(async\s+)?function(?:\s+\w+)?\s*\(([^)]*)\)\s*\{([\s\S]*)\}\s*;?\s*$/m.exec(t),o=/^\s*(async\s+)?\(([^)]*)\)\s*=>\s*(?:\{([\s\S]*)\}|(.+))\s*;?\s*$/m.exec(t),s=/^\s*(async\s+)?([A-Za-z_$][\w$]*)\s*=>\s*(?:\{([\s\S]*)\}|(.+))\s*;?\s*$/m.exec(t);if(!r&&!o&&!s)return;let n=false,i=[],a="";if(r){let[,u,l,m]=r;n=!!u,i=(l||"").split(",").map(h=>h.trim()).filter(Boolean),a=m;}else if(o){let[,u,l,m,h]=o;n=!!u,i=(l||"").split(",").map(f=>f.trim()).filter(Boolean),a=m||`return ${h}`;}else if(s){let[,u,l,m,h]=s;n=!!u,i=l?[l]:[],a=m||`return ${h}`;}let c=Object.getPrototypeOf(async function(){}).constructor,p=n?c:Function;try{return new p(...i,a)}catch{return e}}var de=class{constructor(e){this.shadow=e;}errors={};_subscribers=[];store;_descriptors={};get fields(){return this.store.state}get size(){return Object.keys(this.fields).length}_getKey(e){return Array.isArray(e)?e.join("_$_"):e.split(d).join("_$_")}_getPath(e){return e.split("_$_")}add(e,r){let o=ne(r)?r():r,s=Array.isArray(e)?e:e.split(d),n=this._getKey(e);o.options.onFail||(o.options.onFail="throw-pass");let i=Object.assign({},this.shadow.options.defaultSchemaOptions,o.options,{path:s,datatype:o.datatype,value:o.value});return Object.entries(i).forEach(([a,c])=>{if(Me(c)){let p=le(c);typeof p=="function"&&(a.startsWith("on")||a.startsWith("to")?i[a]=g(p):i[a]=p);}}),this._descriptors[n]=i,this.shadow&&o.value!==void 0&&o.flags!==-1&&this.shadow.update(a=>{C(a,s,o.value);},{validate:"pass",silent:true}),o}build(){this.store||this._descriptors&&(this.store=this.shadow.shadow(this._descriptors));}get(e){if(this.store)return y(this.store.state,[this._getKey(e)])}has(e){return this.store?this._getKey(e)in this.store.state:false}watch(){return this.store.watch(...arguemnts)}getValidator(e){if(!this.store)return;let r=this.get(e);if(r)return {validate:r.onValidate,onFail:r.onFail,message:r.invalidTips}}addValidator(e,r){if(!this.store)return;let o=this._getKey(e);this.store.update(s=>{Object.assign(s[o],{onValidate:g(r.validate),onFail:r.onFail||"throw-pass",invalidTips:r.message});});}remove(e){let r=this._getKey(e);this.store&&delete this.store.state[r];}getValues(){let e={};return Object.entries(this._descriptors||{}).forEach(([r,o])=>{let s=this._getPath(r),n=o.name??s.join(d);this.shadow.peep(i=>{e[n]=y(i,s);});}),e}find(e){let r=Array.isArray(e)?e:e.split(d);return Object.entries(this.fields).filter(([o])=>De(r,this._getPath(o))).map(([o,s])=>s)}};function ke(t){Ce(t)&&re(t,({value:e,key:r,parent:o})=>{S(e)&&(r.startsWith("on")||r.startsWith("render")||r.startsWith("to"))&&(o[r]=g(e));});}function Ke(t){let e={value:t[0],options:Object.assign({onFail:"throw-pass"},t[1])};if(!e.options.widget&&typeof e.options.toInput!="function"){let r=typeof e.value;r==="boolean"?e.options.widget="checkbox":r==="number"&&(e.options.widget="number"),Array.isArray(e.options.select)&&(e.options.widget="select");}return "onValidate"in e.options&&g(e.options.onValidate),ke(e.options),e}var _e=function(){let t=arguments[0],e=arguments[1],r=Ke([t,e]),o=t,s=Array.isArray(o)?"array":typeof o;typeof o=="object"&&g(o);let n=()=>({value:o,datatype:s,options:r.options});return n[T]=true,n},Sn=_e,On=_e;function E(t,e){return function(){let o=Object.assign({},arguments[1]);return typeof o.onValidate!="function"&&(o.onValidate=t),o.invalidTips||(o.invalidTips=e),_e(arguments[0],o)}}var Ne={number:E(t=>typeof t=="number","must be a number"),string:E(t=>typeof t=="string","must be a string"),boolean:E(t=>typeof t=="boolean","must be a boolean"),date:E(t=>t instanceof Date,"must be a date"),bigint:E(t=>typeof t=="bigint","must be a bigint"),array:E(t=>Array.isArray(t),"must be an array"),object:E(t=>typeof t=="object","must be an object")},_n=Ne;function Ue(t,e,r){let o=new he(e,Object.assign({},r,{id:`${t.id}_shadow`,getRootScope:()=>t.state,getShadowStore:()=>t,debug:t.options.debug,shadow:true,onObserverBeforeCreate:s=>{let n=s.options.scope;(!n||Te(n))&&(s.options.scope="ROOT");}}));return t.watch(s=>{s.shadow=true,o.operates.emit(s.path.join(d),s);}),o}var he=class extends ${_data;computedObjects;watchObjects;_operates=new $;_options;_silenting=false;_batching=false;_batchOperates=[];_updateFlags=0;_peeping=false;_updateValidateBehavior;_updatedState;_updatedWatcher;_schemas;_delimiter=".";types={rawState:void 0,state:void 0,schemas:void 0,schemaKeys:void 0};constructor(e,r){super(),this._options=ye({id:te(),debug:false,enableComputed:true,reentry:true,resetable:false,delimiter:".",log:we,shadow:false},r),this._delimiter=this._options.delimiter,this.computedObjects=new ie(this),this.watchObjects=new ce(this),this.subscribeCallbacks(),this._data=Le.call(this,e||{},{notify:this._notify.bind(this),createObserverObject:this.createObserverObject.bind(this)}),this.getSnap=this.getSnap.bind(this),this.watch=this.watch.bind(this),this.update=this.update.bind(this),this.peep=this.peep.bind(this),this.silentUpdate=this.silentUpdate.bind(this),this.batchUpdate=this.batchUpdate.bind(this),this.trace=this.trace.bind(this),this.collectDependencies=this.collectDependencies.bind(this),this.installExtends(),this._schemas=new de(this),re(this._data,this._onFirstEachState.bind(this)),this._options.shadow||this.schemas.build(),this._options.resetable&&(this.resetable=true),this._options.debug&&typeof globalThis.__AUTOSTORE_DEVTOOLS__=="object"&&globalThis.__AUTOSTORE_DEVTOOLS__.add(this),this.emit("load",this);}get id(){return this._options.id}get state(){return this._data}get operates(){return this._operates}get options(){return this._options}get silenting(){return this._silenting}get delimiter(){return this._delimiter}get batching(){return this._batching}get peeping(){return this._peeping}get resetable(){return this._options.resetable}get schemas(){return this._schemas}set resetable(e){if(e){if(this._updatedWatcher)return;this._updatedState={},this._updatedWatcher=this.watch(({path:r,oldValue:o})=>{if(r.length===0)return;let s=r.join(this._delimiter);!s.startsWith("#")&&!(s in this._updatedState)&&(this._updatedState[s]=o);},{operates:"write"});}else this._updatedWatcher&&(this._updatedWatcher.off(),this._updatedWatcher=void 0),this._updatedState={};this._options.resetable=e;}reset(e){if(this._options.resetable&&this._updatedState)try{this.batchUpdate(r=>{let o=e?`${e}${this._delimiter}`:"";Object.entries(this._updatedState).forEach(([s,n])=>{s.startsWith(o)&&C(r,s.split(this._delimiter),n);});});}finally{this.emit("reset",e);}else this.log("resetable option is not enabled","warn");}_onFirstEachState({value:e,path:r}){typeof e=="string"&&e.startsWith("```")&&e.endsWith("```")&&this.update(o=>{let s=le(e.slice(3,e.length-3));g(s),C(o,r,s);},{silent:true});}log(e,r){this._options.debug&&this.options.log.call(this,e,r);}installExtends(){let e=globalThis.__AUTOSTORE_EXTENDS__;Array.isArray(e)&&e.forEach(r=>{typeof r=="function"&&r(this);});}subscribeCallbacks(){this._options.onComputedCreated&&this.on("computed:created",this._options.onComputedCreated.bind(this)),this._options.onComputedDone&&this.on("computed:done",this._options.onComputedDone.bind(this)),this._options.onComputedError&&this.on("computed:error",this._options.onComputedError.bind(this)),this._options.onComputedCancel&&this.on("computed:cancel",this._options.onComputedCancel.bind(this)),this._options.onObserverBeforeCreate&&this.on("observer:beforeCreate",this._options.onObserverBeforeCreate.bind(this));}_notify(e){this._peeping&&e.type==="get"||(this._batching&&this._batchOperates.push(e),!this._silenting&&(e.flags=this._updateFlags,this.operates.emit(e.path.join(this._delimiter),e)));}watch(){let e=typeof arguments[0]=="function"||["*","**"].includes(arguments[0])||Array.isArray(arguments[0])&&arguments[0].length===0,r=typeof arguments[0]=="function"?arguments[0]:arguments[1],o=arguments.length>=2&&typeof arguments[arguments.length-1]=="object"?arguments[arguments.length-1]:void 0,s=(n,i)=>a=>{if(Oe(a,n)&&!(typeof i=="function"&&!i(a)))try{if(this._peeping=!0,a.type==="batch"){let c=a.value.filter(p=>Oe(p,n));if(c.length>0)a.value=c;else return}r(a);}finally{this._peeping=false;}};if(e){let{operates:n,filter:i}=Object.assign({once:false,operates:"write"},o),a=s(n,i);return this.operates.onAny(a)}else {let n=arguments[0],i=Array.isArray(n)?n.map(h=>typeof h=="string"?h:h.join(this._delimiter)):[n],{once:a,operates:c,filter:p}=Object.assign({once:false,operates:"write"},o),u=a?this.operates.once.bind(this.operates):this.operates.on.bind(this.operates),l=[],m=s(c,p);return i.forEach(h=>{l.push(u.call(this,h,m));}),{off:()=>l.forEach(h=>{h.off();})}}}createObserverObject(e,r,o,s){if(ne(r))return this.schemas.add(e,r).value;{let n=Fe(r),i={path:e,value:r,parentPath:o,parent:s};if(n){if(n.type==="computed")return this._createComputed(n,i)?.initial;if(n.type==="watch")return this._createWatch(n,i)?.initial}else return r}}_createComputed(e,r){let o;return this.emit("observer:beforeCreate",e),e.options.async?o=new pe(this,e,r):o=new ae(this,e,r),o&&(o.silentUpdate(o.initial),o.options.objectify&&this.computedObjects.set(o.id,o),this.emit("computed:created",o),this.emit("observer:afterCreate",e)),o}_createWatch(e,r){this.emit("observer:beforeCreate",e);let o=new ue(this,e,r);return this.watchObjects.set(o.id,o),this.emit("watch:created",o),this.emit("observer:afterCreate",e),o}silentUpdate(e){this.update(e,{silent:true});}batchUpdate(e){this.update(e,{batch:true,validate:"pass"});}update(e,r){let{batch:o=false,reply:s=true,silent:n=false,peep:i=false,flags:a=0,validate:c}=Object.assign({},r);if(typeof e=="function"){this._updateFlags=a,this._updateValidateBehavior=c,n&&(this._silenting=true),o&&(this._batching=true,this._silenting=true),i&&(this._peeping=true);try{let p=e(this.state);if(o&&Ee(p))throw new Error("Batch update method can't be async function")}finally{this._silenting=false,this._batching=false,this._peeping=false,this._updateFlags=0,this._updateValidateBehavior=void 0,this.replyBatchOperates(s,o);}}else throw new Error("update method must provide a function argument")}replyBatchOperates(e,r){if(this._batchOperates.length>0){let o=[...this._batchOperates];this._batchOperates=[],e&&o.forEach(s=>{s.reply=true,this._notify(s);});try{let s=r===!0?Ae:String(r);this.operates.emit(s,{type:"batch",path:[s],value:o});}finally{this._batchOperates=[];}}}peep(){let e=typeof arguments[0]=="function"?()=>arguments[0](this.state):()=>y(this.state,Array.isArray(arguments[0])?arguments[0]:arguments[0].split(this._delimiter));this._peeping=true;try{return e()}finally{this._peeping=false;}}collectDependencies(e,r="*"){let o=[],s=this.watch(n=>{o.push(n.path);},{operates:r});try{e();}finally{s.off();}return oe(o)}trace(e,r="*"){let o;return {stop:()=>o?.off(),start:async s=>{let n=[];return new Promise(i=>{o=this.watch(a=>{n.push(a),s?.(a)&&(o.off(),i(n));},{operates:r}),Promise.resolve(e()).finally(()=>{typeof s!="function"&&(o.off(),i(n));});})}}}destroy(){this.offAll(),this._operates.offAll(),this.watchObjects.clear(),this.computedObjects.clear(),this.emit("unload",this);}getSnap(e){let{reserveAsync:r,entry:o,includeFunc:s}=Object.assign({reserveAsync:true},e);return se(o?y(this._data,o):this._data,{reserveAsync:r,includeFunc:s})}shadow(e,r){return Ue(this,e,r)}get(e,r){let{defaultValue:o,timeout:s=0,expandAsync:n=false,waitAsyncDone:i=false}=Object.assign({},r),a=Array.isArray(e)?e:e.split(this.delimiter),c=y(this.state,a,o);return b(c)?c.loading&&i?new Promise((p,u)=>{let l,m;s>0&&(l=setTimeout(()=>{m?.off(),u(new V);},s)),m=this.on("computed:done",({path:h})=>{A(a,h)&&(clearTimeout(l),m?.off(),p(n?c.value:c));});}):n?c.value:c:c}toString(){return `AutoStore<${this.id}>`}};exports.ASYNC_COMPUTED_VALUE=X;exports.AbortError=F;exports.AsyncComputedObject=pe;exports.AutoStore=he;exports.AutoStoreError=_;exports.BATCH_UPDATE_EVENT=Ae;exports.ComputedObject=B;exports.ComputedObjects=ie;exports.CyleDependError=k;exports.DELETE_FLAG=ze;exports.EMPTY=Xe;exports.EventEmitter=$;exports.InvalidComputedArgumentsError=K;exports.InvalidDependsError=q;exports.InvalidScopeError=N;exports.OBSERVER_DESCRIPTOR_BUILDER_FLAG=D;exports.OBSERVER_DESCRIPTOR_FLAG=ve;exports.ObserverObject=I;exports.ObserverScopeRef=Re;exports.PATH_DELIMITER=d;exports.SKIP_PROXY_FLAG=Y;exports.SchemaManager=de;exports.SyncComputedObject=ae;exports.TimeoutError=V;exports.VALUE_SCHEMA_BUILDER_FLAG=T;exports.ValidateError=M;exports.WatchObject=ue;exports.WatchObjects=ce;exports.c=On;exports.calcDependPaths=j;exports.computed=Z;exports.configurable=Sn;exports.createAsyncComptuedValue=Wr;exports.createObserverObject=Or;exports.createTypeSchemaBuilder=E;exports.defineExtend=fr;exports.delay=zt;exports.forEachObject=re;exports.getAsyncVal=Tr;exports.getComputedId=Ht;exports.getDepends=or;exports.getId=te;exports.getMapVal=ee;exports.getSnap=Ge;exports.getSnapshot=se;exports.getVal=y;exports.isAbsolutePath=fe;exports.isAsyncComputedValue=b;exports.isComputedDescriptorParameter=xr;exports.isEq=J;exports.isFunction=S;exports.isMap=w;exports.isObserverDescriptor=v;exports.isObserverDescriptorBuilder=R;exports.isPathEq=A;exports.isPathMatched=xe;exports.isPlainObject=Ce;exports.isPrimitive=hr;exports.isPromise=Ee;exports.isProxy=xt;exports.isRaw=U;exports.isRelPath=Te;exports.isSchemaBuilder=ne;exports.isValueSchema=Lr;exports.joinValuePath=W;exports.markRaw=g;exports.noRepeat=oe;exports.normalizeDeps=me;exports.pathIsExists=ar;exports.pathStartsWith=De;exports.s=_n;exports.schema=_e;exports.schemas=Ne;exports.setVal=C;exports.updateObjectVal=Ve;exports.watch=Be;return exports;})({});//# sourceMappingURL=index.global.js.map
//# sourceMappingURL=index.global.js.map