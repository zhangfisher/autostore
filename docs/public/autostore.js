var AutoStoreSpaces=(function(exports){'use strict';var mt=Object.defineProperty;var Xr=Object.getOwnPropertyDescriptor;var zr=Object.getOwnPropertyNames;var kr=Object.prototype.hasOwnProperty;var o=(e,t)=>mt(e,"name",{value:t,configurable:true}),P=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,r)=>(typeof require<"u"?require:t)[r]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')});var c=(e,t)=>()=>(e&&(t=e(e=0)),t);var Qr=(e,t)=>{for(var r in t)mt(e,r,{get:t[r],enumerable:true});},Jr=(e,t,r,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of zr(t))!kr.call(e,i)&&i!==r&&mt(e,i,{get:()=>t[i],enumerable:!(s=Xr(t,i))||s.enumerable});return e};var Le=e=>Jr(mt({},"__esModule",{value:true}),e);var Qt=c(()=>{(e=>typeof P<"u"?P:typeof Proxy<"u"?new Proxy(e,{get:o((t,r)=>(typeof P<"u"?P:t)[r],"get")}):e)(function(e){if(typeof P<"u")return P.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')});});exports.AutoStoreError=void 0;exports.AbortError=void 0;exports.TimeoutError=void 0;exports.CyleDependError=void 0;exports.InvalidComputedArgumentsError=void 0;exports.InvalidScopeError=void 0;exports.InvalidDependsError=void 0;exports.ValidateError=void 0;var D=c(()=>{exports.AutoStoreError=class extends Error{static{o(this,"AutoStoreError");}},exports.AbortError=class extends exports.AutoStoreError{static{o(this,"AbortError");}},exports.TimeoutError=class extends exports.AutoStoreError{static{o(this,"TimeoutError");}},exports.CyleDependError=class extends exports.AutoStoreError{static{o(this,"CyleDependError");}},exports.InvalidComputedArgumentsError=class extends exports.AutoStoreError{static{o(this,"InvalidComputedArgumentsError");}},exports.InvalidScopeError=class extends exports.AutoStoreError{static{o(this,"InvalidScopeError");}},exports.InvalidDependsError=class extends exports.AutoStoreError{static{o(this,"InvalidDependsError");}},exports.ValidateError=class extends exports.AutoStoreError{static{o(this,"ValidateError");}behavior};});exports.SKIP_PROXY_FLAG=void 0;exports.OBSERVER_DESCRIPTOR_BUILDER_FLAG=void 0;exports.OBSERVER_DESCRIPTOR_FLAG=void 0;exports.PATH_DELIMITER=void 0;exports.BATCH_UPDATE_EVENT=void 0;exports.ASYNC_COMPUTED_VALUE=void 0;exports.EMPTY=void 0;exports.VALUE_SCHEMA_BUILDER_FLAG=void 0;exports.DELETE_FLAG=void 0;exports.GLOBAL_CONFIG_MANAGER=void 0;var y=c(()=>{exports.SKIP_PROXY_FLAG="__AS_SKIP_PROXY__",exports.OBSERVER_DESCRIPTOR_BUILDER_FLAG="__AS_OBSERVER_DESCRIPTOR_BUILDER__",exports.OBSERVER_DESCRIPTOR_FLAG="__AS_OBSERVER_DESCRIPTOR__",exports.PATH_DELIMITER=".",exports.BATCH_UPDATE_EVENT="__batch_update__",exports.ASYNC_COMPUTED_VALUE="__AS_ASYNC_COMPUTED_VALUE__",exports.EMPTY="__AS_EMPTY__",exports.VALUE_SCHEMA_BUILDER_FLAG="__AS_VALUE_SCHEMA__",exports.DELETE_FLAG="__AS_DELETE_FLAG__",exports.GLOBAL_CONFIG_MANAGER="AutoStoreConfigManager";});function Ot(e){return e.constructor.name==="AsyncFunction"}var Jt=c(()=>{o(Ot,"isAsyncFunction");});function Zt(e){return e?e.map(t=>Array.isArray(t)?t:typeof t=="string"?["/","./","../"].some(r=>t.startsWith(r))?t:t.includes(".")?t.split("."):t.split("."):[]):[]}var te=c(()=>{y();o(Zt,"normalizeDeps");});function St(){return {async:false,enable:true,timeout:0,depends:[],immediate:"auto",extras:void 0,objectify:true}}var ee=c(()=>{o(St,"getDefaultComputedOptions");});function G(){let e=arguments[0];if(typeof e!="function")throw new Error("computed getter must be a function");let t=[],r=Object.assign({},St());if(arguments.length===1)t=[];else if(arguments.length===2)if(Array.isArray(arguments[1]))r.depends=arguments[1];else if(typeof arguments[1]=="object")Object.assign(r,arguments[1]),r.depends=Zt(r.depends);else throw new exports.InvalidComputedArgumentsError;else arguments.length>=3&&(t=Zt(arguments[1]),Object.assign(r,arguments[2]),r.depends=t);r.async=r.async===true||Ot(e)||arguments.length>=2&&Array.isArray(arguments[1]);let s=o(()=>({type:"computed",getter:e,options:r,[exports.OBSERVER_DESCRIPTOR_FLAG]:true}),"descriptorBuilder");return s[exports.OBSERVER_DESCRIPTOR_BUILDER_FLAG]=true,s}var et=c(()=>{y();D();Jt();te();ee();o(G,"computed");});function re(e){return e?e.some(t=>typeof t=="string"?t.startsWith("./")||t.startsWith("../")||t.startsWith("@")?false:!["CURRENT","SELF","PARENT"].includes(t):true):false}var se=c(()=>{o(re,"isAbsolutePath");});function C(e){return typeof e=="object"&&e.hasOwnProperty("type")&&typeof e.type=="string"&&e.hasOwnProperty("getter")&&typeof e.getter=="function"&&e.hasOwnProperty("options")&&typeof e.options=="object"}var rt=c(()=>{o(C,"isObserverDescriptor");});function st(e){try{return e[exports.SKIP_PROXY_FLAG]===!0}catch{}return  false}var it=c(()=>{y();o(st,"isRaw");});function wt(e,t){if(e===t)return  true;if(e===null||t===null||typeof e!=typeof t)return  false;if(typeof e=="object"){if(Array.isArray(e)&&Array.isArray(t))return e.length!==t.length?false:e.every((r,s)=>wt(r,t[s]));if(!Array.isArray(e)&&!Array.isArray(t)){let r=Object.keys(e);return r.length!==Object.keys(t).length?false:r.every(s=>wt(e[s],t[s]))}else return  false}return  false}var ie=c(()=>{o(wt,"isEq");});function K(e){return toString.call(e)==="[object Map]"}var nt=c(()=>{o(K,"isMap");});function V(e,t){return !e||!t||e.length!==t.length?false:e.every((r,s)=>r===t[s])}var ne=c(()=>{o(V,"isPathEq");});function We(e,t){let r=Array.isArray(e)?e:e.split("."),s=Array.isArray(t)?t:t===""?[]:t.split(".");return s.length===0||V(r,s)?true:(s[s.length-1]==="**"&&(s[s.length-1]="*",s.splice(s.length-1,0,...Array.from({length:r.length-s.length}).fill("*"))),r.length!==s.length?false:s.every((n,a)=>n==="*"||n==="**"?true:n===r[a]))}var oe=c(()=>{y();ne();o(We,"isPathMatched");});function jt(e){return e==null||typeof e!="object"?false:Object.prototype.toString.call(e)==="[object Object]"}var ae=c(()=>{o(jt,"isPlainObject");});function w(e){return e&&typeof e=="object"&&e.hasOwnProperty(exports.ASYNC_COMPUTED_VALUE)}var I=c(()=>{y();o(w,"isAsyncComputedValue");});function Ue(e){try{return !!e&&(typeof e=="object"||typeof e=="function")&&typeof e.then=="function"&&typeof e.catch=="function"&&(e instanceof Promise||Object.prototype.toString.call(e)==="[object Promise]")}catch{return  false}}var le=c(()=>{o(Ue,"isPromise");});function H(e){return typeof e=="function"&&e[exports.OBSERVER_DESCRIPTOR_BUILDER_FLAG]===true}var ot=c(()=>{y();o(H,"isObserverDescriptorBuilder");});function Vn(e){return typeof e=="object"&&e!==null&&!("__isProxy"in e)}var Ne=c(()=>{o(Vn,"isProxy");});function Tt(e,t){let r=e.get(t);if(r!==void 0)return r;let s=e.get(Number(t)||t);if(s!==void 0)return s}var Ct=c(()=>{o(Tt,"getMapVal");});function x(e,t,r){if(!t||t.length===0)return e;let s=Array.isArray(t)?t:t.split("."),i,n=e;for(let a=0;a<s.length;a++){let l=s[a];if(K(n))i=Tt(n,l);else if(l in n)i=n[l];else return r;n=i;}return i}var F=c(()=>{y();Ct();nt();o(x,"getVal");});function R(e){try{["object","function"].includes(typeof e)&&(e[exports.SKIP_PROXY_FLAG]=!0);}catch{}return e}var Vt=c(()=>{y();o(R,"markRaw");});function L(e,t,r,s){if(!t||!e)return e;let i=t;if(i.length===0)return typeof e=="object"&&Object.assign(e,r),e;{let n=e,a=[],l=o((f,u,p)=>{s&&w(f[u])?f[u].value=p:f[u]=p;},"update");for(let f=0;f<i.length;f++){let u=i[f];if(a.push(u),n)if(Array.isArray(n)){let p=parseInt(u,10);if(Number.isNaN(p)||p<0)throw new Error(`setVal: invalid array index ${a.join(".")}`);f===i.length-1?l(n,p,r):n=n[p];}else n instanceof Map||n instanceof WeakMap?f===i.length-1?n.set(u,r):(n.has(u)||n.set(u,{}),n=n.get(u)):typeof n=="object"&&u in n?f===i.length-1?l(n,u,r):n=n[u]:(n[u]=f===i.length-1?r:{},n=n[u]);else n[u]=f===i.length-1?r:{},n=n[u];}}return e}var ue=c(()=>{I();o(L,"setVal");});function q(e){return (e||["ROOT"]).map(t=>Array.isArray(t)?t.join("."):t).join(".")}var at=c(()=>{y();o(q,"joinValuePath");});function Rt(){return Math.random().toString(36).slice(2)}var Lt=c(()=>{o(Rt,"getId");});function lt(e,t,r){let s=e&&!e[0].startsWith("#");if(Array.isArray(t))return t;if(t==="self")return s?e:void 0;if(t==="root")return s?[]:void 0;if(t==="parent")return s?e.slice(0,-2):void 0;if(t==="current")return s?e.slice(0,-1):void 0;if(typeof t=="string")return t.startsWith("./")?s?[...e.slice(0,-1),...t.slice(2).split(".")]:void 0:t.startsWith("../")?s?lt(e.slice(0,-1),t.slice(3),true):void 0:t.startsWith("/")?t.replace(/^(\/)*/,"").split("."):s&&r?[...e.slice(0,-1),...t.split(".")]:t.split(".")}var fe=c(()=>{y();o(lt,"getFullValuePath");});function Y(e,t){return t?t.map(r=>lt(e,r)).filter(r=>r!==void 0):[]}var ut=c(()=>{fe();o(Y,"calcDependPaths");});function io(e,t){let r="";return t.id?r=t.id:r=q(e),r}var Be=c(()=>{at();o(io,"getComputedId");});function Ge(e,t,r){let s=e,i=t.length-1;t.forEach((n,a)=>{let l=K(s);if(a===i){let f=l?s.get(n):s[n];typeof f=="object"&&Object.assign(f,r);return}l?(s.has(n)||s.set(n,{}),s=s.get(n)):(n in s||(s[n]={}),s=s[n]);});}var ce=c(()=>{nt();o(Ge,"updateObjectVal");});function Mt(e,t){function r(s,i){for(let n in s){let a=s[n];typeof t=="function"&&t({value:a,key:n,parent:s,path:i.concat(n)}),typeof a=="object"&&!st(a)&&r(a,i.concat(n));}}o(r,"_forEachObject"),r(e,[]);}var Ke=c(()=>{it();o(Mt,"forEachObject");});function es(e){return e}var pe=c(()=>{o(es,"getSnap");});function go(e=1e3){return new Promise(t=>{setTimeout(t,e);})}var He=c(()=>{o(go,"delay");});function Pt(e){let t=new Map;return e.forEach(r=>{let s=r.join(".");t.set(s,r);}),Array.from(t.values())}var Dt=c(()=>{o(Pt,"noRepeat");});function Eo(e,t){return e.length>t.length?false:e.every((r,s)=>r===t[s])}var qe=c(()=>{o(Eo,"pathStartsWith");});function jo(e,t,r){let s=[];return typeof e=="function"?s=t.collectDependencies(()=>e(t.state)):typeof e=="string"?s=[e.split(".")]:Array.isArray(e)?s=[[...e]]:s=[],r!=="none"&&s.forEach(i=>{let n=t.peep(a=>x(a,i));w(n)&&i.push(r==="all"?"*":"value");}),s}var Ye=c(()=>{y();F();I();o(jo,"getDepends");});function Lo(e,t){if(!t||t.length===0)return  false;let r,s=e;for(let i=0;i<t.length;i++){let n=t[i],a=false;if(K(s)){if(a=s.has(n),!a)return  false;r=Tt(s,n);}else {if(a=n in s,!a)return  false;r=s[n];}s=r;}return  true}var Xe=c(()=>{Ct();nt();o(Lo,"pathIsExists");});function v(e){return e?typeof e=="function":false}var ft=c(()=>{o(v,"isFunction");});function It(e,t){let{reserveAsync:r,includeFunc:s}=Object.assign({reserveAsync:false},t);if(Array.isArray(e)){let i=[...e];for(let n=0;n<i.length;n++)i[n]=It(i[n],t);return i}else if(typeof e=="object"){if(!r&&w(e))return e.value;{let i={...e};for(let n in i)i[n]=It(i[n],t);return i}}return s&&v(e)?`\`\`\`${e.toString()}\`\`\``:e}var ze=c(()=>{I();ft();o(It,"getSnapshot");});function No(e){return e==null||typeof e=="string"||typeof e=="number"||typeof e=="boolean"}var ke=c(()=>{o(No,"isPrimitive");});function Ko(e){globalThis.__AUTOSTORE_EXTENDS__&&(globalThis.__AUTOSTORE_EXTENDS__=[]),typeof e=="function"&&globalThis.__AUTOSTORE_EXTENDS__.push(e);}var Qe=c(()=>{o(Ko,"defineExtend");});function ko(e,t,r){let s=H(t)?t():t;if(C(s)){if(s.options.objectify=false,Object.assign(s.options,r),s.type==="computed")return e.computedObjects.create(s);if(s.type==="watch")return e.watchObjects.create(s)}else if(typeof s=="function"){let n=G(s)();return n.options.objectify=false,Object.assign(n.options,r),e.computedObjects.create(n)}}var Je=c(()=>{et();rt();ot();o(ko,"createObserverObject");});function ea(e){return C(e)||H(e)}var Ze=c(()=>{rt();ot();o(ea,"isComputedDescriptorParameter");});function aa(e,t,r){let s=x(e,typeof t=="string"?t.split("."):t,r);return w(s)?s:{value:s,loading:false,retry:0,error:null,timeout:0,progress:0,run:o(()=>{},"run"),cancel:o(()=>{},"cancel")}}var tr=c(()=>{y();F();I();o(aa,"getAsyncVal");});function ca(e,t){return w(e)?Object.assign({},e,t):Object.assign({value:e,loading:false,retry:0,progress:0,timeout:0,error:null,run:o(()=>{},"run"),cancel:o(()=>{},"cancel")},t)}var er=c(()=>{I();o(ca,"createAsyncComptuedValue");});function ma(e){try{return e[exports.VALUE_SCHEMA_BUILDER_FLAG]===!0}catch{}return  false}var rr=c(()=>{y();o(ma,"isValueSchema");});function ya(e){let t=Array.isArray(e)?e[0]:e;return !!(t.startsWith("./")||t.startsWith("../")||["CURRENT","PARENT","SELF"].includes(t))}var sr=c(()=>{o(ya,"isRelPath");});function ct(e){return typeof e=="function"&&e[exports.VALUE_SCHEMA_BUILDER_FLAG]===true}var ir=c(()=>{y();o(ct,"isSchemaBuilder");});function or(e,t){return Object.assign({validate:"throw"},t,{[exports.WITH_SCHEMA_VALUE]:true,value:e})}function rs(e){return e&&typeof e=="object"&&e[exports.WITH_SCHEMA_VALUE]===true}function ar(e){return rs(e)?[e.value,e]:[e,void 0]}exports.WITH_SCHEMA_VALUE=void 0;var he=c(()=>{exports.WITH_SCHEMA_VALUE="__WITH_SCHEMA_VALUE__";o(or,"withSchema");o(rs,"isWithSchemaValue");o(ar,"getSchemaValue");});var M=c(()=>{it();ie();nt();se();ne();it();oe();ae();I();le();rt();ot();Ne();F();Ct();Vt();ue();at();te();Lt();ut();Be();ce();Ke();pe();He();Dt();qe();Ye();Xe();ze();ke();Qe();ft();Je();Ze();tr();er();rr();sr();ir();he();});exports.ComputedObjects=void 0;var de=c(()=>{D();et();se();rt();y();M();exports.ComputedObjects=class extends Map{static{o(this,"ComputedObjects");}store;constructor(t){super(),this.store=t;}get enable(){return this.store.options.enableComputed}set enable(t){this.store.options.enableComputed=t;}create(){let t=C(arguments[0])?arguments[0]:G(...arguments)();if(t.options.async&&!re(t.options.depends))throw new exports.InvalidDependsError("The scope of the dynamic computed object must be the root state object or an absolute path");let r=t.options.scope;if(r===void 0||r==="ROOT")t.options.scope="ROOT";else if(!re([r]))throw new exports.InvalidScopeError("The scope of the dynamic computed object must be the root state object or an absolute path");return this.store._createComputed(t)}async runGroup(t,r,s){return await this.run(i=>i.group===t,r,s)}async run(){if(arguments.length===0)return Promise.all([...this.values()].map(n=>n.run()));let t;typeof arguments[0]=="function"?t=arguments[0]:typeof arguments[0]=="string"&&(t=o(n=>n.id===arguments[0],"filter"));let r=Object.assign({},arguments[1]),s=Object.assign({wait:false,timeout:0},arguments[2]),i={};return new Promise((n,a)=>{if(s.wait){let l;r.onDone=({id:f})=>{if(i[f]=true,Object.values(i).every(u=>u))return clearTimeout(l),true},s.timeout>0&&(l=setTimeout(()=>{a(new exports.TimeoutError);},s.timeout));}Promise.all([...this.values()].filter(l=>t(l)?(i[l.id]=false,true):false).map(l=>l.run(r))),s.wait||n();})}async enableGroup(t){for(let r of this.values())r.options.enable=t;}delete(t){return this.get(t)?.detach(),super.delete(t)}find(t){if(!t)return;let r=Array.isArray(t)?t:t.split(".");for(let s of this.values())if(V(s.path,r))return s}};});function lr(e,t="info"){let r=typeof e=="function"?e():e instanceof Error?e.stack:e;try{console[t](`[AutoStore<${this.id}>]`,...Array.isArray(r)?r:[r]);}catch{}}var ur=c(()=>{o(lr,"log");});function X(e,t,r="."){let s=[];try{return typeof t=="function"&&(t=t.call(e,e)),s=Array.isArray(t)?t:typeof t=="string"?t.split(r):[],s.length>0?x(e,s):e}catch{return e}}var fr=c(()=>{y();F();o(X,"getValueByPath");});exports.ObserverScopeRef=void 0;var me=c(()=>{exports.ObserverScopeRef=(function(e){return e.Root="ROOT",e.Current="CURRENT",e.Parent="PARENT",e.Depends="DEPENDS",e.Self="SELF",e})({});});function ss(e,t,r){let s=t===void 0?r:t;if(typeof s=="function")try{s=s.call(e.store,e);}catch{}return s===void 0?r===void 0?exports.ObserverScopeRef.Current:r:s}function k(e,t,r,s){let i=e.store.state,n=e.store.options;if(typeof n.getRootScope=="function"){let p=n.getRootScope(e,{observerType:t,valuePath:r?.path});p!==void 0&&(i=p);}let{path:a,parentPath:l}=r||{},f=ss(e,s.scope,n.scope),u=i;try{f===exports.ObserverScopeRef.Current?u=X(i,l):f===exports.ObserverScopeRef.Parent?u=X(i,a.slice(0,a.length-2<0?0:a.length-2)):f===exports.ObserverScopeRef.Root?u=i:f===exports.ObserverScopeRef.Depends?u=e.depends?.map(p=>X(i,p)):typeof f=="string"?f.startsWith("@")?u=k(e,t,r,{...s,scope:k(e,t,{...r,path:f.slice(1).split(n.delimiter)},{...s,scope:f.slice(1)})}):u=X(i,lt(e.path,f)):Array.isArray(f)&&(u=X(i,f));}catch(p){n.log(`Error while getting computed scope ${e.toString()}: ${p.message}`,"error");}return u}var ge=c(()=>{fr();fe();me();o(ss,"getScopeOptions");o(k,"getValueScope");});exports.ObserverObject=void 0;var $t=c(()=>{F();at();ue();Lt();ut();exports.ObserverObject=class{static{o(this,"ObserverObject");}descriptor;context;_path;_id="";_initial;_value;_associated=false;_attached=false;_getter;_depends=[];_options;_subscribers=[];_strPath;_error;store;_shadowStore;constructor(t,r,s){this.descriptor=r,this.context=s,this.store=t,this._associated=s!==void 0,this._getter=r.getter,this._options=Object.assign({enable:true,group:"",depends:[],throwError:true},r.options),this._id=this._options.id||(this._associated?q(s?.path):Rt()),this._path=s?.path||[`#${this._id}`],this._path||(this._path=[`#${this._id}`]),this._initial=this._options.initial,this.onInitOptions(this._options),this._depends=Y(this._path,this._options.depends),this._onObserverCreated(),this._onInitial();}get type(){return this.descriptor.type}get options(){return this._options}get id(){return this._id}get associated(){return this._associated}get async(){return this._options.async}get enable(){return this._options.enable}set enable(t){this._options.enable=t;}set group(t){this._options.group=t;}get group(){return this._options.group}get initial(){return this._initial}set initial(t){this._initial=t;}get path(){return this._path}get attached(){return this._attached}get depends(){return this._depends}set depends(t){this._depends=t;}get getter(){return this._getter}set getter(t){this._getter=t;}get strPath(){return this._strPath||(this._strPath=this._path.join(this.store.options.delimiter)),this._strPath}get error(){return this._error}set error(t){this._error=t;}toString(){return `ObserverObject<${this.strPath}>`}get value(){return this._associated?x(this.store.state,this._path):(this.store._notify({type:"get",path:this.path,value:this._value}),this._value)}set value(t){if(this._associated)L(this.store.state,this._path,t);else {let r=this._value;t!==r&&(this._value=t,this.store._notify({type:"set",path:this.path,value:t,oldValue:r}));}}_onObserverCreated(){typeof this.store.options.onObserverCreated=="function"&&this.store.options.onObserverCreated.call(this.store,this);}_onInitial(){this._options.initial!==void 0&&this.update(this._options.initial,{silent:true}),this.onInitial();}onInitial(){}onInitOptions(t){}update(t,r){this.store.update(()=>{this.value=t;},r);}silentUpdate(t){this.update(t,{silent:true});}watch(t,r){let s=this.store.watch(this.getValueWatchPath(),i=>{t.call(this,i);},r);return this._subscribers.push(s),s}getValueWatchPath(){return this.path.join(this.store.options.delimiter)}emitStoreEvent(t,r){setTimeout(()=>{this.store.emit(t,r);},0);}getDepends(){return this.depends}onDependsChange(t){}attach(){!this._attached&&this.depends&&this.depends.length>0&&(this._subscribers.push(this.store.watch(this.getDepends(),this.onDependsChange.bind(this),{operates:"write"})),this.store.log(()=>`${this.toString()} subscribed to ${this.depends.map(t=>t.join(this.store.options.delimiter)).join(",")}`),this._attached=true);}detach(){this._attached&&(this._subscribers.forEach(t=>{t.off();}),this._attached=false,this._subscribers=[],this.store.watchObjects.delete(this.id));}run(...t){}};});exports.ComputedObject=void 0;var Wt=c(()=>{ut();at();$t();exports.ComputedObject=class extends exports.ObserverObject{static{o(this,"ComputedObject");}descriptor;context;constructor(t,r,s){super(t,r,s),this.descriptor=r,this.context=s,r.options.depends=Y(this.path,this.options.depends);}toString(){return `ComputedObject<${q(this.path)}>`}get val(){return this.async?this.value.value:this.value}isDisable(t){return !this.store.options.enableComputed||!this.enable&&t!==true||t===false}run(t){throw new Error("Method not implemented.")}};});exports.SyncComputedObject=void 0;var _e=c(()=>{ge();Wt();Dt();ut();ft();exports.SyncComputedObject=class extends exports.ComputedObject{static{o(this,"SyncComputedObject");}get async(){return  false}onInitial(){this.collectDependencies();}run(t){let{first:r,operate:s}=Object.assign({first:false,operate:void 0},t);if(this.error=void 0,!r&&this.isDisable(t?.enable)){this.store.log(`Sync computed <${this.toString()}> is disabled`,"warn");return}!r&&this.store.log(()=>`Run sync computed for : ${this.toString()}`);let i=t?Object.assign({},this.options,t):this.options,n=k(this,"computed",this.context,i),a=i.initial;try{a=this.getter.call(this,n,{operate:s,first:r});}catch(l){this.error=l;}this.onDone(r,a,i);}onDone(t,r,s){let i=r;if(this.error&&v(s.onError)){let n=s.onError(this.error);n!==void 0&&(i=n);}t&&(this.initial=i),this.store.peep(()=>{this.value=i;}),this.error?!t&&this.emitStoreEvent("computed:error",{id:this.id,path:this.path,error:this.error,computedObject:this}):!t&&this.emitStoreEvent("computed:done",{id:this.id,path:this.path,value:i,computedObject:this});}collectDependencies(){let t=[],r=this.store.watch(s=>{t.push(s.path);},{operates:["get"]});this.run({first:true}),r.off(),Array.isArray(this.options.depends)&&this.options.depends.length>0&&t.push(...Y(this.path,this.options.depends)),this.depends=Pt(t),this.attach();}onDependsChange(t){this.run({operate:t});}};});function cr(e,t,r,s,i){return r==="push"?(...n)=>{let a=t.length,l=s.apply(t,n);if(t.length>a){let f=Array.from({length:t.length-a},(u,p)=>p+a);e({type:"insert",path:i,indexs:f,value:n,oldValue:void 0,parentPath:i,parent:t});}return l}:r==="pop"?()=>{let n=t.length,a=s.apply(t);return t.length===n-1&&e({type:"remove",path:i,indexs:[n-1],value:[a],oldValue:void 0,parentPath:i,parent:t}),a}:r==="splice"?(n,a,...l)=>{let f=s.apply(t,[n,a,...l]);if(f.length>0){let u=Array.from({length:f.length},(p,h)=>n+h);e({type:"remove",path:i,indexs:u,value:f,oldValue:void 0,parentPath:i,parent:t});}if(l.length>0){let u=Array.from({length:l.length},(p,h)=>n+h);e({type:"insert",path:i,indexs:u,value:l,oldValue:void 0,parentPath:i,parent:t});}return f}:r==="unshift"?(...n)=>{let a=t.length,l=s.apply(t,n);if(t.length>a){let f=Array.from({length:t.length-a},(u,p)=>p);e({type:"insert",path:i,indexs:f,value:n,oldValue:void 0,parentPath:i,parent:t});}return l}:r==="shift"?()=>{let n=t.length,a=s.apply(t);return t.length===n-1&&e({type:"remove",path:i,indexs:[0],value:[a],oldValue:void 0,parentPath:i,parent:t}),a}:r==="fill"?(n,a,l)=>{let f=s.apply(t,[n,a,l]),u=a??0,p=l??t.length,h=Array.from({length:p-u},(g,E)=>E+u),d=Array.from({length:p-u},()=>n);return e({type:"update",path:i,indexs:h,value:d,oldValue:void 0,parentPath:i,parent:t}),f}:r==="concat"?(...n)=>{let a=t.length,l=s.apply(t,n),f=Array.from({length:n.length},(u,p)=>a+p);return e({type:"insert",path:i,indexs:f,value:n,oldValue:void 0,parentPath:i,parent:t}),l}:s}var pr=c(()=>{o(cr,"hookArrayMethods");});function hr(e){return typeof e=="number"||typeof e=="string"&&!Number.isNaN(parseInt(e))}var dr=c(()=>{o(hr,"isNumber");});function is(e){if(this.options.validators){let t=e.join(this.options.delimiter||".");if(this.options.validators[t])return this.options.validators[t];let r=Object.keys(this.options.validators);for(let s of r)if(We(e,s))return this.options.validators[s]}return this.options.onValidate}function ns(e,t,r,s,i){let n=i?.validate||this._updateValidateBehavior;if(n==="none")return  true;let a=is.call(this,t);if(typeof a!="function")return  true;let l=true,f,u=t.join(this.options.delimiter||"."),p=this.options.configKey?`${this.options.configKey}.${u}`:u;try{if(a.call(this,r,s,t)===!1)throw new exports.ValidateError;this.configManager&&delete this.configManager.errors[p],this.errors&&delete this.errors[p];}catch(h){f=h;let d=this.configManager?.errors||this.errors;d[p]=a.getErrorMessage?.(h)||h.message||h.stack;let g=n||h.behavior||a.onInvalid||this.options.onInvalid||"throw";if(g==="pass")l=true;else if(g==="ignore")l=false;else if(g==="throw-pass")l=h;else throw l=false,h}finally{this.emit("validate",{path:t,newValue:r,oldValue:s,error:f});}return l}function mr(e,t,r,s,i){if(st(e)||typeof e!="object"||e===null)return e;if(r.has(e))return r.get(e);let n=new Proxy(e,{get:o((a,l,f)=>{let u=Reflect.get(a,l,f);if(typeof l!="string")return u;let p=[...t,String(l)];if(typeof u=="function"||!Object.hasOwn(a,l))if(typeof u=="function"){if(Array.isArray(a)&&!hr(l))return cr(i.notify,a,l,u,t);if(!st(u)&&Object.hasOwn(a,l)){if(typeof this.options.onObserverInitial=="function")try{if(this.options.onObserverInitial.call(this,p,u,a)===!1)return R(u),u}catch(d){this.log(`onObserverBeforeCreate error: ${d.message}`,"error");}let h=p.join(".");try{if(s.has(h)){let g=[...s.keys(),h];throw s.clear(),new exports.CyleDependError(`Find circular dependency at <"${p}">, steps: ${g.join(" -> ")}`)}s.set(h,!0);let d=i.createObserverObject(p,u,t,a);return typeof d!="function"&&Reflect.set(a,l,d,f),d}finally{s.delete(h);}}else return u}else return u;return i.notify({type:"get",path:p,indexs:[],value:u,oldValue:void 0,parentPath:t,parent:a}),mr.call(this,u,p,r,s,i)},"get"),set:o((a,l,f,u)=>{let p=Reflect.get(a,l,u),h=[...t,String(l)],[d,g]=ar(f),E=ns.call(this,n,h,d,p,g);if(E){let O=Reflect.set(a,l,d,u);if(l===ye)return  true;let S=h.join(this.options.delimiter||"."),dt=this.options.configKey?`${this.options.configKey}.${S}`:S;if(O&&this.configManager&&this.configurabled.has(S)&&setTimeout(()=>{this.configManager?.onUpdate(this,dt,d);},0),O&&!g?.slient&&l!==ye&&d!==p&&i.notify({type:Array.isArray(a)?"update":"set",path:h,indexs:[],value:d,oldValue:p,parentPath:t,parent:a}),E instanceof Error)throw E;return O}else return  true},"set"),deleteProperty:o((a,l)=>{let f=a[l],u=[...t,String(l)],p=Reflect.deleteProperty(a,l);return p&&l!==ye&&i.notify({type:"delete",path:u,indexs:[],value:f,oldValue:void 0,parentPath:t,parent:a}),p},"deleteProperty")});return r.set(e,n),n}function gr(e,t){let r=new Map,s=new WeakMap;return mr.call(this,e,[],s,r,t)}var ye,_r=c(()=>{it();pr();D();dr();Vt();oe();he();ye=Symbol("__NOTIFY__");o(is,"getValidate");o(ns,"isValidPass");o(mr,"createProxy");o(gr,"createReactiveObject");});async function be(e){return new Promise((t,r)=>setTimeout(t,e))}var yr=c(()=>{o(be,"t");});var br=c(()=>{yr();Qt();});function xr(e){return e instanceof Error?e:new Error(e)}var Er=c(()=>{o(xr,"getError");});exports.AsyncComputedObject=void 0;var xe=c(()=>{M();br();ge();Wt();pe();Er();ce();y();D();exports.AsyncComputedObject=class extends exports.ComputedObject{static{o(this,"AsyncComputedObject");}_isRunning=false;_defaultAbortController=null;_userAbortController;_firstRun=false;get async(){return  true}get value(){return super.value}set value(t){super.value=t;}get running(){return this._isRunning}onInitOptions(t){t.reentry===void 0&&(t.reentry=this.store.options.reentry);}onInitial(){this.initial=this.createAsyncComputedValue(),this.attach(),setTimeout(()=>{(this.options.immediate===true||this.options.immediate==="auto"&&this.options.initial===void 0)&&this.run({first:true});},0);}createAsyncComputedValue(){return Object.assign({[exports.ASYNC_COMPUTED_VALUE]:true,loading:false,timeout:0,retry:0,error:null,value:this.options.initial,progress:0,run:R(t=>this.store.computedObjects.run(this.id,Object.assign({},t))),cancel:R(()=>{this.getAbortController().abort();})})}updateComputedValue(t){let r=this.strPath,s=Object.keys(t).length;if(this.associated)this.store.update(i=>{Ge(i,this.path,t);},{batch:s>1?r:false});else {Object.assign(this.value,t);let i=s>1,n=[];Object.entries(t).forEach(([a,l])=>{let f={type:"set",path:[...this.path,a],value:l,parent:this.value};i&&(f.reply=true),this.store.operates.emit(`${this.strPath}.${a}`,f),n.push(f);}),i&&this.store.operates.emit(this.strPath,{type:"batch",path:this.path,value:n});}}async run(t){let{first:r}=t??{};if(this.isDisable(t?.enable)){this.store.log(()=>`Async computed <${this.toString()}> is disabled`,"warn");return}this.error=void 0,this._firstRun=true,!r&&this.store.log(()=>`Run async computed for : ${this.toString()}`);let s=t?Object.assign({first:r},this.options,t):this.options,i=k(this,"computed",this.context,s),{reentry:n}=s;if(this._isRunning&&!n){this.store.log(()=>`Async computed: ${this.toString()} is running, can't reentry`,"warn"),this.emitStoreEvent("computed:cancel",{path:this.path,id:this.id,reason:"reentry",computedObject:this});return}this._isRunning=true;try{return await this.executeGetter(i,s)}finally{this._isRunning=false;}}createComputeProgressbar(t){let{max:r=100,min:s=0,value:i=0}=Object.assign({},t);return this.updateComputedValue({progress:i}),{value:o(n=>{n>r&&(n=r),n<s&&(n=s),this.updateComputedValue({progress:n});},"value"),end(){this.value(r);}}}getAbortController(t){if(t&&typeof t.abortController=="function"){let r=t.abortController();r&&r instanceof AbortController&&(this._userAbortController=r);}return this._userAbortController?this._userAbortController:(this._defaultAbortController||(this._defaultAbortController=new AbortController),this._defaultAbortController.signal.aborted&&(this._defaultAbortController=new AbortController),this._defaultAbortController)}setTimeoutControl(t,r,s){let{timeout:i}=s,[n=0,a=0]=Array.isArray(i)?i:[i,0],l,f;return n>0&&(r.timeout=a>1?a:n,f=setTimeout(()=>{t.hasTimeout=true,t.hasError=true,t.error="TIMEOUT",typeof t.timeoutCallback=="function"&&t.timeoutCallback(),clearInterval(l),this.updateComputedValue({loading:false,error:"TIMEOUT",timeout:0});},n),a>1&&(l=setInterval(()=>{this.updateComputedValue({timeout:a--}),a===0&&clearInterval(l);},n/(a+1)))),{clear:o(()=>{clearTimeout(f),clearInterval(l);},"clear"),enable:n>0}}async executeGetter(t,r){let{retry:s=[0,0]}=r,[i,n]=Array.isArray(s)?s:[Number(s),0],a,l=this.getAbortController(r),f={onTimeout:o(g=>{a=g;},"onTimeout"),getProgressbar:this.createComputeProgressbar.bind(this),getSnap:o(g=>g,"getSnap"),cancel:l.abort,extras:r.extras,operate:r.operate,first:r.first,abortSignal:l.signal},u={error:null,hasError:false,hasTimeout:false,hasAbort:false,timeoutCallback:a},p=o(()=>{u.hasAbort=true;},"abortHandler");l.signal.addEventListener("abort",p);let h={clear:o(()=>{},"clear"),enable:false},d;try{let g=o(E=>Object.assign(u,E),"updateCtx");for(let E=0;E<i+1;E++){let O={};try{let S={loading:!0};if(u.hasError&&(S.error=null),i>0&&(S.retry=E>0?i-E+1:0),E>0&&g({error:null,hasError:!1,hasTimeout:!1}),h=this.setTimeoutControl(u,S,r),this.updateComputedValue(S),u.hasAbort)throw new exports.AbortError;if(d=await this.getter.call(this,t,f),u.hasAbort)throw new exports.AbortError;u.hasTimeout||(O.value=d,h.enable&&(O.timeout=0));}catch(S){if(u.hasError=!0,u.error=S,u.hasTimeout||(O.error=xr(S).message),v(r.onError)){let dt=r.onError(S);dt!==void 0&&(O.value=dt);}}finally{h.clear(),E===i&&(u.hasTimeout&&(O.error=u.error),i>0&&(O.retry=0)),O.loading=!1,this.updateComputedValue(O);}u.hasError&&i>0&&n>0&&E<i&&await be(n);}u.hasAbort?this.emitStoreEvent("computed:cancel",{path:this.path,id:this.id,reason:"abort",computedObject:this}):u.hasError||u.hasTimeout?(this.error=u.error,this.emitStoreEvent("computed:error",{path:this.path,id:this.id,error:u.error,computedObject:this})):this.emitStoreEvent("computed:done",{path:this.path,id:this.id,value:d,computedObject:this}),this.onDoneCallback(r,u.error,u.hasAbort,u.hasTimeout,t,d);}finally{l.signal.removeEventListener("abort",p);}}onDoneCallback(t,r,s,i,n,a){typeof t.onDone=="function"&&t.onDone.call(this,{id:this.id,path:this.path,value:a,error:r,abort:s,timeout:i,scope:n});}onDependsChange(t){this.store.log(()=>`AsyncComputed<${this.id}> is running by depends ${t.type}/${t.path.join(".")} operate `),this.run({operate:t,first:!this._firstRun});}getValueWatchPath(){let t=this.path.join(this.store.options.delimiter);return [`${t}.*`,t]}getDepends(){return super.getDepends().map(r=>{if(r.length===0)return r;for(let s of this.store.computedObjects.values())if(V(s.path,r)&&s.async)return [`${r}.value`];return r})}};});function Bt(){let e=arguments[0],t=typeof arguments[1]=="function"?arguments[1]:()=>true,r=typeof arguments[1]=="object"?arguments[1]:arguments[2],s=Object.assign({depends:[],enable:true,objectify:true,filter:t},r),i=o(()=>({type:"watch",getter:e,options:s}),"descriptorBuilder");return i[exports.OBSERVER_DESCRIPTOR_BUILDER_FLAG]=true,i}var Gt=c(()=>{y();o(Bt,"watch");});exports.WatchObjects=void 0;var Ee=c(()=>{M();Gt();exports.WatchObjects=class extends Map{static{o(this,"WatchObjects");}store;_watcher={off:o(()=>{},"off")};_enable=true;constructor(t){super(),this.store=t;}get enable(){return this._enable}set enable(t){this._enable=t;}set(t,r){return super.size===0&&this.createWacher(),super.set(t,r)}createWacher(){this._watcher=this.store.watch("**",({path:t,value:r})=>{if(!this._enable)return;let s=t[0].startsWith("#")?r:x(this.store.state,t);for(let i of this.values())i.isMatched(t,s)&&i.run(t,s);});}reset(){this._watcher&&this._watcher.off();for(let t of this.values())t.reset();this.createWacher();}create(){let t=C(arguments[0])?arguments[0]:Bt(...arguments)();return this.store._createWatch(t)}enableGroup(t,r=true){for(let s of this.values())s.options.group===t&&(s.options.enable=r);}};});exports.WatchObject=void 0;var ve=c(()=>{ie();$t();exports.WatchObject=class extends exports.ObserverObject{static{o(this,"WatchObject");}store;context;_cache;constructor(t,r,s){if(super(t,r,s),this.store=t,this.context=s,typeof this.options.filter!="function")throw new Error("watch options.filter must be a function")}get filter(){return this.options.filter}get cache(){return this._cache||(this._cache={}),this._cache}toString(){return `WatchObject<${this.id}>`}onInitial(){}isMatched(t,r){return wt(t,this.path)?false:this.filter(t,r)}reset(){this._cache={},this.value=this.initial;}run(t,r){if(!this.enable){this.store.log(`WatchObject <${this.toString()}> is disabled`);return}try{let s=this.getter?.call(this,{path:t,value:r},this);this.value=s,this.emitStoreEvent("watch:done",{value:s,watchObject:this});}catch(s){this.emitStoreEvent("watch:error",{error:s,watchObject:this});}}};});function vr(e){let t;return H(e)?t=e():typeof e=="function"&&(t={type:"computed",getter:e,options:Object.assign({},St(),{async:Ot(e)})}),t}var Ar=c(()=>{ee();Jt();ot();o(vr,"getObserverDescriptor");});function Ae(e,t){if(t==="*")return  true;if(t==="write"){if(e.type==="get")return}else if(t==="read"){if(e.type!=="get")return}else if(Array.isArray(t)&&t.length>0&&!t.includes(e.type))return;return  true}var Or=c(()=>{o(Ae,"isMatchOperates");});function Se(e,t,r,s){let i,n={},a={};return typeof e[0]=="object"?(Object.assign(a,e[0]),n=typeof e[1]=="boolean"?{retain:e[1]}:e[1]||{},i=e[0].meta):(a.type=e[0],a.payload=e[1],n=typeof e[2]=="boolean"?{retain:e[2]}:e[2]||{}),i=Object.assign({},t,r,n.meta,i),Object.keys(i).length===0&&(i=void 0),a.meta=i,n.executor===void 0&&(n.executor=s),[a,n]}function Lr(e){return e?typeof e=="object"&&"__FastEventScope__"in e:false}function we(e,t,r){let s=e[0],i=Lr(e[1])?e[1]:void 0,n=(i?e[2]:e[1])||{};return n.meta=Object.assign({},t,n?.meta),n.context=n.context!==void 0?n.context:r,[s,i,n]}function qt(e,t){return Object.defineProperty(e,"name",{value:t||"anonymous",configurable:true}),e}function b(e){return e&&typeof e=="function"}function Oe(e,t){if(e.length!==t.length&&e.length>0&&t[t.length-1]!=="**")return  false;let r=[...t];t.length>0&&t[t.length-1]==="**"&&r.splice(t.length-1,1,...Array.from({length:e.length-t.length+1}).fill("*"));for(let s=0;s<e.length;s++)if(r[s]!=="*"&&r[s]!==e[s])return  false;return  true}function Dr(e,t){let r=[];for(;;){let s=e.findIndex(i=>t(i));if(s===-1){r.push(s);break}e.splice(s,1);}return r}function ps(e){return e[Ir]=true,e}function Fr(e){return e&&e[Ir]}function $r(e){for(let t=0;t<e.length;t++){let r=e[t];Array.isArray(r)&&Fr(r)&&(e.splice(t,1,...r),t+=r.length-1);}return e}function Wr(e){return e&&typeof e=="object"&&"off"in e&&"listener"in e}function Ur(e,t){return e.catch(r=>(t&&t(r),Promise.resolve(r)))}function hs(e){return e?typeof e=="object"&&"type"in e:false}function ds(e){return e&&typeof e=="string"}function ms(e){return typeof e=="function"&&(e.toString().startsWith("class ")||e.prototype?.constructor===e)}function gs(e){return e?typeof e=="object"&&"__FastEvent__"in e:false}var wr,os,m,A,jr,ht,as,Tr,ls,Cr,Sr,Vr,us,fs,Rr,pt,Mr,cs,Ir,Nr,je,Br=c(()=>{wr=Object.defineProperty,os=o((e,t,r)=>t in e?wr(e,t,{enumerable:true,configurable:true,writable:true,value:r}):e[t]=r,"z"),m=o((e,t)=>wr(e,"name",{value:t,configurable:true}),"f"),A=o((e,t,r)=>os(e,typeof t!="symbol"?t+"":t,r),"h"),jr=class extends Error{static{o(this,"S");}constructor(t){super(t);}};m(jr,"FastEventError");ht=jr,as=class extends ht{static{o(this,"A");}};m(as,"TimeoutError");Tr=class extends ht{static{o(this,"M");}};m(Tr,"UnboundError");ls=Tr,Cr=class extends ht{static{o(this,"w");}};m(Cr,"AbortError");Sr=Cr,Vr=class extends ht{static{o(this,"F");}};m(Vr,"CancelError");us=Vr,fs=class extends ht{static{o(this,"j");}};m(fs,"QueueOverflowError");Rr={clearRetain:Symbol.for("ClearRetain")},pt=(function(e){return e[e.Transformed=1]="Transformed",e})({});o(Se,"L");m(Se,"parseEmitArgs");o(Lr,"D");m(Lr,"isFastEventScope");o(we,"E");m(we,"parseScopeArgs");o(qt,"g");m(qt,"renameFn");o(b,"u");m(b,"isFunction");Mr=class Pr{static{o(this,"T");}constructor(t){A(this,"__FastEventScope__",true),A(this,"_options",{}),A(this,"types",{events:void 0,meta:void 0,context:void 0,message:void 0,listeners:void 0,anyListener:void 0}),A(this,"prefix",""),A(this,"emitter"),this._options=Object.assign({},this._initOptions(t));}get context(){return this.options.context||this}get options(){return this._options}get listeners(){return this.emitter.getListeners(this.prefix)}bind(t,r,s){this.emitter=t,this._options=Object.assign(this._options,{scope:r},s),r.length>0&&!r.endsWith(t.options.delimiter)&&(this.prefix=r+t.options.delimiter);}_initOptions(t){return t}_getScopeListener(t){let r=this.prefix;if(r.length===0)return t;t||(t=(this._options.onMessage||this.onMessage).bind(this));let s=this;return qt(function(i,n){let a=n.rawEventType||i.type;if(a.startsWith(r)){let l=((n.flags||0)&pt.Transformed)>0?i:Object.assign({},i,{type:a.substring(r.length)});return t.call(s.context,l,n)}},t.name)}_getScopeType(t){return t===void 0?void 0:this.prefix+t}_fixScopeType(t){return t.startsWith(this.prefix)?t.substring(this.prefix.length):t}on(){if(!this.emitter)throw new ls;let t=[...arguments];return t[0]=this._getScopeType(t[0]),t[1]=this._getScopeListener(t[1]),this.emitter.on(...t)}once(){return this.on(arguments[0],arguments[1],Object.assign({},arguments[2],{count:1}))}onAny(){return this.on("**",...arguments)}off(){let t=arguments;typeof t[0]=="string"&&(t[0]=this._getScopeType(t[0])),this.emitter.off(...t);}offAll(){this.emitter.offAll(this.prefix.substring(0,this.prefix.length-1));}clear(){this.emitter.clear(this.prefix.substring(0,this.prefix.length-1));}emit(){if(arguments.length===2&&typeof arguments[0]=="string"&&arguments[1]===Rr.clearRetain)return this.emitter.emit(this._getScopeType(arguments[0]));let[t,r]=Se(arguments,this.emitter.options.meta,this.options.meta,this.options.executor);return this._transformMessage(t,r),t.type=this._getScopeType(t.type),this.emitter.emit(t,r)}_transformMessage(t,r){b(this._options.transform)&&(r.rawEventType=this._getScopeType(t.type),r.flags=(r.flags||0)|pt.Transformed,t.payload=this._options.transform.call(this,t));}async emitAsync(){return (await Promise.allSettled(this.emit.apply(this,arguments))).map(t=>t.status==="fulfilled"?t.value:t.reason)}async waitFor(){let t=arguments[0],r=arguments[1],s=await this.emitter.waitFor(this._getScopeType(t),r);return Object.assign({},s,{type:this._fixScopeType(s.type)})}scope(){let[t,r,s]=we(arguments,this.options.meta,this.options.context),i;return r?i=r:i=new Pr,i.bind(this.emitter,this.prefix+t,s),i}onMessage(t,r){}};m(Mr,"FastEventScope");cs=Mr;o(Oe,"O");m(Oe,"isPathMatched");o(Dr,"N");m(Dr,"removeItem");Ir=Symbol.for("__expandable__");o(ps,"Tt");m(ps,"expandable");o(Fr,"I");m(Fr,"isExpandable");o($r,"B");m($r,"expandEmitResults");o(Wr,"X");m(Wr,"isSubsctiber");o(Ur,"$");m(Ur,"tryReturnError");Nr=class{static{o(this,"P");}constructor(t){A(this,"__FastEvent__",true),A(this,"listeners",{__listeners:[]}),A(this,"_options"),A(this,"_delimiter","/"),A(this,"_context"),A(this,"retainedMessages",new Map),A(this,"listenerCount",0),A(this,"types",{events:void 0,meta:void 0,context:void 0,message:void 0,listeners:void 0,anyListener:void 0}),this._options=Object.assign({debug:false,id:Math.random().toString(36).substring(2),delimiter:"/",context:null,ignoreErrors:true,meta:void 0,expandEmitResults:true},this._initOptions(t)),this._delimiter=this._options.delimiter,this._context=this._options.context,this._enableDevTools();}get options(){return this._options}get context(){return this.options.context||this}get meta(){return this.options.meta}get id(){return this._options.id}_initOptions(t){return t}_addListener(t,r,s){let{count:i,prepend:n}=s,a=0;return [this._forEachNodes(t,l=>{let f=[r,i,0,s.tag,s.flags];n?(l.__listeners.splice(0,0,f),a=0):(l.__listeners.push(f),a=l.__listeners.length-1),this.listenerCount++;}),a]}_enableDevTools(){this.options.debug&&globalThis.__FLEXEVENT_DEVTOOLS__&&globalThis.__FLEXEVENT_DEVTOOLS__.add(this);}_forEachNodes(t,r){if(t.length===0)return;let s=this.listeners;for(let i=0;i<t.length;i++){let n=t[i];if(n in s||(s[n]={__listeners:[]}),i===t.length-1){let a=s[n];return r(a,s),a}else s=s[n];}}_removeListener(t,r,s){s&&Dr(t.__listeners,i=>{i=Array.isArray(i)?i[0]:i;let n=i===s;return n&&(this.listenerCount--,b(this._options.onRemoveListener)&&this._options.onRemoveListener(r.join(this._delimiter),s)),n});}_pipeListener(t,r){return r.forEach(s=>{t=qt(s(t),t.name);}),t}on(){let t=arguments[0],r=b(arguments[1])?arguments[1]:(this._options.onMessage||this.onMessage).bind(this),s=Object.assign({count:0,flags:0,prepend:false},b(arguments[1])?arguments[2]:arguments[1]);if(t.length===0)throw new Error("event type cannot be empty");if(b(this._options.onAddListener)){let f=this._options.onAddListener(t,r,s);if(f===false)throw new us;if(Wr(f))return f}let i=t.split(this._delimiter);if(s.pipes&&s.pipes.length>0&&(r=this._pipeListener(r,s.pipes)),b(s.filter)||b(s.off)){let f=r;r=qt(function(u,p){if(b(s.off)&&s.off.call(this,u,p)){l();return}if(b(s.filter)){if(s.filter.call(this,u,p))return f.call(this,u,p)}else return f.call(this,u,p)},r.name);}let[n,a]=this._addListener(i,r,s),l=m(()=>n&&this._removeListener(n,i,r),"off");return this._emitRetainMessage(t,n,a),{off:l,listener:r}}once(){return b(arguments[1])?this.on(arguments[0],arguments[1],Object.assign({},arguments[2],{count:1})):this.on(arguments[0],Object.assign({},arguments[2],{count:1}))}onAny(){return this.on("**",arguments[0],arguments[1])}onMessage(t,r){}off(){let t=arguments,r=b(t[0])?void 0:t[0],s=b(t[0])?t[0]:t[1],i=r?r.split(this._delimiter):[],n=r?r.includes("*"):false;if(r&&!n)this._traverseToPath(this.listeners,i,a=>{s?this._removeListener(a,i,s):r&&(a.__listeners=[]);});else {let a=n?[]:i;this._traverseListeners(this.listeners,a,(l,f)=>{(s!==void 0||n&&Oe(l,i))&&(s?this._removeListener(f,i,s):f.__listeners=[]);});}}offAll(t){if(t){let r=t.split(this._delimiter),s=0;this._traverseListeners(this.listeners,r,(i,n)=>{s+=n.__listeners.length,n.__listeners=[];}),this.listenerCount-=s,this._removeRetainedEvents(t);}else {let r=0;this._traverseListeners(this.listeners,[],(s,i)=>{r+=i.__listeners.length;}),this.listenerCount-=r,this.retainedMessages.clear(),this.listeners={__listeners:[]};}b(this._options.onClearListeners)&&this._options.onClearListeners.call(this);}_removeRetainedEvents(t){t||this.retainedMessages.clear(),t?.endsWith(this._delimiter)&&(t+=this._delimiter),this.retainedMessages.delete(t);for(let r of this.retainedMessages.keys())r.startsWith(t)&&this.retainedMessages.delete(r);}clear(t){this.offAll(t),this._removeRetainedEvents(t);}_emitRetainMessage(t,r,s){let i=[];if(t.includes("*")){let n=t.split(this._delimiter);this.retainedMessages.forEach((a,l)=>{let f=l.split(this._delimiter);Oe(f,n)&&i.push(a);});}else this.retainedMessages.has(t)&&i.push(this.retainedMessages.get(t));r&&i.forEach(n=>{this._executeListeners([r],n,{},a=>a[0]===r.__listeners[s][0]);});}_traverseToPath(t,r,s,i=0,n){if(i>=r.length){s(t);return}let a=r[i];if(n===true){this._traverseToPath(t,r,s,i+1,true);return}"*"in t&&this._traverseToPath(t["*"],r,s,i+1),"**"in t&&this._traverseToPath(t["**"],r,s,i+1,true),a in t&&this._traverseToPath(t[a],r,s,i+1);}_traverseListeners(t,r,s){let i=t;r&&r.length>0&&this._traverseToPath(t,r,a=>{i=a;});let n=m((a,l,f)=>{l(f,a);for(let[u,p]of Object.entries(a))u.startsWith("__")||p&&n(p,l,[...f,u]);},"traverseNodes");n(i,s,[]);}_onListenerError(t,r,s,i){if(i instanceof Error&&(i._emitter=`${t.name||"anonymous"}:${r.type}`),b(this._options.onListenerError))try{this._options.onListenerError.call(this,i,t,r,s);}catch{}if(this._options.ignoreErrors)return i;throw i}_setListenerFlags(t,r){return !t||t===0?r:t|r}_executeListener(t,r,s,i=false){try{if(s&&s.abortSignal&&s.abortSignal.aborted)return this._onListenerError(t,r,s,new Sr(t.name));let n=((s?.flags||0)&pt.Transformed)>0,a=t.call(this.context,n?r.payload:r,s);return i&&a&&a instanceof Promise&&(a=Ur(a,l=>this._onListenerError(t,r,s,l))),a}catch(n){return this._onListenerError(t,r,s,n)}}_getListenerExecutor(t){if(!t)return;let r=t.executor||this._options.executor;if(b(r))return r}_executeListeners(t,r,s,i){if(!t||t.length===0)return [];let n=t.reduce((l,f)=>l.concat(f.__listeners.filter(u=>b(i)?i(u,f):true).map((u,p)=>[u,p,f.__listeners])),[]);b(this._options.transform)&&(s||(s={}),s.rawEventType=r.type,r.payload=this._options.transform.call(this,r),s.flags=this._setListenerFlags(s.flags,pt.Transformed)),this._decListenerExecCount(n);let a=this._getListenerExecutor(s);if(a){let l=a(n.map(f=>f[0]),r,s,this._executeListener.bind(this));return Array.isArray(l)?l:[l]}else return n.map(l=>this._executeListener(l[0][0],r,s,true))}_decListenerExecCount(t){for(let r=t.length-1;r>=0;r--){let s=t[r][0];s[2]++,s[1]>0&&s[1]<=s[2]&&t[r][2].splice(r,1);}}getListeners(t){let r=[],s=t.split(this._delimiter);return this._traverseToPath(this.listeners,s,i=>{r.push(i);}),r[0].__listeners}emit(){if(arguments.length===2&&typeof arguments[0]=="string"&&arguments[1]===Rr.clearRetain)return this.retainedMessages.delete(arguments[0]),[];let[t,r]=Se(arguments,this.options.meta);b(r.parseArgs)&&r.parseArgs(t,r);let s=t.type.split(this._delimiter);r.retain&&this.retainedMessages.set(t.type,t);let i=[],n=[];if(this._traverseToPath(this.listeners,s,a=>{n.push(a);}),b(this._options.onBeforeExecuteListener)){let a=this._options.onBeforeExecuteListener.call(this,t,r);if(Array.isArray(a))return a;if(a===false)throw new Sr(t.type)}return b(this._options.transform)&&(t.payload=this._options.transform.call(this,t),r.rawEventType=t.type,r.flags=(r.flags||0)|pt.Transformed),i.push(...this._executeListeners(n,t,r)),b(this._options.onAfterExecuteListener)&&this._options.onAfterExecuteListener.call(this,t,i,n),this._options.expandEmitResults&&$r(i),i}async emitAsync(){return (await Promise.allSettled(this.emit.apply(this,arguments))).map(t=>t.status==="fulfilled"?t.value:t.reason)}waitFor(){let t=arguments[0],r=arguments[1];return new Promise((s,i)=>{let n,a,l=m(f=>{clearTimeout(n),a&&a.off(),s(f);},"listener");r&&r>0&&(n=setTimeout(()=>{a&&a.off(),i(new Error("wait for event<"+t+"> is timeout"));},r)),a=this.on(t,l);})}scope(){let[t,r,s]=we(arguments,this.options.meta,this.options.context),i;return r?i=r:i=new cs,i.bind(this,t,s),i}};m(Nr,"FastEvent");je=Nr;o(hs,"Kt");m(hs,"isFastEventMessage");o(ds,"kt");m(ds,"isString");o(ms,"te");m(ms,"isClass");o(gs,"ie");m(gs,"isFastEvent");});function Gr(e,t){let r=Object.keys(e),s=Object.values(e),i=t?.disabledGlobals||["alert","window","document"];if(i&&i.length>0){let n=new Set(r),a=i.filter(l=>!n.has(l));a.length>0&&(r.push(...a),s.push(...new Array(a.length).fill(void 0)));}return n=>{try{return new Function(...r,`return ${n}`)(...s)}catch(a){if(t?.onError){let l=t.onError(a,n);if(l!==void 0)return l}throw a}}}var Kr=c(()=>{o(Gr,"createSandbox");});function _s(e){jt(e)&&Mt(e,({value:t,key:r,parent:s})=>{v(t)&&(r.startsWith("on")||r.startsWith("render")||r.startsWith("to"))&&(s[r]=R(t));});}function ys(e){let t={value:e[0],schema:Object.assign({onInvalid:void 0},e[1])};return _s(t.schema),t}function Yt(e,t){let r=ys([e,t]),s=e;typeof s=="object"&&R(s),r.schema.datatype=Array.isArray(s)?"array":typeof s;let i=o(()=>({value:s,schema:r.schema}),"builder");return i[exports.VALUE_SCHEMA_BUILDER_FLAG]=true,i}function $(e,t){return o(function(s,i){let n=Object.assign({},i);return typeof n.onValidate!="function"&&(n.onValidate=e),n.invalidTips||(n.invalidTips=t),Yt(s,n)},"typeSchema")}exports.configurable=void 0;exports.schemas=void 0;exports.s=void 0;var Te=c(()=>{y();M();Vt();o(_s,"markRawSchema");o(ys,"parseSchemaArgs");o(Yt,"schema");exports.configurable=Yt;o($,"createTypeSchemaBuilder");exports.schemas={number:$(e=>typeof e=="number","must be a number"),string:$(e=>typeof e=="string","must be a string"),boolean:$(e=>typeof e=="boolean","must be a boolean"),date:$(e=>e instanceof Date,"must be a date"),bigint:$(e=>typeof e=="bigint","must be a bigint"),array:$(e=>Array.isArray(e),"must be an array"),object:$(e=>typeof e=="object","must be an object")},exports.s=exports.schemas;});function qr(e){return jt(e)&&"load"in e}var Yr=c(()=>{ae();o(qr,"isConfigSource");});var Ve={};Qr(Ve,{ConfigManager:()=>exports.ConfigManager});exports.ConfigManager=void 0;var Xt=c(()=>{y();Re();M();F();ft();exports.ConfigManager=class extends exports.AutoStore{static{o(this,"ConfigManager");}source;dirtyValues={};_reseting=false;constructor(t,r){let s=Object.assign({global:false},r);if(super({},s),this.source=t,s.global!==false){let i=s.global===true?exports.GLOBAL_CONFIG_MANAGER:s.global;globalThis[i]=this;}}get fields(){return this.state}get size(){return Object.keys(this.fields).length}async load(){let t=await this.source.load();this.update(r=>{Object.entries(t).forEach(([s,i])=>{let n=r[s];n?n.value=i:r[s]={value:i};});},{silent:true});}async save(t){let r=t?this._getValues():this.dirtyValues;Object.keys(r).length>0&&(await this.source.save?.(r),this.dirtyValues={});}_getValues(){return Object.entries(this.state).reduce((t,[r,s])=>(t[r]=s.value,t),{})}reset(){if(!this._reseting)try{this._reseting=!0,this.dirtyValues={},Object.values(this.state).forEach(t=>{try{let r=t.schema.default;r!==void 0&&(t.value=or(r,{slient:!0,validate:"none"}));}catch{}});}finally{this._reseting=false;}}onUpdate(t,r,s){this.dirtyValues[r]=s,this.source.save?.(this.dirtyValues),this.dirtyValues={};}add(t,r,s){this.operates.options.delimiter=t.options.delimiter;let i=ct(s)?s():s,n=Array.isArray(r)?r:r.split(t.options.delimiter),a=n.join(t.options.delimiter),l=[...n];t.options.configKey&&l.splice(0,0,t.options.configKey);let f=i.value;if(i.schema.default===void 0&&(i.schema.default=f),t.options.defaultSchema&&Object.keys(t.options.defaultSchema).forEach(u=>{let p=t.options.defaultSchema[u];i.schema[u]===void 0&&(i.schema[u]=p);}),i.schema.onInvalid===void 0&&(i.schema.onInvalid="throw"),v(i.schema.onValidate)){i.schema.onValidate.getErrorMessage=p=>{let h=i.schema.invalidTips;return typeof h=="string"?h.params(i.schema).params({error:p.message,stack:p.stack}):p.message};let u=i.schema.onInvalid;u!==void 0&&(i.schema.onValidate.onInvalid=u),t.options.validators||(t.options.validators={}),t.options.validators[a]=i.schema.onValidate;}else t.options.validators&&delete t.options.validators[a];return this._createValueProxy(i,t,n),this.update(u=>{L(u,[l.join(".")],i);},{silent:true}),f}_createValueProxy(t,r,s){let i=new WeakRef(r);return Object.defineProperty(t,"value",{get(){let n=i.deref();if(n)return x(n.state,s)},set(n){i.deref()?.update(l=>{L(l,s,n);});}})}getConfigValue(t){return this.peep(r=>x(r,[...t,"value"]))}};});exports.AutoStore=void 0;var Re=c(()=>{de();y();ur();Lt();_e();y();_r();xe();Ee();ve();Dt();le();Ar();Or();D();Br();Kr();et();Gt();Te();M();Yr();exports.AutoStore=class extends je{static{o(this,"AutoStore");}_data;_errors;computedObjects;watchObjects;_operates=new je({delimiter:".",transform:o(t=>t.payload,"transform")});_silenting=false;_batching=false;_batchOperates=[];_updateFlags=0;_peeping=false;_safeEval;_updateValidateBehavior;_configManager;_updatedState;_updatedWatcher;_configurabled;constructor(t,r){super(Object.assign({id:Rt(),debug:false,enableComputed:true,reentry:true,resetable:false,delimiter:".",lazy:false,enableValueExpr:true,log:lr},r,{delimiter:".",transform:o(s=>s.payload,"transform")})),this.operates.options.delimiter=this.options.delimiter,this._createSandbox(),this._createConfigManager(),this.computedObjects=new exports.ComputedObjects(this),this.watchObjects=new exports.WatchObjects(this),this.subscribeCallbacks(),this._data=gr.call(this,t||{},{notify:this._notify.bind(this),createObserverObject:this.createObserverObject.bind(this)}),this.getSnap=this.getSnap.bind(this),this.watch=this.watch.bind(this),this.update=this.update.bind(this),this.peep=this.peep.bind(this),this.silentUpdate=this.silentUpdate.bind(this),this.batchUpdate=this.batchUpdate.bind(this),this.trace=this.trace.bind(this),this.collectDependencies=this.collectDependencies.bind(this),this.installExtends(),this.options.lazy||Mt(this._data,this._onFirstEachState.bind(this)),this.options.resetable&&(this.resetable=true),this._options.debug&&typeof globalThis.__AUTOSTORE_DEVTOOLS__=="object"&&globalThis.__AUTOSTORE_DEVTOOLS__.add(this),this.emit("load",this);}get types(){return {...super.types,state:void 0,rawState:void 0,events:void 0,schemas:void 0}}get state(){return this._data}get operates(){return this._operates}get configurabled(){return this._configurabled||(this._configurabled=new Set),this._configurabled}get errors(){return this._errors||(this._errors={}),this._errors}get options(){return super.options}get silenting(){return this._silenting}get delimiter(){return this.options.delimiter}get batching(){return this._batching}get peeping(){return this._peeping}get resetable(){return this.options.resetable}get configManager(){return this._configManager}set resetable(t){if(t){if(this._updatedWatcher)return;this._updatedState={},this._updatedWatcher=this.watch(({path:r,oldValue:s})=>{if(r.length===0)return;let i=r.join(this.delimiter);!i.startsWith("#")&&!(i in this._updatedState)&&(this._updatedState[i]=s);},{operates:"write"});}else this._updatedWatcher&&(this._updatedWatcher.off(),this._updatedWatcher=void 0),this._updatedState={};this.options.resetable=t;}_createSandbox(){if(this.options.enableValueExpr){let t=v(this.options.sandbox?.create)?this.options.sandbox.create:Gr;this._safeEval=t({...this.options.sandbox?.context||{},computed:G,watch:Bt,configurable:exports.configurable,schema:Yt},{onError:o((r,s)=>(this.log(r),s),"onError")});}}reset(t){if(this.options.resetable&&this._updatedState)try{this.batchUpdate(r=>{let s=t?`${t}${this.delimiter}`:"";Object.entries(this._updatedState).forEach(([i,n])=>{i.startsWith(s)&&L(r,i.split(this.delimiter),n);});});}finally{this.emit("reset",t);}else this.log("resetable option is not enabled","warn");}_createConfigManager(){if(this.options.configManager&&typeof this.options.configManager=="object"&&"add"in this.options.configManager)this._configManager=this.options.configManager;else if(qr(this.options.configManager)){let{ConfigManager:t}=(Xt(),Le(Ve));this._configManager=new t(this.options.configManager);}else if(this.options.configManager===true){let{ConfigManager:t}=(Xt(),Le(Ve));this.options.configKey=void 0,this._configManager=new t({load:o(()=>({}),"load")});}else this._options.configManager===void 0&&globalThis[exports.GLOBAL_CONFIG_MANAGER]&&(this.options.configKey||(this.options.configKey=this.id),this._configManager=globalThis[exports.GLOBAL_CONFIG_MANAGER]);}_onFirstEachState({value:t,path:r}){if(typeof t=="string"){if(this.options.enableValueExpr===false||!v(this._safeEval))return;let s=t.trim();if(s.startsWith("```")&&s.endsWith("```")){if(s.length<=6)return;this.update(i=>{let n=s.slice(3,s.length-3).trim();if(!n)return;let a=this._safeEval?.(n);L(i,r,a);});}}}log(t,r){this.options.debug&&this.options.log?.call(this,t,r);}installExtends(){let t=globalThis.__AUTOSTORE_EXTENDS__;Array.isArray(t)&&t.forEach(r=>{typeof r=="function"&&r(this);});}subscribeCallbacks(){this.options.onComputedCreated&&this.on("computed:created",this.options.onComputedCreated.bind(this)),this.options.onComputedDone&&this.on("computed:done",this.options.onComputedDone.bind(this)),this.options.onComputedError&&this.on("computed:error",this.options.onComputedError.bind(this)),this.options.onComputedCancel&&this.on("computed:cancel",this.options.onComputedCancel.bind(this)),this.options.onObserverBeforeCreate&&this.on("observer:beforeCreate",this.options.onObserverBeforeCreate.bind(this)),this.options.onObserverCreated&&this.on("observer:created",this.options.onObserverCreated.bind(this));}_notify(t){this._peeping&&t.type==="get"||(this._batching&&this._batchOperates.push(t),!this._silenting&&(t.flags=this._updateFlags,this.operates.emit(t.path.join(this.delimiter),t)));}watch(){let t=typeof arguments[0]=="function"||["*","**"].includes(arguments[0])||Array.isArray(arguments[0])&&arguments[0].length===0,r=typeof arguments[0]=="function"?arguments[0]:arguments[1],s=arguments.length>=2&&typeof arguments[arguments.length-1]=="object"?arguments[arguments.length-1]:void 0,i=o((n,a)=>l=>{if(Ae(l,n)&&!(typeof a=="function"&&!a(l)))try{if(this._peeping=!0,l.type==="batch"){let f=l.value.filter(u=>Ae(u,n));if(f.length>0)l.value=f;else return}r(l);}finally{this._peeping=false;}},"createEventHandler");if(t){let{operates:n,filter:a}=Object.assign({once:false,operates:"write"},s),l=i(n,a);return this.operates.onAny(l)}else {let n=arguments[0],a=Array.isArray(n)?n.map(g=>typeof g=="string"?g:g.join(this.delimiter)):[n],{once:l,operates:f,filter:u}=Object.assign({once:false,operates:"write"},s),p=l?this.operates.once.bind(this.operates):this.operates.on.bind(this.operates),h=[],d=i(f,u);return a.forEach(g=>{h.push(p.call(this,g,d));}),{off:o(()=>h.forEach(g=>{g.off();}),"off")}}}createObserverObject(t,r,s,i){if(this._configManager&&ct(r)){let n=this._configManager.add(this,t,r);return this.configurabled.add(t.join(this.options.delimiter)),n}else {if(ct(r))return r().value;{let n=vr(r),a={path:t,value:r,parentPath:s,parent:i};if(n){if(n.type==="computed")return this._createComputed(n,a)?.initial;if(n.type==="watch")return this._createWatch(n,a)?.initial}else return r}}}_createComputed(t,r){let s;return this.emit("observer:beforeCreate",t),t.options.async?s=new exports.AsyncComputedObject(this,t,r):s=new exports.SyncComputedObject(this,t,r),s&&(s.silentUpdate(s.initial),s.options.objectify&&this.computedObjects.set(s.id,s),this.emit("computed:created",s),this.emit("observer:created",s)),s}_createWatch(t,r){this.emit("observer:beforeCreate",t);let s=new exports.WatchObject(this,t,r);return this.watchObjects.set(s.id,s),this.emit("watch:created",s),this.emit("observer:created",s),s}silentUpdate(t){this.update(t,{silent:true});}batchUpdate(t){this.update(t,{batch:true,validate:"pass"});}update(t,r){let{batch:s=false,reply:i=true,silent:n=false,peep:a=false,flags:l=0,validate:f}=r||{};if(typeof t=="function"){this._updateFlags=l,this._updateValidateBehavior=f,n&&(this._silenting=true),s&&(this._batching=true,this._silenting=true),a&&(this._peeping=true);try{let u=t(this.state);if(s&&Ue(u))throw new Error("Batch update method can't be async function")}finally{this._silenting=false,this._batching=false,this._peeping=false,this._updateFlags=0,this._updateValidateBehavior=void 0,this.replyBatchOperates(i,s);}}else throw new Error("update method must provide a function argument")}replyBatchOperates(t,r){if(this._batchOperates.length>0){let s=[...this._batchOperates];this._batchOperates=[],t&&s.forEach(i=>{i.reply=true,this._notify(i);});try{let i=r===!0?exports.BATCH_UPDATE_EVENT:String(r);this.operates.emit(i,{type:"batch",path:[i],value:s});}finally{this._batchOperates=[];}}}peep(){let t=typeof arguments[0]=="function"?()=>arguments[0](this.state):()=>x(this.state,Array.isArray(arguments[0])?arguments[0]:arguments[0].split(this.delimiter));this._peeping=true;try{return t()}finally{this._peeping=false;}}collectDependencies(t,r="*"){let s=[],i=this.watch(n=>{s.push(n.path);},{operates:r});try{t();}finally{i.off();}return Pt(s)}trace(t,r="*"){let s;return {stop:o(()=>s?.off(),"stop"),start:o(async i=>{let n=[];return new Promise(a=>{s=this.watch(l=>{n.push(l),i?.(l)&&(s.off(),a(n));},{operates:r}),Promise.resolve(t()).finally(()=>{typeof i!="function"&&(s.off(),a(n));});})},"start")}}destroy(){this.offAll(),this._operates.offAll(),this.watchObjects.clear(),this.computedObjects.clear(),this.emit("unload",this);}getSnap(t){let{reserveAsync:r,entry:s,includeFunc:i}=Object.assign({reserveAsync:true},t);return It(s?x(this._data,s):this._data,{reserveAsync:r,includeFunc:i})}get(t,r){let{defaultValue:s,timeout:i=0,expandAsync:n=false,waitAsyncDone:a=false}=Object.assign({},r),l=Array.isArray(t)?t:t.split(this.delimiter),f=x(this.state,l,s);return w(f)?f.loading&&a?new Promise((u,p)=>{let h,d;i>0&&(h=setTimeout(()=>{d?.off(),p(new exports.TimeoutError);},i)),d=this.on("computed:done",({path:g})=>{V(l,g)&&(clearTimeout(h),d?.off(),u(n?f.value:f));});}):n?f.value:f:f}toString(){return `AutoStore<${this.id}>`}};});function Me(e,...t){if(t.length===0)return e;let r=t.map((s,i)=>{let n=Object.entries(s||{});return n.some(([a,l])=>l===void 0)?n.reduce((a,[l,f])=>(f!==void 0&&(a[l]=f),a),{}):s});return Object.assign(e,...r)}o(Me,"u");function gt(e){return e!=null&&typeof e[Symbol.iterator]=="function"&&typeof e!="string"}o(gt,"t");function j(e){if(typeof e!="object"||e===null)return  false;var t=Object.getPrototypeOf(e);if(t===null)return  true;for(var r=t;Object.getPrototypeOf(r)!==null;)r=Object.getPrototypeOf(r);return t===r}o(j,"o");function Pe(e,t=false){if(typeof e=="number")return  true;if(typeof e!="string"||t)return  false;try{if(e.includes(".")){let r=parseFloat(e);return e.endsWith(".")?!isNaN(r)&&String(r).length===e.length-1:!isNaN(r)&&String(r).length===e.length}else {let r=parseInt(e);return !isNaN(r)&&String(r).length===e.length}}catch{return  false}}o(Pe,"r");function W(e){if(Pe(e)||typeof e=="boolean"||typeof e=="function"||e instanceof Error)return  false;if(e==null||e==null||Array.isArray(e)&&e.length==0||j(e)&&Object.keys(e).length==0||typeof e=="string"&&e.trim()=="")return  true;try{if(gt(e)&&e.size==0)return !0}catch{}return  false}o(W,"s");function De(e,{empty:t,delimiter:r=","}){let s=e;try{return typeof s=="function"&&(s=s.call(this,s)),W(s)&&(s=t||""),Array.isArray(s)?s.map(i=>String(i)).join(r):j(s)?Object.entries(s).reduce((i,[n,a])=>(i.push(`${n}=${String(a)}`),i),[]).join(r):gt(s)&&typeof s!="string"?[...s].map(i=>String(i)).join(r):s instanceof Error?s.message:String(s)}catch{return String(s)}}o(De,"h");var Zr=/\{(\<(.*?)\>)?\s*([^\{\}\>\<]*)(?<!\s)\s*(\<(.*?)\>)?\}/gm;function kt(e,t,r){let s,i=Me({empty:null,delimiter:",",forEach:null},r);typeof t=="function"&&(t=t.call(e)),Array.isArray(t)&&t.length==1&&(j(t[0])||Array.isArray(t[0]))&&(t=t[0]),["boolean","string","number"].includes(typeof t)?s=[t]:t instanceof Map?s=[...t.entries()].reduce((a,l)=>(a[l[0]]=l[1],a),{}):Symbol.iterator in t?s=[...t]:j(t)?s=t:t instanceof Error?s=[`Error:${t.message}`]:s=[t];let n=0;return e.replaceAll(Zr,function(){let a=arguments[2]||"",l=arguments[3]||"",f=arguments[5]||"",u="",p=false;if(Array.isArray(s)){let h=n>=s.length;u=h?"":De.call(e,s[n],i),p=W(u)||h,n++;}else if(j(s)){let h=l in s;u=h?De.call(e,s[l],i):"",p=W(u)||!h;}if(typeof i.forEach=="function"){let h=i.forEach(l,u,a,f);h!==void 0&&(Array.isArray(h)&&h.length==3?(a=h[0],u=h[1],f=h[2]):W(h)||(u=String(h)),p=W(u));}return p&&(i.empty==null?(u="",a="",f=""):u=i.empty),`${a}${u}${f}`})}o(kt,"x");function Ie(e,...t){let r=e.valueOf(),s={},i=[...t];if(t.length>0&&j(t[t.length-1])){let n=t[t.length-1];("$delimiter"in n||"$empty"in n||"$forEach"in n)&&("$delimiter"in n&&(s.delimiter=n.$delimiter),"$empty"in n&&(s.empty=n.$empty),"$forEach"in n&&(s.forEach=n.$forEach),i.pop());}try{return i.length==1?kt(r,i[0],s):kt(r,[...i],s)}catch{return r}}o(Ie,"o");String.prototype.params=function(){return Ie(this,...arguments)};function ts(e,t,r){if(typeof t=="string"){let s=0,i;for(;(i=e.indexOf(t,s))>-1;){let n=typeof r=="function"?r(t):r,a=e.length;e=e.substring(0,i)+n+e.substring(i+t.length),s=i+n.length+e.length-a;}}else {let s;if(!t.global||!t.multiline)throw new Error("The search parameter must be enabled '/gm' option");for(;(s=t.exec(e))!==null;){s.index===t.lastIndex&&t.lastIndex++;let i=e.length,n=s[0].length,a=typeof r=="function"?r(s[0],...s):r;e=e.substring(0,s.index)+a+e.substring(s.index+n),t.lastIndex+=e.length-i;}}return e}o(ts,"s");String.prototype.replaceAll||(String.prototype.replaceAll=function(e,t){return ts(this,e,t)});Qt();Re();M();ve();Gt();Ee();et();Wt();de();_e();xe();me();$t();D();y();Xt();Te();exports.calcDependPaths=Y;exports.computed=G;exports.createAsyncComptuedValue=ca;exports.createObserverObject=ko;exports.createTypeSchemaBuilder=$;exports.defineExtend=Ko;exports.delay=go;exports.forEachObject=Mt;exports.getAsyncVal=aa;exports.getComputedId=io;exports.getDepends=jo;exports.getId=Rt;exports.getMapVal=Tt;exports.getSchemaValue=ar;exports.getSnap=es;exports.getSnapshot=It;exports.getVal=x;exports.isAbsolutePath=re;exports.isAsyncComputedValue=w;exports.isComputedDescriptorParameter=ea;exports.isEq=wt;exports.isFunction=v;exports.isMap=K;exports.isObserverDescriptor=C;exports.isObserverDescriptorBuilder=H;exports.isPathEq=V;exports.isPathMatched=We;exports.isPlainObject=jt;exports.isPrimitive=No;exports.isPromise=Ue;exports.isProxy=Vn;exports.isRaw=st;exports.isRelPath=ya;exports.isSchemaBuilder=ct;exports.isValueSchema=ma;exports.isWithSchemaValue=rs;exports.joinValuePath=q;exports.markRaw=R;exports.noRepeat=Pt;exports.normalizeDeps=Zt;exports.pathIsExists=Lo;exports.pathStartsWith=Eo;exports.schema=Yt;exports.setVal=L;exports.updateObjectVal=Ge;exports.watch=Bt;exports.withSchema=or;return exports;})({});//# sourceMappingURL=index.global.js.map
//# sourceMappingURL=index.global.js.map